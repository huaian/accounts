define("data/model/c.model",["common/c.class.inherit","data/store/c.abstract.store","data/store/common/c.head.store","data/store/common/c.user.store","data/store/common/c.mobiletoken.store","./c.abstract.model","cutil/c.util.object","cutil/c.util.common"],function(e,t,s,i,a,r,o,n){var h=function(){Kai.forward(Kai.loginUrl,{keepURL:!1})},c=new e.Class(r,{__propertys__:function(){this.usehead=!0,this.headStore=s.getInstance(),this.userStore=i.getInstance(),this.mTokenStore=a.getInstance(),this.headinfo=null,this.result=null,this.checkAuth=!0,this.extension=null,this.isUseH5Sys=!1},initialize:function($super,e){_.isFunction($super)&&$super(e)},getTag:function(){var e=this.getParamData();return JSON.stringify(e)},getParamData:function(){var e=this.param instanceof t?this.param.get():this.param;return _.isObject(e)||(e={}),$.extend(!0,{},e)},execute:function(e,s,i,a,o){var c=this.headStore.get(),u=this.userStore.get();if(!u&&this.checkAuth)return $.proxy(h,a)(),!1;if(_.isObject(c)&&_.isObject(u)&&u.auth!==c.auth)return Kai.showMessage("您已在其他标签中登录本系统(或当前登录信息已过期)，请保存已编辑的内容后重新登录"),Kai.hideLoading(),this.userStore.remove(),!1;var d=this.mTokenStore.get();d?this.headStore.setAttr("pauth",d):this.headStore.removeAttr("pauth");var l=n.getGuid(),f=this.headStore.getAttr("cid");l&&l!=f&&this.headStore.setAttr("cid",n.getGuid()||""),!Kai.app.code.is("MASTER")||Kai.app.code.is("YOUTH");var m=this.getParamData();this.pushValidates(function(e){var t=this._getResponseHead(e);return t.overdue?{overdue:t.overdue}:t.success});var p=this.getTag(),g=this.result&&this.result.get(p);!g||this.ajaxOnly||i?("get"!==this.method.toLowerCase()&&this.usehead&&this.contentType!==r.CONTENT_TYPE_JSONP?(m.head=this.headStore.get()||{},this.isUseH5Sys&&m.head&&(m.head.syscode="09"),_.isEmpty(this.extension)||(_.isArray(this.extension)?m.head.extension=this.extension:_.isObject(this.extension)&&(m.head.extension=[],m.head.extension.push(this.extension)))):"get"===this.method.toLowerCase()||this.usehead||this.contentType===r.CONTENT_TYPE_JSONP||this.headinfo&&(m.head=this.headinfo),this.onBeforeCompleteCallback=function(e){try{}catch(s){}if(e&&e[Kai.responseStatusKey]&&"400004"==e[Kai.responseStatusKey].code&&this.checkAuth)return $.proxy(h,a)(),!1;if(this.result instanceof t){try{}catch(s){}this.result.set(e,p)}},this._execute(e,s,a,o,m)):"function"==typeof e&&e.call(a||this,g)},_getResponseHead:function(e){var t=!!e[Kai.responseStatusKey],s=t?e[Kai.responseStatusKey]:e.head,i=!1,a=!1;if(t&&s){var r=s.Ack;if("Failure"===r||1==r){var o=s.Errors;if(o instanceof Array&&o.length>0)for(var n,h=0;h<o.length;h++)if(n=o[h],n&&n.ErrorCode&&"MobileRequestFilterException"==n.ErrorCode){this.checkAuth&&(a=!0,this.headStore.setAuth(""),this.userStore.removeUser());break}}i="Success"===s.Ack||"0"==s.Ack||"000000"==s.code}else i=s&&0===s.errcode;return{success:i,overdue:a}},setParam:function(e,s,i){var a={},r=this.param instanceof t;if(_.isObject(e)?(a=e,_.isUndefined(i)&&_.isBoolean(s)&&(i=s)):a[e]=s,i)r?this.param.set(a):this.param=a;else for(var n in a)r?this.param.setAttr(n,a[n]):o.set(this.param,n,a[n])},clearResult:function(){this.result&&"function"==typeof this.result.remove?this.result.remove():this.result=null},fetch:function(){}});return c});