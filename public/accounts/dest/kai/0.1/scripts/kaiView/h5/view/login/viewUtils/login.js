define("kaiView/h5/view/login/viewUtils/login",["appConfig/const","cutil/c.util.common","cutil/c.util.validate"],function(e,o,t){"use strict";var a={hasValidFormData:function(e){var o=this,e=e||{},t=JSON.parse(JSON.stringify(o.vm.$data.formData));return o.memoryStore.setAttr("memory.formData",t),o.vm.$data.formData.loginId?o.vm.$data.formData.password?e.captchaRequired&&!o.vm.$data.formData.captcha?(o.showErrorTip({tipMessage:"请输入验证码"}),!1):t:(o.showErrorTip({tipMessage:"请输入密码"}),!1):(o.showErrorTip({tipMessage:"请输入用户名"}),!1)},login:function(e){var o=this,t=null;return e&&$(e.target).hasClass("disabled")?!1:void((t=$.proxy(a.hasValidFormData,o)({captchaRequired:o.captchaRequired}))&&(alert("try to sign with url: "+Kai.getUrlWithoutHash()),o.getPosition(function(e){alert("latitude: "+e.coords.latitude),alert("longitude: "+e.coords.longitude)}),o._loginComm.add(_.extend(o.vm.$data.formData,{url:Kai.getUrlWithoutHash()})).then(function(e){o.isSucceedResponse(e)?(o.setUserStore(e.body.userInfo||e.body),o.setBeeSignatureStore?(o.setBeeSignatureStore&&o.setBeeSignatureStore(e.body.beeSignature),o.model.trigger("beeSignature",e.body.beeSignature,{successCallback:function(e){o.showToast({text:"登录成功！",callback:function(){o.forward("h5/view/mobile_index")}})},errorCallback:function(e){e.errorCode;o.forward("h5/view/mobile_index")}})):o.showToast({text:"登录成功！",callback:function(){o.forward(Kai.indexUrl)}})):o.showResponseError(e)},function(e){o.showResponseError(e)})))},enableSendVerifyCodeButton:function(){var e=this;_.isNumber(e.countDownTimeHandler)&&clearTimeout(e.countDownTimeHandler),e.els.sendVerifyCodeButton.html("发送验证码").removeClass("disabled")},countDown:function(e,o){var t=this;return o.html(e+"秒后可重新获取").addClass("disabled"),--e>0?void(t.countDownTimeHandler=setTimeout(function(){a.countDown(e,o)},1e3)):void o.html("发送验证码").removeClass("disabled")},sendVerifyCode:function(e){var o=this;return e&&$(e.target).hasClass("disabled")?!1:$.proxy(a.hasValidFormData,o)({captchaRequired:o.captchaRequired})?(o._getVerificationCodeComm.add(o.vm.$data.formData).then(function(e){if(o.isSucceedResponse(e)){var t=e.body.obj?e.body.obj.mobile:e.body.phone?e.body.phone:"";o.showToast({text:"我们已向您的["+t+"]手机发送了验证码，有效期为5分钟"})}else o.showResponseError(e),$.proxy(a.enableSendVerifyCodeButton,o)()},function(e){o.showResponseError(e),$.proxy(a.enableSendVerifyCodeButton,o)()}),$.proxy(o.viewUtils.countDown,o)(60,o.els.sendVerifyCodeButton),!0):(o.showErrorTip({tipMessage:"请输入用户名和密码"}),!1)}};return a});