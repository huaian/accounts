define("util/build/transforms/depsDeclarative",["../buildControl","../fs","../fileUtils","dojo/_base/lang","dojo/_base/json"],function(e,r,o,s,i){return function(r){var o=[],s=/\sdata-dojo-(?:type|mids)\s*=\s*["']([^"']+\/[^"']+)["']/gi,a=/<script\s+[^>]*type=["']dojo\/require["'][^>]*>([^<]*)<\/script>/gi,t=function(){for(var e,o=[],i=r.text;e=s.exec(i);)e[1].split(/\s*,\s*/).forEach(function(e){o.push(e)});return o},n=function(){for(var o,s=[],t=r.text;o=a.exec(t);){try{var n=i.fromJson("{"+o[1]+"}")}catch(c){e.log("declarativeRequireFailed",["resource",r.src,"error",c])}for(var u in n){var d=n[u];"string"==typeof d?s.push(d):e.log("userWarn",["declarative require has invalid value","resource",r.src,"key",u,"value",d])}}return s};o=o.concat(t()),o=o.concat(n());for(var c in e.amdResources)if(e.amdResources[c].layer){var u=e.amdResources[c].layer.include,d=u.indexOf(r.mid);~d&&(u.splice(d,1),o.forEach(function(e){/^(require|exports|module)$/.test(e)||~u.indexOf(e)||u.push(e)}))}}});