function factory(e,r){if(!e)throw new Error("Unknown host environment: only nodejs is supported by uglify optimizer.");if(e.minify){var s=e;e=function(e,o,t,i){var n=s.parse(e,o);n.figure_out_scope();var a=o.compress_options||{};"warnings"in a||(a.warnings=!1);var p=s.Compressor(a);compressed_ast=n.transform(p),compressed_ast.figure_out_scope(),compressed_ast.compute_char_frequency(),compressed_ast.mangle_names();var f=o.gen_options||{};if(i){var u=f.source_map||{};u.file=o.filename.split("/").pop(),u.dest_line_diff=1,f.source_map=s.SourceMap(u)}var c=compressed_ast.print_to_string(f);return i&&(c+="//# sourceMappingURL="+t.split("/").pop()+".map",r.writeFile(t+".map",f.source_map.toString(),"utf-8")),c}}return e}if(global.define)define("util/build/transforms/optimizer/uglify_worker",["require","../../fs"],factory);else{try{var uglify=require("uglify-js"),fs=require("fs")}catch(e){}uglify=factory(uglify,fs),process.on("message",function(e){var r="",s="";try{var r=uglify(e.text,e.options,e.dest,e.useSourceMaps)}catch(o){s=o.toString()+" "+o.stack}process.send({text:r,dest:e.dest,error:s})})}