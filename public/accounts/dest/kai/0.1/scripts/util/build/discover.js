define("util/build/discover",["./buildControl","./fileUtils","./fs"],function(t,r,n){var e={},o=["trees","dirs","files"],i={},a={},c=r.getFilepath,s=r.catPath,u=(r.compactPath,function(r,n){r.tag||(r.tag={}),n&&n(r),t.start(r),i[c(r.src)]=1,a[c(r.dest)]=1}),f=function(t){var r=function(t){return"function"==typeof t?t:function(r){return t.test(r)}},n={},e=!1;for(var o in t)n[o]=r(t[o]),e=!0;return e?function(t){for(var r in n)n[r](t.src,t.mid,t)&&(t.tag[r]=1)}:0},d=function(){return 0},l=function(t){return t?"function"==typeof t?t:function(r){return t.test(r)}:d},g=function(t,r,o,i,a,c){var s=t+(o?"/"+o:""),u=s+"/",f=o?o+"/":"",d=[];e[s]||(e[s]=1,n.readdirSync(s).forEach(function(t){var e=f+t;if(!i||!i(e)){var o=u+t,c=n.statSync(o);c.isDirectory()?d.push(e):a(o,r+"/"+e)}}),c&&d.length&&d.forEach(function(n){g(t,r,n,i,a,1)}))},p=function(t,r){r(t[0],t[1])},v=function(n){return r.dirExists(n)?1:(t.log("missingDirDuringDiscovery",["directory",n]),0)},h=function(t,r){v(t[0])&&g(t[0],t[1],0,l(t[2]),r,0,0)},m=function(t,r){v(t[0])&&g(t[0],t[1],0,l(t[2]),r,1)},y={files:p,dirs:h,trees:m},b=function(r,n){for(var e,i=r.trees||[],a=0;a<i.length;a++)if(i[a][0]==r.location){e=i[a];break}e||(e=[r.location,n.location,/(\/\.)|(^\.)|(~$)/]);var c=[];m(e,function(t){c.push(t)});var d={},l={},g=r.location.length+1,p=r.name,v=p?p+"/":"",h=p&&t.getSrcModuleInfo(p),b=p&&h.url;c.forEach(function(r){var n=/\.js$/.test(r),e=v+r.substring(g,n?r.length-3:r.length),o=n&&t.getSrcModuleInfo(e);n?r==b?d[p]=h:d[e]=o:l[e]=[r,e]});for(var k in r.modules){var D=v+k,E=t.getSrcModuleInfo(D);"string"==typeof r.modules[k]&&(E.url=r.modules[k]),d[D]=E,delete l[D]}var I=f(r.resourceTags);for(var M in d){E=d[M];var S={src:E.url,dest:t.getDestModuleInfo(E.mid).url,pid:E.pid,mid:E.mid,pack:r,deps:[]};u(S,I)}var x=v.length;for(M in l)S={src:l[M][0],mid:l[M][1],dest:s(n.location,M.substring(x))},u(S,I);for(a=0;a<o.length;a++){var P=o[a];r[P]&&r[P].forEach(function(t){y[P](t,function(t,r){u({src:t,dest:r},I)})})}},k=function(){for(var r in t.packages)b(t.packages[r],t.destPackages[r])};return function(){t.waiting++,u({tag:{report:1},src:"*report",dest:"*report",reports:[]}),k();for(var r=f(t.resourceTags),n=0;n<o.length;n++){var e=o[n];t[e].forEach(function(t){y[e](t,function(t,n){u({src:t,dest:n},r)})})}for(var i in t.layers){var a=t.layers[i],c=t.getSrcModuleInfo(i),s=t.resources[c.url];s||(s={tag:{synthetic:1,amd:1},src:c.url,dest:t.getDestModuleInfo(c.mid).url,pid:c.pid,mid:c.mid,pack:c.pack,deps:[],text:"define([], 1);"+t.newline,getText:function(){return this.text},encoding:"utf8"},u(s)),s.layer=a,a.boot&&(t.loader?t.loader.boots.push(s):t.log("inputNoLoaderForBoot",["boot layer",i]))}t.passGate()}});