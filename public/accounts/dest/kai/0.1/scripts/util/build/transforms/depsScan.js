define("util/build/transforms/depsScan",["require","../buildControl","../fileUtils","../removeComments","dojo/json","dojo/_base/lang","dojo/_base/loader","../fs"],function(e,n,t,r,i,o,u,a){return function(e){var c=n.newline,d=function(e,n){e=e||{};for(var t in n)e[t]=n[t];return e},l=0,s=[],f=0,g=function(t,r,i){f=1;var u=arguments.length,a=0,c=["require","exports","module"];if(n.factoryScan&&1==u&&"function"==typeof t&&(r=[],t.toString().replace(/(\/\*([\s\S]*?)\*\/|\/\/(.*)$)/gm,"").replace(/require\(["']([\w\!\-_\.\/]+)["']\)/g,function(e,n){r.push(n)}),a=[0,c.concat(r),t],e.text=e.text.replace(/define\s*\(/,'define(["'+a[1].join('","')+'"],')),a||(a=1==u?[0,c,t]:2==u?t instanceof Array?[0,t,r]:[t,c,r]:[t,r,i]),a[1].some(function(e){return!o.isString(e)}))throw new Error("define dependency vector contains elements that are not of type string.");l=a[0],s=s.concat(a[1])},p=(g.amd={vendor:"dojotoolkit.org",context:"build"},function(e,n){var t=function(e){return e.some(function(e){return/^\./.test(e)})};o.isArray(e)&&!t(e)?s=s.concat(e):o.isArray(n)&&!t(n)&&(s=s.concat(n))}),m=function(e){return e.replace(/\./g,"/")},h=0,v=[],y=[],x={require:function(e,n){y.push(m(e))},provide:function(e){v.push(m(e))},requireLocalization:function(e,n,t){s.push("dojo/i18n!"+m(e)+"/nls/"+(!t||/root/i.test(t)?"":t+"/")+m(n))},platformRequire:function(e){h=1,(e.common||[]).concat(n.platform&&e[n.platform]||[]).forEach(function(e){y.push(m(o.isArray(e)?e[0]:e))})},loadInit:function(e){h=1,e()},requireIf:function(e,n,t){h=1,e&&y.push(m(n))},requireAfterIf:function(e,n,t){h=1,e&&y.push(m(n))}},b=new Function("dojo","__text","eval(__text);"),j=function(t){var r;if(e.pack.runtime){var i,o=e.pack.runtime,u=[],a=[];o.dojo=d(o.dojo,x);for(i in o)u.push(o[i]),a.push(i);r=new Function("__bc","__args","__text","(function("+a.join(",")+"){ eval(__text); }).apply(__bc, __args);"),u=[n,u]}else u=[x],r=b;var c=t.map(function(e){try{return r.apply(n,u.concat(e)),0}catch(t){return h=1,[t,e]}});c.forEach(function(t){t&&n.log("legacyFailedEval",["module",e.mid,"text",t[0],"error",t[1]])})},_=function(t){t&&t!=e.mid&&n.log("amdInconsistentMid",["module",e.mid,"specified",t]),t&&(e.tag.hasAbsMid=1)},S=function(){try{"dojo/_base/loader"!=e.mid&&/dojo\.(require|provide)\s*\(/.test(r(e.text))&&n.log("amdPureContainedLegacyApi",["module",e.mid]),new Function("define","require",e.text)(g,p),_(l)}catch(t){n.log("amdFailedEval",["module",e.mid,"error",t])}},w=function(e){for(var n,t,r=[],i="spaces",o="string",u="endOfString",a="done",c="error",d={spaces:function(e){return/\s/.test(e)?i:"'"==e||'"'==e?(n=e,t="",o):0==e?a:c},string:function(e){return e==n?(r.push(t),"endOfString"):(t+=e,"string")},endOfString:function(e){return/\s/.test(e)?u:0==e?a:","==e?i:c}},l=i,s=0;s<e.length;s++)if(l=d[l](e.charAt(s)),l==c)return 0;return d[l](0)!=c?r:0},A=function(t){for(var r,i=0,o=/(^|\s)define\s*\(\s*(["'][^'"]+['"])?\s*(,)?\s*(\[[^\]]*?\])?\s*(,)?/g;null!=(r=o.exec(t));)try{r=r[2]?r[3]?r[5]?r[0]+"{})":r[4]?r[0]+")":r[0]+"{})":r[0]+")":r[4]?r[5]?r[0]+"{})":r[0]+")":"define({})",i++,new Function("define",r)(g),_(l)}catch(u){i--,n.log("amdFailedDefineEval",["module",e.mid,"text",r,"error",u])}for(var a=/(^|\s)require\s*\(\s*\[([^\]]*?)\]/g;null!=(r=a.exec(t));){var c=w(r[2]);c&&(i++,s=s.concat(c.filter(function(e){return"."!=e.charAt(0)})))}return i},q=function(e){function t(e,n){o.isString(e)&&o.isObject(n)?(_(e),r=n):o.isObject(e)&&(r=e)}var r=0;try{if(new Function("define",e.text)(t),r)return e.bundleValue=r,void(e.bundleType="amd")}catch(i){}try{if(r=new Function("return "+e.text+";")(),o.isObject(r))return e.bundleValue=r,void(e.bundleType="legacy")}catch(i){}S(),f||n.log("i18nImproperBundle",["module",e.mid])},I=function(){var t=e.mid.match(/(^.*\/nls\/)(([^\/]+)\/)?([^\/]+)$/),r=e.prefix=t[1],i=e.locale=t[3],o=e.bundle=t[4],u=r+o,a=n.amdResources[u];return a?(a.localizedSet||(a.localizedSet={}),q(e),!n.localeList&&"legacy"!=e.bundleType||e.bundleValue||n.log("i18nUnevaluableBundle",["module",e.mid]),"legacy"==e.bundleType&&e===a&&e.bundleValue&&(e.bundleValue={root:e.bundleValue}),void(e!==a&&(a.localizedSet[i]=e))):void n.log("i18nNoRoot",["bundle",e.mid])},E="(((templatePath|templateCssPath)\\s*(=|:)\\s*)dojo\\.(module)?Url\\(|dojo\\.cache\\s*\\(\\s*)\\s*?[\\\"\\']([\\w\\.\\/]+)[\\\"\\'](([\\,\\s]*)[\\\"\\']([\\w\\.\\/-]*)[\\\"\\'])?(\\s*,\\s*)?([^\\)]*)?\\s*\\)",T=new RegExp(E,"g"),F=new RegExp(E),P=function(){var r=function(e){return a.readFileSync(e,"utf8")},o=[],u=[],c=[];if(e.text=e.text.replace(T,function(o){var a=o.match(F),d=n.getSrcModuleInfo(t.catPath(a[6].replace(/\./g,"/"),a[9]),0,!0);if(n.internSkip(d.mid,e))return o;var l=n.resources[d.url];if(!l)return u.push(d.url),o;var s=l.getText&&l.getText()||r(l.src);if(!s)return c.push(l.src),o;if(s=i.stringify(s),-1!=o.indexOf("dojo.cache")){var f=a[11];if(f){var g=f.indexOf("{");-1!=g&&(f=f.substring(0,g+1)+"value: "+s+","+f.substring(g+1,f.length))}else f=s;return'dojo.cache("'+a[6]+'", "'+a[9]+'", '+f+")"}return"templatePath"==a[3]?"templateString"+a[4]+s:o}),o.length||u.length||c.length){var d=["module",e.mid];o.length&&d.push("skipping",o),u.length&&d.push("not found",u),c.length&&d.push("nothing to intern",c),n.log("internStrings",d)}},M=function(){n.internStrings&&P();var t=e.getText(),o=n.scopeNames,a=u.extractLegacyApiApplications(t,r(t));if(!a.extractText&&A(r(t)))return void n.log("amdNotPureContainedNoLegacyApi",["module",e.mid]);if(n.log("legacyAssumed",["module",e.mid]),!a)return void(e.getText=function(){return"define("+i.stringify(o)+", function("+o.join(",")+"){"+c+t+"});"+c});if(j(a[2]),v.length&&(v.length>1&&n.log("legacyMultipleProvides",["module",e.mid,"provides",v]),v.forEach(function(t){t.replace(/\./g,"/")!=e.mid&&n.log("legacyImproperProvide",["module",e.mid,"provide",t])})),h){n.log("legacyUsingLoadInitPlug",["module",e.mid]);var l,f,g,p;l="// generated by build app"+c+"define([], {"+c+"	names:"+i.stringify(o)+","+c+"	def:function("+o.join(",")+"){"+c+a[1]+"}"+c+"});"+c,f=e.mid+"-loadInit",g=d(d({},e),{src:e.src.substring(0,e.src.length-3)+"-loadInit.js",dest:n.getDestModuleInfo(f).url,mid:f,tag:{loadInitResource:1},deps:[],getText:function(){return l}}),n.start(g),p="dojo/loadInit!"+f,s.push(p)}else y.length&&s.push("dojo/require!"+y.join(","));s=o.concat(s),e.getText=function(){return"// wrapped by build app"+c+"define("+i.stringify(s)+", function("+o.join(",")+"){"+c+a[0]+c+"});"+c}};e.tag.nls?I():e.tag.amd||/\/\/>>\s*pure-amd/.test(e.text)?S():M();var O=e.deps;e.aggregateDeps=s,s.forEach(function(t){if(!/^(require|exports|module)$/.test(t))try{var r=n.getAmdModule(t,e);o.isArray(r)?r.forEach(function(e){O.push(e)}):r?O.push(r):n.log("amdMissingDependency",["module",e.mid,"dependency",t])}catch(i){n.log("amdMissingDependency",["module",e.mid,"dependency",t,"error",i])}})}});