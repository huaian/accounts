define("util/build/transforms/depsDump",["../buildControl","../fileUtils","../fs","dojo/_base/lang","dojo/_base/array","dojo/json"],function(e,i,r,n,t,s){return function(d,o){if(!e.depsDumpDotFilename&&!e.depsDumpFilename)return 0;var u=0,a={},m={};e.dotModules&&(u={},t.forEach(e.dotModules.split(","),function(e){u[n.trim(e)]=a}));var p,c,f=[],l={},h=0,D="digraph {\n";for(c in e.resources)p=e.resources[c],p.deps&&((!u||u[p.mid])&&(u[p.mid]=m,p.deps.forEach(function(e){D+='"'+p.mid+'" -> "'+e.mid+'";\n',u[e.mid]!==m&&(u[e.mid]=a)})),p.uid=h,l[e.resources[c].mid]=h,f.push(p),h++);if(e.depsDumpDotFilename){for(var F=u;F;){F=!1;for(c in e.resources)p=e.resources[c],u[p.mid]==a&&(F=!0,u[p.mid]=m,p.deps&&p.deps.forEach(function(e){D+='"'+p.mid+'" -> "'+e.mid+'";\n',u[e.mid]!==m&&(u[e.mid]=a)}))}D+="}\n";var v=i.computePath(e.depsDumpDotFilename,e.destBasePath);i.ensureDirectory(i.getFilepath(v)),r.writeFileSync(v,D,"ascii")}if(e.depsDumpFilename){var g=f.map(function(e){return e.deps.map(function(e){return e.uid})}),y={},b=function(e,i){var r=e.shift();return r in i||(i[r]={}),e.length?b(e,i[r]):i[r]};f.forEach(function(e,i){var r=e.mid.split("/");b(r,y)["*"]=i}),v=i.computePath(e.depsDumpFilename,e.destBasePath),i.ensureDirectory(i.getFilepath(v)),r.writeFileSync(v,s.stringify({depsTree:g,idTree:y}),"ascii")}return 0}});