define("util/buildscripts/jslib/fileUtil",["dojo","dijit","dojox"],function(dojo,dijit,dojox){var fileUtil={};fileUtil.getLineSeparator=function(){return java.lang.System.getProperty("line.separator")},fileUtil.getFilteredFileList=function(e,t,i,r,n){var a=[],l=e;r||(l=new java.io.File(e));var o=t.include||t,s=t.exclude||null;if(l.exists())for(var c=l.listFiles(),u=0;u<c.length;u++){var f=c[u];if(f.isFile()){var d=f.getPath();i&&(d=new String(d),-1==d.indexOf("/")&&(d=d.replace(/\\/g,"/")));var g=!0;o&&(g=d.match(o)),g&&s&&(g=!d.match(s)),g&&!f.getName().match(/^\./)&&a.push(d)}else if(f.isDirectory()&&!f.getName().match(/^\./)&&!n){var h=this.getFilteredFileList(f,t,i,!0);a.push.apply(a,h)}}return a},fileUtil.copyDir=function(e,t,i,r){for(var n=fileUtil.getFilteredFileList(e,i,!0),a=[],l=0;l<n.length;l++){var o=n[l],s=o.replace(e,t);fileUtil.copyFile(o,s,r)&&a.push(s)}return a.length?a:null},fileUtil.asyncFixEOLRe=new RegExp(fileUtil.getLineSeparator(),"g"),fileUtil.transformAsyncModule=function(filename,contents){var match,bundleMatch,moduleId,requireArgs=[],lineSeparator=fileUtil.getLineSeparator(),dojo={isBrowser:!0},getAsyncArgs=function(e,t){t?moduleId=e:t=e;for(var i=0;i<t.length;i++)"require"!=t[i]&&requireArgs.push(t[i].replace(/\//g,"."))};if(match=contents.match(/(\/\/begin\sv1\.x\scontent)([\s\S]+)(\/\/end\sv1\.x\scontent)/))return match[2];if(match=contents.match(/\/\/\s*AMD\-ID\s*"([^\n"]+)"/i),moduleId=match&&match[1]||"",moduleId||'define("'==contents.substring(0,8)){if(match=contents.match(/^define\(([^\]]+)\]\s*\,[\s\n]*function.+$/m)){if(eval("getAsyncArgs("+match[1]+"])"),!moduleId)return logger.info("warning: the module "+filename+" looked like an AMD module, but didn't provide a module id"),contents;for(var prefix='dojo.provide("'+moduleId.replace(/\//g,".")+'");'+lineSeparator,req,reqs=requireArgs,i=0;i<reqs.length;i++)req=reqs[i],"text!"==req.substring(0,5)||("i18n!"==req.substring(0,5)?(bundleMatch=req.match(/i18n\!(.+)\.nls\.(\w+)/),prefix+='dojo.requireLocalization("'+bundleMatch[1].replace(/\//g,".")+'", "'+bundleMatch[2]+'");'+lineSeparator):"dojo"==req||"dijit"==req||"dojox"==req||/^dojo\.lib/.test(req)||(prefix+='dojo.require("'+req+'");'+lineSeparator));contents=contents.replace(/^\s*return\s+.+\/\/\s*AMD-return((\s.+)|(\s*))$/gim,"");var matchLength=match.index+match[0].length+1,contentsLength=contents.search(/\s*return\s+[_a-zA-Z\.0-9]+\s*;\s*(\/\/.+)?\s*\}\);\s*$/);return-1==contentsLength&&(contentsLength=contents.search(/\}\);\s*$/)),prefix+lineSeparator+contents.substring(matchLength,contentsLength)}return contents}return contents},fileUtil.copyFile=function(e,t,i){var r=new java.io.File(t);if(i){var n=new java.io.File(e);if(r.exists()&&r.lastModified()>=n.lastModified())return!1}var a=r.getParentFile();if(!a.exists()&&!a.mkdirs())throw"Could not create directory: "+a.getAbsolutePath();if(/.+\.js$/.test(e))fileUtil.saveUtf8File(t,fileUtil.transformAsyncModule(e,fileUtil.readFile(e)).replace(fileUtil.asyncFixEOLRe,"\n"));else{var l=new java.io.FileInputStream(e).getChannel(),o=new java.io.FileOutputStream(t).getChannel();o.transferFrom(l,0,l.size()),l.close(),o.close()}return!0},fileUtil.readFile=function(e,t){t=t||"utf-8";var i=new java.io.File(e),r=fileUtil.getLineSeparator(),n=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(i),t));try{var a=new java.lang.StringBuffer,l=n.readLine();for(l&&l.length()&&65279===l.charAt(0)&&(l=l.substring(1));null!==l;)a.append(l),a.append(r),l=n.readLine();return new String(a.toString())}finally{n.close()}},fileUtil.saveUtf8File=function(e,t){fileUtil.saveFile(e,t,"utf-8")},fileUtil.saveFile=function(e,t,i){var r,n=new java.io.File(e),a=n.getParentFile();if(!a.exists()&&!a.mkdirs())throw"Could not create directory: "+a.getAbsolutePath();r=i?new java.io.OutputStreamWriter(new java.io.FileOutputStream(n),i):new java.io.OutputStreamWriter(new java.io.FileOutputStream(n));var l=new java.io.BufferedWriter(r);try{l.write(t)}finally{l.close()}},fileUtil.deleteFile=function(e){var t=new java.io.File(e);if(t.exists()){if(t.isDirectory())for(var i=t.listFiles(),r=0;r<i.length;r++)this.deleteFile(i[r]);t["delete"]()}}});