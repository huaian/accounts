//Add copyright

define("util/buildscripts/makeDojoJsWeb",["dojo","dijit","dojox","dojo/require!dojo/string/extras,dojo/crypto/MD5"],function(dojo,dijit,dojox){load("buildUtil.js"),load("buildUtilXd.js");var result="ERROR",buildDirectory=new String(arguments[0]),depList=new String(arguments[1]),provideList=new String(arguments[2]),version=new String(arguments[3]),xdDojoUrl=new String(arguments[4]);depList=depList.split(","),"null"==provideList?provideList="[]":(provideList=provideList.split(","),provideList='["'+provideList.join('","')+'"]');var dependencyResult;eval('dependencyResult = {depList: ["'+depList.join('","')+'"], provideList: '+provideList+"};");for(var deps=dependencyResult.depList,isInputOk=!0,i=0;i<deps.length;i++){var matches=deps[i].match(/\.\./g);if(matches&&matches.length>1||!deps[i].match(/\.js$/)||"/"==deps[i].indexOf(0)){print("Error: Invalid file set."),isInputOk=!1;break}}if(isInputOk){djConfig={baseRelativePath:"../"},load("../dojo.js"),dojo.require("dojo.string.extras"),dojo.require("dojo.crypto.MD5");var buildSigDir=dojo.crypto.MD5.compute(depList.sort().join(","),dojo.crypto.outputTypes.Hex);try{var contents=buildUtil.createLayerContents(dependencyResult.depList,dependencyResult.provideList,version),compressedContents="",prefixes=[["dojo","src"]];contents=buildUtil.modifyRequireLocalization(contents,prefixes),contents=buildUtil.interningRegexpMagic("xdomain",contents,djConfig.baseRelativePath,prefixes,[],!0),xdDojoUrl&&(contents=buildUtilXd.setXdDojoConfig(contents,xdDojoUrl)),compressedContents=buildUtil.optimizeJs("dojo.js",contents,"","shrinksafe");var copyright=fileUtil.readFile("copyright.txt"),buildNotice=fileUtil.readFile("build_notice.txt");contents=copyright+buildNotice+contents,compressedContents=copyright+buildNotice+compressedContents;var buildCachePath=buildDirectory+"/"+buildSigDir+"/",dirFile=new java.io.File(buildCachePath+"compressed"),dirsOk=dirFile.mkdirs();result="dirFile: "+dirFile.getAbsolutePath()+", dirsOK: "+dirsOk;var buildContents=dependencyResult.provideList.sort().join("\n");fileUtil.saveUtf8File(buildCachePath+"dojo.js",contents),fileUtil.saveUtf8File(buildCachePath+"compressed/dojo.js",compressedContents),fileUtil.saveUtf8File(buildCachePath+"build.txt",buildContents),result="OK"}catch(e){result="ERROR: "+e}print(result)}});