define("util/doh/_browserRunner",["dojo/dom","dojo/dom-geometry","dojo/dom-style","dojo/_base/fx","dojo/_base/lang","dojo/query","dojo/domReady","dojo/sniff","dojo/window","doh/runner"],function(e,t,r,n,i,a,o,s,u,l){l.isBrowser=!0;var d;try{d=window.parent==window||!Boolean(window.parent.doh)}catch(c){d=!0}if(d){var p=function(e){return document.getElementById(e)},m=function(e,t,r){r||(r=window);var n=t;"string"==typeof t&&(n=r[t]);var i=function(){return n.apply(r,arguments)};o&&"load"==e?o(i):window.attachEvent?window.attachEvent("on"+e,i):window.addEventListener?window.addEventListener(e,i,!1):document.addEventListener&&document.addEventListener(e,i,!1)},g=function(e){return e.replace(/&/gm,"&amp;").replace(/</gm,"&lt;").replace(/>/gm,"&gt;").replace(/"/gm,"&quot;")},T=function(e){switch(!0){case 1e3>e:return e+"ms";case 6e4>e:return Math.round(e/100)/10+"s";case 36e5>e:return Math.round(e/6e3)/10+"m";default:return Math.round(e/36e4)/10+"h"}},f=[],h=0,_=function(e,t){for(var r="",n=0;n<e.length;n++)r+=" "+e[n];if(r=g(r),r=r.replace("	","&nbsp;&nbsp;&nbsp;&nbsp;").replace(" ","&nbsp;").replace("\n","<br>&nbsp;"),!p("logBody"))return void f.push(r);if(f.length&&!t)for(var i;i=f.shift();)_(i,!0);var a=p("logBody"),o=document.createElement("div");o.innerHTML=r,a.appendChild(o),h++},v=function(e){for(;e&&!e.getAttribute("_target");)e=e.parentNode,e.getAttribute||(e=null);return e};l._jumpToLog=function(e){var t=v(e?e.target:window.event.srcElement);if(t){var i=Number(t.getAttribute("_target")),a=p("logBody");if(!(i>=a.childNodes.length)){var o=a.childNodes[i];if(o.scrollIntoView(),r&&n){var s=r.get(o.parentNode.parentNode,"backgroundColor"),u=r.get(t.parentNode,"backgroundColor"),l=n.animateProperty({node:o,duration:500,properties:{backgroundColor:{start:u,end:s}},onEnd:function(){o.style.backgroundColor=""}}),d=n.animateProperty({node:o,duration:500,properties:{backgroundColor:{start:s,end:u}},onEnd:function(){l.play()}});d.play()}}}},l._jumpToSuite=function(e){var t=v(e?e.target:window.event.srcElement);if(t){var r=t.getAttribute("_target"),n=L(r);n&&n.scrollIntoView()}},l._init=function(e){return function(){var t=p("logBody");if(t){for(;t.firstChild;)t.removeChild(t.firstChild);h=0}this._totalTime=0,this._suiteCount=0,e.apply(l,arguments)}}(l._init),l._setupGroupForRun=function(e){return function(t){var r=l._groups[t];l._curTestCount=r.length,l._curGroupCount=1;var n=L(t);n&&n.getElementsByTagName("td")[2].setAttribute("_target",h+1),e.apply(l,arguments)}}(l._setupGroupForRun);var y=l._report;l._report=function(){var e=p("testList");if(e){var t=e.getElementsByTagName("tfoot");t.length&&e.removeChild(t[0]);var n=e.createTFoot(),a=n.insertRow(-1);a.className="inProgress";var o=a.insertCell(-1);o.colSpan=2,o.innerHTML="Result",o=a.insertCell(-1),o.innerHTML=this._testCount+" tests in "+this._groupCount+" groups /<span class='failure'>"+this._errorCount+"</span> errors, <span class='failure'>"+this._failureCount+"</span> failures",o.setAttribute("_target",h+1),a.insertCell(-1).innerHTML=T(l._totalTime)}l.perfTestResults&&require(["dojox/math/stats","dojox/charting/DataChart","dojox/charting/plot2d/Scatter","dojox/charting/plot2d/Lines","dojo/data/ItemFileReadStore"],function(e,t,n,a,o){i.mixin(l,e);var s=function(e,r,n){var i,s=l.median(n),u=[];for(i=0;i<n.length;i++)u.push(s);var d={label:"name",items:[{name:r,trials:n},{name:"Median",trials:u}]},c=new o({data:d}),p=Math.floor(l.min(n)),m=Math.ceil(l.max(n)),g=(m-p)/10;p>0&&(p-=g,0>p&&(p=0),p=Math.floor(p)),m>0&&(m+=g,m=Math.ceil(m)),g=(m-p)/10;var T=new t(e,{type:a,displayRange:n.length,xaxis:{min:1,max:n.length,majorTickStep:Math.ceil((n.length-1)/10),htmlLabels:!1},yaxis:{min:p,max:m,majorTickStep:g,vertical:!0,htmlLabels:!1}});T.setStore(c,{name:"*"},"trials")};try{var u,d=p("perfTestsBody"),c=[];l.perfTestAnalytics={},l.showPerfTestsPage();for(u in l.perfTestResults){l.perfTestAnalytics[u]={};var m=l.perfTestResults[u],g=document.createElement("h1");g.appendChild(document.createTextNode("Group: "+u)),d.appendChild(g);var T=document.createElement("blockquote");d.appendChild(T);var f;for(f in m){var h=m[f];if(h){var _=document.createElement("h3");_.appendChild(document.createTextNode("TEST: "+f)),_.style.textDecoration="underline",T.appendChild(_);var v=document.createElement("div");T.appendChild(v);var y,b="<b>TRIAL SIZE: </b>"+h.trials[0].testIterations+" iterations<br><b>NUMBER OF TRIALS: </b>"+h.trials.length+"<br>",E=[],w=[];for(y=0;y<h.trials.length;y++)E.push(h.trials[y].average),w.push(h.trials[y].executionTime);var N=l.perfTestAnalytics[u][f]={averageTrialExecutionTime:l.mean(w),maxTestIterationTime:l.max(E),minTestIterationTime:l.min(E),averageTestIterationTime:l.mean(E),medianTestIterationTime:l.median(E),varianceTestIterationTime:l.variance(E),standardDeviationTestIterationTime:l.sd(E)};b+="<b>AVERAGE TRIAL EXECUTION TIME: </b>"+N.averageTrialExecutionTime.toFixed(10)+"ms.<br>",b+="<b>MAXIMUM TEST ITERATION TIME: </b>"+N.maxTestIterationTime.toFixed(10)+"ms.<br>",b+="<b>MINIMUM TEST ITERATION TIME: </b>"+N.minTestIterationTime.toFixed(10)+"ms.<br>",b+="<b>AVERAGE TEST ITERATION TIME: </b>"+N.averageTestIterationTime.toFixed(10)+"ms.<br>",b+="<b>MEDIAN TEST ITERATION TIME: </b>"+N.medianTestIterationTime.toFixed(10)+"ms.<br>",b+="<b>VARIANCE TEST ITERATION TIME: </b>"+N.varianceTestIterationTime.toFixed(10)+"ms.<br>",b+="<b>STANDARD DEVIATION ON TEST ITERATION TIME: </b>"+N.standardDeviationTestIterationTime.toFixed(10)+"ms.<br>",v.innerHTML=b,v=document.createElement("div"),v.innerHTML="<h3>Average Test Execution Time (in milliseconds, with median line)</h3>",T.appendChild(v),v=document.createElement("div"),r.set(v,"width","600px"),r.set(v,"height","250px"),T.appendChild(v),c.push({div:v,title:"Average Test Execution Time",data:E}),v=document.createElement("div"),v.innerHTML="<h3>Average Trial Execution Time (in milliseconds, with median line)</h3>",T.appendChild(v),v=document.createElement("div"),r.set(v,"width","600px"),r.set(v,"height","250px"),T.appendChild(v),c.push({div:v,title:"Average Trial Execution Time",data:w})}}}var C=function(){if(c.length){var e=c.shift();s(e.div,e.title,e.data)}setTimeout(C,50)};setTimeout(C,150)}catch(I){l.debug(I)}}),y.apply(l,arguments)},l.error=void 0,this.opera&&opera.postError?l.debug=function(){for(var e="",t=0;t<arguments.length;t++)e+=" "+arguments[t];_([e]),opera.postError("DEBUG:"+e)}:window.console?(console.error&&(l.error=function(){_.call(window,arguments)}),console.debug?l.debug=function(){_.call(window,arguments)}:console.info?l.debug=function(){_.call(window,arguments)}:l.debug=function(){_.call(window,arguments)}):l.debug=function(){_.call(window,arguments)},l.error=l.error||l.debug;var b=!1,E=null,w=null,N={},C={},I=function(e,t){if(C[e])return C[e];var r=!0;return C[e]=function(n,i){var a,o=N[e].__items;if(r||i){for(r=!1,a=0;a<o.length;a++)o[a].style.display="";t.innerHTML="&#9660;"}else{for(r=!0,a=0;a<o.length;a++)o[a].style.display="none";t.innerHTML="&#9658;"}}},x=function(e){if(p("testList")){var t=p("testList").tBodies[0],r=E.cloneNode(!0),n=r.getElementsByTagName("td"),i=n[0];i.onclick=I(e,i);var a=n[1].getElementsByTagName("input")[0];return a.group=e,a.onclick=function(){l._groups[e].skip=!this.checked},n[2].innerHTML="<div class='testGroupName'>"+e+"</div><div style='width:0;'>&nbsp;</div>",n[3].innerHTML="",t.appendChild(r),r}},M=function(e,t){if(w){var r=N[e];r.__items||(r.__items=[]);var n=w.cloneNode(!0),i=n.getElementsByTagName("td");i[2].innerHTML=t.name,i[3].innerHTML="";var a=(r.__lastFixture||r.__groupNode).nextSibling;return a?a.parentNode.insertBefore(n,a):r.__groupNode.parentNode.appendChild(n),n.style.display="none",r.__items.push(n),r.__lastFixture=n}},B=function(e,t){return N[e]?N[e][t.name]:null},L=function(e){return N[e]?N[e].__groupNode:null},A=[];l._updateTestList=function(e,t,r){if(!b)return void(e&&t&&A.push([e,t]));if(A.length&&!r)for(var n;n=A.shift();)l._updateTestList(n[0],n[1],!0);e&&t&&(N[e]||(N[e]={__groupNode:x(e)}),N[e][t.name]||(N[e][t.name]=M(e,t)))},l._testRegistered=l._updateTestList,l._groupStarted=function(e){0==this._suiteCount&&(this._runedSuite=0,this._currentGlobalProgressBarWidth=0,this._suiteCount=this._testCount),l._inGroup!=e&&(l._groupTotalTime=0,l._runed=0,l._inGroup=e,this._runedSuite++);var t=L(e);t&&(t.className="inProgress")},l._groupFinished=function(e,t){var r=L(e);if(r&&l._inGroup==e){l._totalTime+=l._groupTotalTime,r.getElementsByTagName("td")[3].innerHTML=T(l._groupTotalTime),r.getElementsByTagName("td")[2].lastChild.className="",l._inGroup=null;var n=l._updateGlobalProgressBar(this._runedSuite/this._groupCount,t,e);r.className=n?"failure":"success",l._currentGlobalProgressBarWidth=parseInt(this._runedSuite/this._groupCount*1e4)/100}l._inGroup==e&&this.debug('Total time for GROUP "',e,'" is ',T(l._groupTotalTime))},l._testStarted=function(e,t){var r=B(e,t);r&&(r.className="inProgress")};var R={},S=function(e){if(p("hiddenAudio")&&p("audio")&&p("audio").checked){var t=R[e];if(!t||new Date-t>700){R[e]=new Date;var r=document.createElement("span");p("hiddenAudio").appendChild(r),r.innerHTML='<embed src="_sounds/'+e+'.wav" autostart="true" loop="false" hidden="true" width="1" height="1"></embed>'}}};l._updateGlobalProgressBar=function(e,t,r){var n=p("progressOuter"),i=n.childNodes[l._runedSuite-1];i||(i=document.createElement("div"),n.appendChild(i),i.className="success",i.setAttribute("_target",r)),t||i._failure||(i._failure=!0,i.className="failure",r&&i.setAttribute("title","failed group "+r));var a=parseInt(1e4*e)/100;return i.style.width=a-l._currentGlobalProgressBarWidth+"%",i._failure},l._testFinished=function(e,t,r){var n,i=B(e,t),a=t.endTime-t.startTime;if(i&&(i.getElementsByTagName("td")[3].innerHTML=T(a),i.className=r?"success":"failure",i.getElementsByTagName("td")[2].setAttribute("_target",h),r||(S("doh"),n=L(e),n&&(n.className="failure",I(e)(null,!0)))),l._inGroup==e&&(n=L(e),l._runed++,n&&l._curTestCount)){var o=l._runed/l._curTestCount,s=this._updateGlobalProgressBar((l._runedSuite+o-1)/l._groupCount,r,e),u=n.getElementsByTagName("td")[2].lastChild;u.className=s?"failure":"success",u.style.width=parseInt(100*o)+"%",n.getElementsByTagName("td")[3].innerHTML=parseInt(1e4*o)/100+"%"}this._groupTotalTime+=a,this.debug(r?"PASSED":"FAILED","test:",t.name,a,"ms")},l._registerUrl=function(e,t,r,n,i){e=e||t,this._registerTest(e,{name:t,setUp:function(){l.currentGroupName=e,l.currentGroup=this,l.currentUrl=t,l.dohArgs=i,this.d=new l.Deferred,l.currentTestDeferred=this.d,l.showTestPage(),p("testBody").src=t},timeout:r||1e4,runTest:function(){return this.d},tearDown:function(){l.currentGroupName=null,l.currentGroup=null,l.currentTestDeferred=null,l.currentUrl=null,l.showLogPage()}},n)};var G=1,P=function(e,t){var r;for(r=0;r<t.length;r++){var n=p(t[r]);n&&(n.style.display="none")}e=p(e),e&&(e.style.display="",e.style.zIndex=++G)};l.showTestPage=function(){P("testBody",["logBody","perfTestsBody"])},l.showLogPage=function(){P("logBody",["testBody","perfTestsBody"])},l.showPerfTestsPage=function(){P("perfTestsBody",["testBody","logBody"])};var F=!0;l.toggleRunAll=function(){if(F=!F,p("testList"))for(var e,t=p("testList").tBodies[0],r=t.getElementsByTagName("input"),n=0;e=r[n++];)e.checked=F,l._groups[e.group].skip=!F};var H=null,j=function(){H&&clearTimeout(H);var e=p("testList");e&&(H=setTimeout(function(){e.style.display="none",e.style.display=""},10))};m("resize",j),m("load",j),m("load",function(){b||(b=!0,E=p("groupTemplate"),E&&(E.parentNode.removeChild(E),E.style.display="",w=p("testTemplate"),w.parentNode.removeChild(w),w.style.display="",l._updateTestList()))}),m("load",function(){var e=l._onEnd;if(l._onEnd=function(){e.apply(l,arguments),0==l._failureCount&&(l.debug("WOOHOO!!"),S("woohoo")),p("play")&&r()},p("play")){var t=!1,r=function(){t?(p("play").style.display=p("pausedMsg").style.display="",p("playingMsg").style.display=p("pause").style.display="none",t=!1):(p("play").style.display=p("pausedMsg").style.display="none",p("playingMsg").style.display=p("pause").style.display="",t=!0)};l.run=function(e){return function(){return l._currentGroup||r(),e.apply(l,arguments)}}(l.run);for(var n,i=p("toggleButtons").getElementsByTagName("span"),a=0;n=i[a++];)n.onclick=r}})}else{var D=window.parent.doh,O=D.currentGroupName,k=D.currentUrl;O&&(l._onEnd=function(){D._errorCount+=l._errorCount,D._failureCount+=l._failureCount,D._testCount+=l._testCount,D.currentTestDeferred.callback(!0)},l._testRegistered=function(e,t){t.name=k+"::"+arguments[0]+"::"+t.name,D._updateTestList(O,t)},l.debug=i.hitch(D,"debug"),l.error=i.hitch(D,"error"),l.registerUrl=i.hitch(D,"registerUrl"),l._testStarted=function(e,t){D._testStarted(O,t)},l._testFinished=function(e,t,r){if(D._testFinished(O,t,r),l.perfTestResults)try{for(var n=e.toString(),i=t.name;i.indexOf("::")>=0;)i=i.substring(i.indexOf("::")+2,i.length);D.perfTestResults||(D.perfTestResults={}),D.perfTestResults[n]||(D.perfTestResults[n]={}),D.perfTestResults[n][t.name]=l.perfTestResults[n][i]}catch(a){l.debug(a)}},l._groupStarted=function(){this._setParent||(D._curTestCount=this._testCount,D._curGroupCount=this._groupCount,this._setParent=!0)},l._report=function(){})}var U=l._fixHeight=function(){if(s("ie")){for(var r=0,n=a("#testLayout > tbody > tr"),i=0;i<n.length-1;i++)r+=t.position(n[i]).h;try{e.byId("testLayout").style.height=u.getBox().h-r+"px"}catch(o){setTimeout(function(){U()},0)}}};return l});