define("util/less/lib/less/tree/ruleset",["dojo","dijit","dojox"],function(e,t,s){!function(e){e.Ruleset=function(e,t,s){this.selectors=e,this.rules=t,this._lookups={},this.strictImports=s},e.Ruleset.prototype={eval:function(t){var s,n=this.selectors&&this.selectors.map(function(e){return e.eval(t)}),l=new e.Ruleset(n,this.rules.slice(0),this.strictImports);l.originalRuleset=this,l.root=this.root,l.allowImports=this.allowImports,this.debugInfo&&(l.debugInfo=this.debugInfo),t.frames.unshift(l),(l.root||l.allowImports||!l.strictImports)&&l.evalImports(t);for(var r=0;r<l.rules.length;r++)l.rules[r]instanceof e.mixin.Definition&&(l.rules[r].frames=t.frames.slice(0));for(var i=t.mediaBlocks&&t.mediaBlocks.length||0,r=0;r<l.rules.length;r++)l.rules[r]instanceof e.mixin.Call&&(s=l.rules[r].eval(t),l.rules.splice.apply(l.rules,[r,1].concat(s)),r+=s.length-1,l.resetCache());for(var o,r=0;r<l.rules.length;r++)o=l.rules[r],o instanceof e.mixin.Definition||(l.rules[r]=o.eval?o.eval(t):o);if(t.frames.shift(),t.mediaBlocks)for(var r=i;r<t.mediaBlocks.length;r++)t.mediaBlocks[r].bubbleSelectors(n);return l},evalImports:function(t){var s,n;for(s=0;s<this.rules.length;s++)this.rules[s]instanceof e.Import&&(n=this.rules[s].eval(t),"number"==typeof n.length?(this.rules.splice.apply(this.rules,[s,1].concat(n)),s+=n.length-1):this.rules.splice(s,1,n),this.resetCache())},makeImportant:function(){return new e.Ruleset(this.selectors,this.rules.map(function(e){return e.makeImportant?e.makeImportant():e}),this.strictImports)},matchArgs:function(e){return!e||0===e.length},resetCache:function(){this._rulesets=null,this._variables=null,this._lookups={}},variables:function(){return this._variables?this._variables:this._variables=this.rules.reduce(function(t,s){return s instanceof e.Rule&&s.variable===!0&&(t[s.name]=s),t},{})},variable:function(e){return this.variables()[e]},rulesets:function(){return this._rulesets?this._rulesets:this._rulesets=this.rules.filter(function(t){return t instanceof e.Ruleset||t instanceof e.mixin.Definition})},find:function(t,s){s=s||this;var n,l=[],r=t.toCSS();return r in this._lookups?this._lookups[r]:(this.rulesets().forEach(function(r){if(r!==s)for(var i=0;i<r.selectors.length;i++)if(n=t.match(r.selectors[i])){t.elements.length>r.selectors[i].elements.length?Array.prototype.push.apply(l,r.find(new e.Selector(t.elements.slice(1)),s)):l.push(r);break}}),this._lookups[r]=l)},toCSS:function(t,s){var n,l,r,i=[],o=[],u=[],h=[],c=[];this.root||this.joinSelectors(c,t,this.selectors);for(var a=0;a<this.rules.length;a++)if(r=this.rules[a],r.rules||r instanceof e.Media)h.push(r.toCSS(c,s));else if(r instanceof e.Directive){var f=r.toCSS(c,s);if("@charset"===r.name){if(s.charset){r.debugInfo&&(h.push(e.debugInfo(s,r)),h.push(new e.Comment("/* "+f.replace(/\n/g,"")+" */\n").toCSS(s)));continue}s.charset=!0}h.push(f)}else r instanceof e.Comment?r.silent||(this.root?h.push(r.toCSS(s)):o.push(r.toCSS(s))):r.toCSS&&!r.variable?o.push(r.toCSS(s)):r.value&&!r.variable&&o.push(r.value.toString());if(h=h.join(""),this.root)i.push(o.join(s.compress?"":"\n"));else if(o.length>0){l=e.debugInfo(s,this),n=c.map(function(e){return e.map(function(e){return e.toCSS(s)}).join("").trim()}).join(s.compress?",":",\n");for(var a=o.length-1;a>=0;a--)-1===u.indexOf(o[a])&&u.unshift(o[a]);o=u,i.push(l+n+(s.compress?"{":" {\n  ")+o.join(s.compress?"":"\n  ")+(s.compress?"}":"\n}\n"))}return i.push(h),i.join("")+(s.compress?"\n":"")},joinSelectors:function(e,t,s){for(var n=0;n<s.length;n++)this.joinSelector(e,t,s[n])},joinSelector:function(t,s,n){var l,r,i,o,u,h,c,a,f,m,p,g,v,S,b;for(l=0;l<n.elements.length;l++)h=n.elements[l],"&"===h.value&&(o=!0);if(o){for(S=[],u=[[]],l=0;l<n.elements.length;l++)if(h=n.elements[l],"&"!==h.value)S.push(h);else{for(b=[],S.length>0&&this.mergeElementsOnToSelectors(S,u),r=0;r<u.length;r++)if(c=u[r],0==s.length)c.length>0&&(c[0].elements=c[0].elements.slice(0),c[0].elements.push(new e.Element(h.combinator,"",0))),b.push(c);else for(i=0;i<s.length;i++)a=s[i],f=[],m=[],g=!0,c.length>0?(f=c.slice(0),v=f.pop(),p=new e.Selector(v.elements.slice(0)),g=!1):p=new e.Selector([]),a.length>1&&(m=m.concat(a.slice(1))),a.length>0&&(g=!1,p.elements.push(new e.Element(h.combinator,a[0].elements[0].value,0)),p.elements=p.elements.concat(a[0].elements.slice(1))),g||f.push(p),f=f.concat(m),b.push(f);u=b,S=[]}for(S.length>0&&this.mergeElementsOnToSelectors(S,u),l=0;l<u.length;l++)t.push(u[l])}else if(s.length>0)for(l=0;l<s.length;l++)t.push(s[l].concat(n));else t.push([n])},mergeElementsOnToSelectors:function(t,s){var n,l;if(0==s.length)return void s.push([new e.Selector(t)]);for(n=0;n<s.length;n++)l=s[n],l.length>0?l[l.length-1]=new e.Selector(l[l.length-1].elements.concat(t)):l.push(new e.Selector(t))}}}(require("../tree"))});