define("util/less/lib/less/parser",["dojo","dijit","dojox"],function(e,t,n){var i,r;"object"==typeof environment&&"[object Environment]"==={}.toString.call(environment)?(i="undefined"==typeof window?{}:window.less={},r=i.tree={},i.mode="rhino"):"undefined"==typeof window?(i=exports,r=require("./tree"),i.mode="node"):("undefined"==typeof window.less&&(window.less={}),i=window.less,r=window.less.tree={},i.mode="browser"),i.Parser=function(e){function t(){y=k[g],x=b,C=b}function n(){k[g]=y,b=x,C=b}function o(){b>C&&(k[g]=k[g].slice(b-C),C=b)}function s(e){var t=e.charCodeAt(0);return 32===t||10===t||9===t}function a(e){var t,n;if(e instanceof Function)return e.call(F.parsers);if("string"==typeof e)t=w.charAt(b)===e?e:null,n=1,o();else{if(o(),!(t=e.exec(k[g])))return null;n=t[0].length}return t?(u(n),"string"==typeof t?t:1===t.length?t[0]:t):void 0}function u(e){for(var t=b,n=g,i=b+k[g].length,r=b+=e;i>b&&s(w.charAt(b));)b++;return k[g]=k[g].slice(e+(b-r)),C=b,0===k[g].length&&g<k.length-1&&g++,t!==b||n!==g}function l(e,t){var n=a(e);return n?n:void c(t||("string"==typeof e?"expected '"+e+"' got '"+w.charAt(b)+"'":"unexpected token"))}function c(e,t){var n=new Error(e);throw n.index=b,n.type=t||"Syntax",n}function h(e){return"string"==typeof e?w.charAt(b)===e:e.test(k[g])?!0:!1}function f(e,t){return e.filename&&t.filename&&e.filename!==t.filename?F.imports.contents[e.filename]:w}function d(e,t){for(var n=e,i=-1;n>=0&&"\n"!==t.charAt(n);n--)i++;return{line:"number"==typeof e?(t.slice(0,e).match(/\n/g)||"").length:null,column:i}}function m(e){return"browser"===i.mode||"rhino"===i.mode?e.filename:require("path").resolve(e.filename)}function p(e,t,n){return{lineNumber:d(e,t).line+1,fileName:m(n)}}function v(e,t){var n=f(e,t),i=d(e.index,n),r=i.line,o=i.column,s=n.split("\n");this.type=e.type||"Syntax",this.message=e.message,this.filename=e.filename||t.filename,this.index=e.index,this.line="number"==typeof r?r+1:null,this.callLine=e.call&&d(e.call,n).line+1,this.callExtract=s[d(e.call,n).line],this.stack=e.stack,this.column=o,this.extract=[s[r-1],s[r],s[r+1]]}var w,b,g,y,x,A,k,C,F,e=e||{};e.contents||(e.contents={}),e.rootpath=e.rootpath||"",e.files||(e.files={});var S=function(){},q=this.imports={paths:e.paths||[],queue:[],files:e.files,contents:e.contents,mime:e.mime,error:null,push:function(t,n){var r=this;this.queue.push(t),i.Parser.importer(t,this.paths,function(e,i,o){r.queue.splice(r.queue.indexOf(t),1);var s=o in r.files;r.files[o]=i,e&&!r.error&&(r.error=e),n(e,i,s),0===r.queue.length&&S(r.error)},e)}};return this.env=e=e||{},this.optimization="optimization"in this.env?this.env.optimization:1,this.env.filename=this.env.filename||null,F={imports:q,parse:function(t,n){var o,s,u,l=null;if(b=g=C=A=0,w=t.replace(/\r\n/g,"\n"),w=w.replace(/^\uFEFF/,""),k=function(t){for(var n,i,r,o,s=0,a=/(?:@\{[\w-]+\}|[^"'`\{\}\/\(\)\\])+/g,u=/\/\*(?:[^*]|\*+[^\/*])*\*+\/|\/\/.*/g,c=/"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'|`((?:[^`]|\\.)*)`/g,h=0,f=t[0],d=0;d<w.length;)if(a.lastIndex=d,(n=a.exec(w))&&n.index===d&&(d+=n[0].length,f.push(n[0])),r=w.charAt(d),u.lastIndex=c.lastIndex=d,(n=c.exec(w))&&n.index===d)d+=n[0].length,f.push(n[0]);else if(i||"/"!==r||(o=w.charAt(d+1),"/"!==o&&"*"!==o||!(n=u.exec(w))||n.index!==d)){switch(r){case"{":if(!i){h++,f.push(r);break}case"}":if(!i){h--,f.push(r),t[++s]=f=[];break}case"(":if(!i){i=!0,f.push(r);break}case")":if(i){i=!1,f.push(r);break}default:f.push(r)}d++}else d+=n[0].length,f.push(n[0]);return 0!=h&&(l=new v({index:d-1,type:"Parse",message:h>0?"missing closing `}`":"missing opening `{`",filename:e.filename},e)),t.map(function(e){return e.join("")})}([[]]),l)return n(l,e);try{o=new r.Ruleset([],a(this.parsers.primary)),o.root=!0}catch(c){return n(new v(c,e))}if(o.toCSS=function(t){return function(n,o){var s,a=[];n=n||{},"object"!=typeof o||Array.isArray(o)||(o=Object.keys(o).map(function(e){var t=o[e];return t instanceof r.Value||(t instanceof r.Expression||(t=new r.Expression([t])),t=new r.Value([t])),new r.Rule("@"+e,t,!1,0)}),a=[new r.Ruleset(null,o)]);try{var u=t.call(this,{frames:a}).toCSS([],{compress:n.compress||!1,dumpLineNumbers:e.dumpLineNumbers})}catch(l){throw new v(l,e)}if(s=F.imports.error)throw s instanceof v?s:new v(s,e);return n.yuicompress&&"node"===i.mode?require("ycssmin").cssmin(u):n.compress?u.replace(/(\s)+/g,"$1"):u}}(o.eval),b<w.length-1){b=A,u=w.split("\n"),s=(w.slice(0,b).match(/\n/g)||"").length+1;for(var h=b,f=-1;h>=0&&"\n"!==w.charAt(h);h--)f++;l={type:"Parse",message:"Syntax Error on line "+s,index:b,filename:e.filename,line:s,column:f,extract:[u[s-2],u[s-1],u[s]]}}this.imports.queue.length>0?S=function(e){e=l||e,e?n(e):n(null,o)}:n(l,o)},parsers:{primary:function(){for(var e,t=[];(e=a(this.mixin.definition)||a(this.rule)||a(this.ruleset)||a(this.mixin.call)||a(this.comment)||a(this.directive))||a(/^[\s\n]+/)||a(/^;+/);)e&&t.push(e);return t},comment:function(){var e;if("/"===w.charAt(b))return"/"===w.charAt(b+1)?new r.Comment(a(/^\/\/.*/),!0):(e=a(/^\/\*(?:[^*]|\*+[^\/*])*\*+\/\n?/))?new r.Comment(e):void 0},entities:{quoted:function(){var e,t,n=b;return"~"===w.charAt(n)&&(n++,t=!0),'"'===w.charAt(n)||"'"===w.charAt(n)?(t&&a("~"),(e=a(/^"((?:[^"\\\r\n]|\\.)*)"|'((?:[^'\\\r\n]|\\.)*)'/))?new r.Quoted(e[0],e[1]||e[2],t):void 0):void 0},keyword:function(){var e;return(e=a(/^[_A-Za-z-][_A-Za-z0-9-]*/))?r.colors.hasOwnProperty(e)?new r.Color(r.colors[e].slice(1)):new r.Keyword(e):void 0},call:function(){var t,n,i,o,s=b;if(t=/^([\w-]+|%|progid:[\w\.]+)\(/.exec(k[g])){if(t=t[1],n=t.toLowerCase(),"url"===n)return null;if(b+=t.length,"alpha"===n&&(o=a(this.alpha),"undefined"!=typeof o))return o;if(a("("),i=a(this.entities.arguments),a(")"))return t?new r.Call(t,i,s,e.filename):void 0}},arguments:function(){for(var e,t=[];(e=a(this.entities.assignment)||a(this.expression))&&(t.push(e),a(",")););return t},literal:function(){return a(this.entities.ratio)||a(this.entities.dimension)||a(this.entities.color)||a(this.entities.quoted)||a(this.entities.unicodeDescriptor)},assignment:function(){var e,t;return(e=a(/^\w+(?=\s?=)/i))&&a("=")&&(t=a(this.entity))?new r.Assignment(e,t):void 0},url:function(){var t;if("u"===w.charAt(b)&&a(/^url\(/))return t=a(this.entities.quoted)||a(this.entities.variable)||a(/^(?:(?:\\[\(\)'"])|[^\(\)'"])+/)||"",l(")"),new r.URL(null!=t.value||t instanceof r.Variable?t:new r.Anonymous(t),e.rootpath)},variable:function(){var t,n=b;return"@"===w.charAt(b)&&(t=a(/^@@?[\w-]+/))?new r.Variable(t,n,e.filename):void 0},variableCurly:function(){var t,n=b;return"@"===w.charAt(b)&&(t=a(/^@\{([\w-]+)\}/))?new r.Variable("@"+t[1],n,e.filename):void 0},color:function(){var e;return"#"===w.charAt(b)&&(e=a(/^#([A-Fa-f0-9]{6}|[A-Fa-f0-9]{3})/))?new r.Color(e[1]):void 0},dimension:function(){var e,t=w.charCodeAt(b);if(!(t>57||43>t||47===t||44==t))return(e=a(/^([+-]?\d*\.?\d+)(px|%|em|pc|ex|in|deg|s|ms|pt|cm|mm|rad|grad|turn|dpi|dpcm|dppx|rem|vw|vh|vmin|vm|ch)?/))?new r.Dimension(e[1],e[2]):void 0},ratio:function(){var e,t=w.charCodeAt(b);if(!(t>57||48>t))return(e=a(/^(\d+\/\d+)/))?new r.Ratio(e[1]):void 0},unicodeDescriptor:function(){var e;return(e=a(/^U\+[0-9a-fA-F?]+(\-[0-9a-fA-F?]+)?/))?new r.UnicodeDescriptor(e[0]):void 0},javascript:function(){var e,t,n=b;return"~"===w.charAt(n)&&(n++,t=!0),"`"===w.charAt(n)?(t&&a("~"),(e=a(/^`([^`]*)`/))?new r.JavaScript(e[1],b,t):void 0):void 0}},variable:function(){var e;return"@"===w.charAt(b)&&(e=a(/^(@[\w-]+)\s*:/))?e[1]:void 0},shorthand:function(){var e,i;if(h(/^[@\w.%-]+\/[@\w.-]+/))return t(),(e=a(this.entity))&&a("/")&&(i=a(this.entity))?new r.Shorthand(e,i):void n()},mixin:{call:function(){var i,o,s,u,f,d,m,p,v,g,y=[],x=[],A=[],k=b,C=w.charAt(b),F=!1;if("."===C||"#"===C){for(t();i=a(/^[#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/);)y.push(new r.Element(o,i,b)),o=a(">");if(a("(")){for(d=[];u=a(this.expression);){if(f=null,g=u,1==u.value.length){var S=u.value[0];S instanceof r.Variable&&a(":")&&(d.length>0&&(m&&c("Cannot mix ; and , as delimiter types"),p=!0),g=l(this.expression),f=v=S.name)}d.push(g),A.push({name:f,value:g}),a(",")||(a(";")||m)&&(p&&c("Cannot mix ; and , as delimiter types"),m=!0,d.length>1&&(g=new r.Value(d)),x.push({name:v,value:g}),v=null,d=[],p=!1)}l(")")}return s=m?x:A,a(this.important)&&(F=!0),y.length>0&&(a(";")||h("}"))?new r.mixin.Call(y,s,k,e.filename,F):void n()}},definition:function(){var e,i,o,s,u,c,f=[],d=!1;if(!("."!==w.charAt(b)&&"#"!==w.charAt(b)||h(/^[^{]*\}/))&&(t(),i=a(/^([#.](?:[\w-]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+)\s*\(/))){e=i[1];do{if(a(this.comment),"."===w.charAt(b)&&a(/^\.{3}/)){d=!0,f.push({variadic:!0});break}if(!(s=a(this.entities.variable)||a(this.entities.literal)||a(this.entities.keyword)))break;if(s instanceof r.Variable)if(a(":"))u=l(this.expression,"expected expression"),f.push({name:s.name,value:u});else{if(a(/^\.{3}/)){f.push({name:s.name,variadic:!0}),d=!0;break}f.push({name:s.name})}else f.push({value:s})}while(a(",")||a(";"));if(a(")")||(A=b,n()),a(this.comment),a(/^when/)&&(c=l(this.conditions,"expected condition")),o=a(this.block))return new r.mixin.Definition(e,f,o,c,d);n()}}},entity:function(){return a(this.entities.literal)||a(this.entities.variable)||a(this.entities.url)||a(this.entities.call)||a(this.entities.keyword)||a(this.entities.javascript)||a(this.comment)},end:function(){return a(";")||h("}")},alpha:function(){var e;if(a(/^\(opacity=/i))return(e=a(/^\d+/)||a(this.entities.variable))?(l(")"),new r.Alpha(e)):void 0},element:function(){var e,t,n;return t=a(this.combinator),e=a(/^(?:\d+\.\d+|\d+)%/)||a(/^(?:[.#]?|:*)(?:[\w-]|[^\x00-\x9f]|\\(?:[A-Fa-f0-9]{1,6} ?|[^A-Fa-f0-9]))+/)||a("*")||a("&")||a(this.attribute)||a(/^\([^()@]+\)/)||a(/^[\.#](?=@)/)||a(this.entities.variableCurly),e||a("(")&&(n=a(this.entities.variableCurly)||a(this.entities.variable)||a(this.selector))&&a(")")&&(e=new r.Paren(n)),e?new r.Element(t,e,b):void 0},combinator:function(){var e=w.charAt(b);if(">"===e||"+"===e||"~"===e||"|"===e){for(b++;w.charAt(b).match(/\s/);)b++;return new r.Combinator(e)}return w.charAt(b-1).match(/\s/)?new r.Combinator(" "):new r.Combinator(null)},selector:function(){var e,t,n,i=[];if(a("("))return e=a(this.entity),a(")")?new r.Selector([new r.Element("",e,b)]):null;for(;(t=a(this.element))&&(n=w.charAt(b),i.push(t),"{"!==n&&"}"!==n&&";"!==n&&","!==n&&")"!==n););return i.length>0?new r.Selector(i):void 0},attribute:function(){var e,t,n,i="";if(a("[")&&((e=a(/^(?:[_A-Za-z0-9-]|\\.)+/)||a(this.entities.quoted))&&(i=(n=a(/^[|~*$^]?=/))&&(t=a(this.entities.quoted)||a(/^[\w-]+/))?[e,n,t.toCSS?t.toCSS():t].join(""):e),a("]")))return i?"["+i+"]":void 0},block:function(){var e;return a("{")&&(e=a(this.primary))&&a("}")?e:void 0},ruleset:function(){var i,o,s,u=[];for(t(),e.dumpLineNumbers&&(s=p(b,w,e));(i=a(this.selector))&&(u.push(i),a(this.comment),a(","));)a(this.comment);if(u.length>0&&(o=a(this.block))){var l=new r.Ruleset(u,o,e.strictImports);return e.dumpLineNumbers&&(l.debugInfo=s),l}A=b,n()},rule:function(){var e,i,o,s,u=w.charAt(b);if(t(),"."!==u&&"#"!==u&&"&"!==u&&(e=a(this.variable)||a(this.property))){if("@"!=e.charAt(0)&&(s=/^([^@+\/'"*`(;{}-]*);/.exec(k[g]))?(b+=s[0].length-1,i=new r.Anonymous(s[1])):i=a("font"===e?this.font:this.value),o=a(this.important),i&&a(this.end))return new r.Rule(e,i,o,x);A=b,n()}},"import":function(){var i,o,s=b;t();var u=a(/^@import(?:-(once))?\s+/);return u&&(i=a(this.entities.quoted)||a(this.entities.url))&&(o=a(this.mediaFeatures),a(";"))?new r.Import(i,q,o,"once"===u[1],s,e.rootpath):void n()},mediaFeature:function(){var e,t,n=[];do if(e=a(this.entities.keyword))n.push(e);else if(a("(")){if(t=a(this.property),e=a(this.entity),!a(")"))return null;if(t&&e)n.push(new r.Paren(new r.Rule(t,e,null,b,!0)));else{if(!e)return null;n.push(new r.Paren(e))}}while(e);return n.length>0?new r.Expression(n):void 0},mediaFeatures:function(){var e,t=[];do if(e=a(this.mediaFeature)){if(t.push(e),!a(","))break}else if((e=a(this.entities.variable))&&(t.push(e),!a(",")))break;while(e);return t.length>0?t:null},media:function(){var t,n,i,o;return e.dumpLineNumbers&&(o=p(b,w,e)),a(/^@media/)&&(t=a(this.mediaFeatures),n=a(this.block))?(i=new r.Media(n,t),e.dumpLineNumbers&&(i.debugInfo=o),i):void 0},directive:function(){var i,o,s,u,l,c,h;if("@"===w.charAt(b)){if(o=a(this["import"])||a(this.media))return o;if(t(),i=a(/^@[a-z-]+/)){switch(u=i,"-"==i.charAt(1)&&i.indexOf("-",2)>0&&(u="@"+i.slice(i.indexOf("-",2)+1)),u){case"@font-face":l=!0;break;case"@viewport":case"@top-left":case"@top-left-corner":case"@top-center":case"@top-right":case"@top-right-corner":case"@bottom-left":case"@bottom-left-corner":case"@bottom-center":case"@bottom-right":case"@bottom-right-corner":case"@left-top":case"@left-middle":case"@left-bottom":case"@right-top":case"@right-middle":case"@right-bottom":l=!0;break;case"@page":case"@document":case"@supports":case"@keyframes":l=!0,c=!0;break;case"@namespace":h=!0}if(c&&(i+=" "+(a(/^[^{]+/)||"").trim()),l){if(s=a(this.block))return new r.Directive(i,s)}else if((o=a(h?this.expression:this.entity))&&a(";")){var f=new r.Directive(i,o);return e.dumpLineNumbers&&(f.debugInfo=p(b,w,e)),f}n()}}},font:function(){for(var e,t=[],n=[];e=a(this.shorthand)||a(this.entity);)n.push(e);if(t.push(new r.Expression(n)),a(","))for(;(e=a(this.expression))&&(t.push(e),a(",")););return new r.Value(t)},value:function(){for(var e,t=[];(e=a(this.expression))&&(t.push(e),a(",")););return t.length>0?new r.Value(t):void 0},important:function(){return"!"===w.charAt(b)?a(/^! *important/):void 0},sub:function(){var e;return a("(")&&(e=a(this.expression))&&a(")")?e:void 0},multiplication:function(){var e,t,n,i;if(e=a(this.operand)){for(;!h(/^\/[*\/]/)&&(n=a("/")||a("*"))&&(t=a(this.operand));)i=new r.Operation(n,[i||e,t]);return i||e}},addition:function(){var e,t,n,i;if(e=a(this.multiplication)){for(;(n=a(/^[-+]\s+/)||!s(w.charAt(b-1))&&(a("+")||a("-")))&&(t=a(this.multiplication));)i=new r.Operation(n,[i||e,t]);return i||e}},conditions:function(){var e,t,n,i=b;if(e=a(this.condition)){for(;a(",")&&(t=a(this.condition));)n=new r.Condition("or",n||e,t,i);return n||e}},condition:function(){var e,t,n,i,o=b,s=!1;return a(/^not/)&&(s=!0),l("("),(e=a(this.addition)||a(this.entities.keyword)||a(this.entities.quoted))?((i=a(/^(?:>=|=<|[<=>])/))?(t=a(this.addition)||a(this.entities.keyword)||a(this.entities.quoted))?n=new r.Condition(i,e,t,o,s):c("expected expression"):n=new r.Condition("=",e,new r.Keyword("true"),o,s),l(")"),a(/^and/)?new r.Condition("and",n,a(this.condition)):n):void 0},operand:function(){var e,t=w.charAt(b+1);"-"!==w.charAt(b)||"@"!==t&&"("!==t||(e=a("-"));var n=a(this.sub)||a(this.entities.dimension)||a(this.entities.color)||a(this.entities.variable)||a(this.entities.call);return e?new r.Operation("*",[new r.Dimension(-1),n]):n},expression:function(){for(var e,t=[];e=a(this.addition)||a(this.entity);)t.push(e);return t.length>0?new r.Expression(t):void 0},property:function(){var e;return(e=a(/^(\*?-?[_a-z0-9-]+)\s*:/))?e[1]:void 0}}}},("browser"===i.mode||"rhino"===i.mode)&&(i.Parser.importer=function(e,t,n,i){!/^([a-z-]+:)?\//.test(e)&&t.length>0&&(e=t[0]+e),loadStyleSheet({href:e,title:e,type:i.mime,contents:i.contents,files:i.files,rootpath:i.rootpath,entryPath:i.entryPath,relativeUrls:i.relativeUrls},function(e,r,o,s,a,u){e&&"function"==typeof i.errback?i.errback.call(null,u,t,n,i):n.call(null,e,r,u)},!0)})});