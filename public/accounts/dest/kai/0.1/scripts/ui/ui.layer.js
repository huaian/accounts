define("ui/ui.layer",["./ui.abstract.view","./ui.mask","plugin/c.plugins"],function(t,i){return _.inherit(t,{propertys:function($super){$super(),this.mask=new i,this.type="layer",this.resetDefaultProperty()},resetDefaultProperty:function(){this.mask.resetDefaultProperty(),this.needMask=!0,this.needAnimat=!0,this.maskToHide=!0,this.needReposition=!0,this.hasPushState=history&&history.pushState,this.hasPushState=!1,this.historyBack=!1,this.animateInClass="cm-up-in",this.animateOutClass="cm-up-out",this.animateShowAction=null,this.animateHideAction=null,this.events={touchmove:"_preventDefault"}},initialize:function($super,t){$super(t),this.clearRes()},resetPropery:function(){var t=this;this.needAnimat&&(this.animateShowAction||(this.animateShowAction=function(i){var s=!1;i.show(),i.addClass(t.animateInClass),i.one($.fx.animationEnd,function(){s=!0,i.removeClass(t.animateInClass)}),setTimeout(function(){s||(i.removeClass(t.animateInClass),$.fx.animationEnd&&i.off($.fx.animationEnd))},350)}),this.animateHideAction||(this.animateHideAction=function(i){var s=!1;i.addClass(t.animateOutClass),i.one($.fx.animationEnd,function(){s=!0,i.removeClass(t.animateOutClass),i.hide()}),setTimeout(function(){s||(i.removeClass(t.animateOutClass),i.off($.fx.animationEnd),i.hide())},350)})),this.mask.needAnimat=!1,this.needAnimat&&this.animateHideAction?this.mask.animateHideAction=function(i){var s=!1;i.addClass(t.mask.animateOutClass),i.one($.fx.animationEnd,function(){s=!0,i.removeClass(t.mask.animateOutClass),i.hide()}),setTimeout(function(){s||(i.removeClass(t.mask.animateOutClass),i.off($.fx.animationEnd),i.hide())},350)}:this.mask.animateHideAction=null,this._setMaskEvent()},_setMaskEvent:function(){var t=this;this.needMask&&this.maskToHide&&this.mask.addEvents({click:function(){t.hide()}})},clearRes:function(){},_addPushStateEvent:function(){this.hasPushState&&(history.pushState({},document.title,location.href),this.historyBack=!1,$(window).on("popstate.pageviewpopstate"+this.id,$.proxy(function(t){this.historyBack=!0,this.hide()},this)))},_removePushStateEvent:function(){this.hasPushState&&$(window).off(".pageviewpopstate"+this.id)},addEvent:function(){this.on("onCreate",function(){this.$el.addClass("cui-layer")}),this.on("onPreShow",function(){this.needMask&&this.mask.show()}),this.on("onShow",function(){this.setzIndexTop(),this._addPushStateEvent(),this.needReposition&&this.reposition()}),this.on("onPreHide",function(){return this.hasPushState&&!this.historyBack?void history.back():void 0}),this.on("onHide",function(){(!this.hasPushState||this.historyBack)&&(this.mask.hide(),this._removePushStateEvent())}),this.on("onDestroy",function(){this.mask.destroy()})},reposition:function(){this.$el.css({"margin-left":-(this.$el.width()/2)+"px","margin-top":-(this.$el.height()/2)+"px"})}})});