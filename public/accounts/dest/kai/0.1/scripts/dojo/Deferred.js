define("dojo/Deferred",["./has","./_base/lang","./errors/CancelError","./promise/Promise","require"],function(e,r,n,t,i){"use strict";var f=0,c=1,o=2,u="This deferred has already been fulfilled.",s=Object.freeze||function(){},l=function(e,r,n,t,i){for(var f=0;f<e.length;f++)a(e[f],r,n,t)},a=function(e,r,n,t){var i=e[r],u=e.deferred;if(i)try{var s=i(n);if(r===f)"undefined"!=typeof s&&h(u,r,s);else{if(s&&"function"==typeof s.then)return e.cancel=s.cancel,void s.then(d(u,c),d(u,o),d(u,f));h(u,c,s)}}catch(l){h(u,o,l)}else h(u,r,n)},d=function(e,r){return function(n){h(e,r,n)}},h=function(e,r,n){if(!e.isCanceled())switch(r){case f:e.progress(n);break;case c:e.resolve(n);break;case o:e.reject(n)}},v=function(e){var r,i,d,h=this.promise=new t,p=this,w=!1,j=[];this.isResolved=h.isResolved=function(){return r===c},this.isRejected=h.isRejected=function(){return r===o},this.isFulfilled=h.isFulfilled=function(){return!!r},this.isCanceled=h.isCanceled=function(){return w},this.progress=function(e,n){if(r){if(n===!0)throw new Error(u);return h}return l(j,f,e,null,p),h},this.resolve=function(e,n){if(r){if(n===!0)throw new Error(u);return h}return l(j,r=c,i=e,null,p),j=null,h};var y=this.reject=function(e,n){if(r){if(n===!0)throw new Error(u);return h}return l(j,r=o,i=e,d,p),j=null,h};this.then=h.then=function(e,n,t){var f=[t,e,n];return f.cancel=h.cancel,f.deferred=new v(function(e){return f.cancel&&f.cancel(e)}),r&&!j?a(f,r,i,d):j.push(f),f.deferred.promise},this.cancel=h.cancel=function(t,f){if(r){if(f===!0)throw new Error(u)}else{if(e){var c=e(t);t="undefined"==typeof c?t:c}if(w=!0,!r)return"undefined"==typeof t&&(t=new n),y(t),t;if(r===o&&i===t)return t}},s(h)};return v.prototype.toString=function(){return"[object Deferred]"},i&&i(v),v});