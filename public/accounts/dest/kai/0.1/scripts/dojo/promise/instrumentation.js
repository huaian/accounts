define("dojo/promise/instrumentation",["./tracer","../has","../_base/lang","../_base/array"],function(e,t,n,r){function o(e,t,n){var r="";e&&e.stack&&(r+=e.stack),t&&t.stack&&(r+="\n    ----------------------------------------\n    rejected"+t.stack.split("\n").slice(1).join("\n").replace(/^\s+/," ")),n&&n.stack&&(r+="\n    ----------------------------------------\n"+n.stack)}function s(e,t,n,r){t||o(e,n,r)}function i(e,t,n,o){r.some(c,function(n){return n.error===e?(t&&(n.handled=!0),!0):void 0})||c.push({error:e,rejection:n,handled:t,deferred:o,timestamp:(new Date).getTime()}),d||(d=setTimeout(a,u))}function a(){var e=(new Date).getTime(),t=e-u;c=r.filter(c,function(e){return e.timestamp<t?(e.handled||o(e.error,e.rejection,e.deferred),!1):!0}),d=c.length?setTimeout(a,c[0].timestamp+u-e):!1}t.add("config-useDeferredInstrumentation","report-unhandled-rejections");var c=[],d=!1,u=1e3;return function(r){var o=t("config-useDeferredInstrumentation");if(o){e.on("resolved",n.hitch(console,"log","resolved")),e.on("rejected",n.hitch(console,"log","rejected")),e.on("progress",n.hitch(console,"log","progress"));var a=[];if("string"==typeof o&&(a=o.split(","),o=a.shift()),"report-rejections"===o)r.instrumentRejected=s;else{if("report-unhandled-rejections"!==o&&o!==!0&&1!==o)throw new Error("Unsupported instrumentation usage <"+o+">");r.instrumentRejected=i,u=parseInt(a[0],10)||u}}}});