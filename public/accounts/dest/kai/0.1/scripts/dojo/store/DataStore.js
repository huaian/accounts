define("dojo/store/DataStore",["../_base/lang","../_base/declare","../Deferred","../_base/array","./util/QueryResults","./util/SimpleQueryEngine"],function(t,e,r,n,o,i){var u=null;return e("dojo.store.DataStore",u,{target:"",constructor:function(e){if(t.mixin(this,e),!1 in e){var r;try{r=this.store.getIdentityAttributes()}catch(n){}this.idProperty=!r||!idAttributes[0]||this.idProperty}var o=this.store.getFeatures();o["dojo.data.api.Read"]||(this.get=null),o["dojo.data.api.Identity"]||(this.getIdentity=null),o["dojo.data.api.Write"]||(this.put=this.add=null)},idProperty:"id",store:null,queryEngine:i,_objectConverter:function(t){function e(t){for(var o={},i=r.getAttributes(t),u=0;u<i.length;u++){var s=i[u],a=r.getValues(t,s);if(a.length>1){for(var c=0;c<a.length;c++){var d=a[c];"object"==typeof d&&r.isItem(d)&&(a[c]=e(d))}d=a}else{var d=r.getValue(t,s);"object"==typeof d&&r.isItem(d)&&(d=e(d))}o[i[u]]=d}return n in o||!r.getIdentity||(o[n]=r.getIdentity(t)),o}var r=this.store,n=this.idProperty;return function(r){return t(r&&e(r))}},get:function(t,e){var n,o,i=new r;if(this.store.fetchItemByIdentity({identity:t,onItem:this._objectConverter(function(t){i.resolve(n=t)}),onError:function(t){i.reject(o=t)}}),void 0!==n)return null==n?void 0:n;if(o)throw o;return i.promise},put:function(t,e){e=e||{};var n="undefined"!=typeof e.id?e.id:this.getIdentity(t),o=this.store,i=this.idProperty,u=new r;return"undefined"==typeof n?(o.newItem(t),o.save({onComplete:function(){u.resolve(t)},onError:function(t){u.reject(t)}})):o.fetchItemByIdentity({identity:n,onItem:function(r){if(r){if(e.overwrite===!1)return u.reject(new Error("Overwriting existing object not allowed"));for(var n in t)n!=i&&t.hasOwnProperty(n)&&o.getValue(r,n)!=t[n]&&o.setValue(r,n,t[n])}else{if(e.overwrite===!0)return u.reject(new Error("Creating new object not allowed"));o.newItem(t)}o.save({onComplete:function(){u.resolve(t)},onError:function(t){u.reject(t)}})},onError:function(t){u.reject(t)}}),u.promise},add:function(t,e){return(e=e||{}).overwrite=!1,this.put(t,e)},remove:function(t){var e=this.store,n=new r;return this.store.fetchItemByIdentity({identity:t,onItem:function(t){try{null==t?n.resolve(!1):(e.deleteItem(t),e.save(),n.resolve(!0))}catch(r){n.reject(r)}},onError:function(t){n.reject(t)}}),n.promise},query:function(e,i){var u,s=new r(function(){u.abort&&u.abort()});s.total=new r;var a=this._objectConverter(function(t){return t});return u=this.store.fetch(t.mixin({query:e,onBegin:function(t){s.total.resolve(t)},onComplete:function(t){s.resolve(n.map(t,a))},onError:function(t){s.reject(t)}},i)),o(s)},getIdentity:function(t){return t[this.idProperty]}})});