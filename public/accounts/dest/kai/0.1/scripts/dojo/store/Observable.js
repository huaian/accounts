define("dojo/store/Observable",["../_base/kernel","../_base/lang","../when","../_base/array"],function(e,t,n,r){var i=function(e){function i(t,r){var i=e[t];i&&(e[t]=function(a){var o;if("put"===t&&(o=e.getIdentity(a)),s)return i.apply(this,arguments);s=!0;try{var f=i.apply(this,arguments);return n(f,function(e){r("object"==typeof e&&e||a,o)}),f}finally{s=!1}})}var a,o=[],f=0;e=t.delegate(e),e.notify=function(e,t){f++;for(var n=o.slice(),r=0,i=n.length;i>r;r++)n[r](e,t)};var u=e.query;e.query=function(i,s){s=s||{};var c=u.apply(this,arguments);if(c&&c.forEach){var l=t.mixin({},s);delete l.start,delete l.count;var v,y=e.queryEngine&&e.queryEngine(i,l),d=f,p=[];c.observe=function(t,i){1==p.push(t)&&o.push(v=function(t,o){n(c,function(n){var u,c,l,v=n.length!=s.count;if(++d!=f)throw new Error("Query is out of date, you must observe() the query prior to any data modifications");var h,g=-1,b=-1;if(o!==a)for(u=0,c=n.length;c>u;u++){var m=n[u];if(e.getIdentity(m)==o){h=m,g=u,(y||!t)&&n.splice(u,1);break}}if(y){if(t&&(y.matches?y.matches(t):y([t]).length)){var O=g>-1?g:n.length;n.splice(O,0,t),b=r.indexOf(y(n),t),n.splice(O,1),s.start&&0==b||!v&&b==n.length?b=-1:n.splice(b,0,t)}}else t&&(o!==a?b=g:s.start||(b=e.defaultIndex||0,n.splice(b,0,t)));if((g>-1||b>-1)&&(i||!y||g!=b)){var q=p.slice();for(u=0;l=q[u];u++)l(t||h,g,b)}})});var u={};return u.remove=u.cancel=function(){var e=r.indexOf(p,t);e>-1&&(p.splice(e,1),p.length||o.splice(r.indexOf(o,v),1))},u}}return c};var s;return i("put",function(t,n){e.notify(t,n)}),i("add",function(t){e.notify(t)}),i("remove",function(t){e.notify(void 0,t)}),e};return t.setObject("dojo.store.Observable",i),i});