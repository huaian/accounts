define("dojo/io/script",["../_base/connect","../_base/kernel","../_base/lang","../sniff","../_base/window","../_base/xhr","../dom","../dom-construct","../request/script","../aspect"],function(connect,kernel,lang,has,win,xhr,dom,domConstruct,_script,aspect){kernel.deprecated("dojo/io/script","Use dojo/request/script.","2.0");var script={get:function(e){var r,t=this._makeScriptDeferred(e,function(e){r&&r.cancel()}),c=t.ioArgs;return xhr._ioAddQueryToUrl(c),xhr._ioNotifyStart(t),r=_script.get(c.url,{timeout:e.timeout,jsonp:c.jsonp,checkString:e.checkString,ioArgs:c,frameDoc:e.frameDoc,canAttach:function(e){return c.requestId=e.id,c.scriptId=e.scriptId,c.canDelete=e.canDelete,script._canAttach(c)}},!0),aspect.around(r,"isValid",function(e){return function(r){return script._validCheck(t),e.call(this,r)}}),r.then(function(){t.resolve(t)}).otherwise(function(e){t.ioArgs.error=e,t.reject(e)}),t},attach:_script._attach,remove:_script._remove,_makeScriptDeferred:function(e,r){var t=xhr._ioSetArgs(e,r||this._deferredCancel,this._deferredOk,this._deferredError),c=t.ioArgs;return c.id=kernel._scopeName+"IoScript"+this._counter++,c.canDelete=!1,c.jsonp=e.callbackParamName||e.jsonp,c.jsonp&&(c.query=c.query||"",c.query.length>0&&(c.query+="&"),c.query+=c.jsonp+"="+(e.frameDoc?"parent.":"")+kernel._scopeName+".io.script.jsonp_"+c.id+"._jsonpCallback",c.frameDoc=e.frameDoc,c.canDelete=!0,t._jsonpCallback=this._jsonpCallback,this["jsonp_"+c.id]=t),t.addBoth(function(e){c.canDelete&&(e instanceof Error?script["jsonp_"+c.id]._jsonpCallback=function(){delete script["jsonp_"+c.id],c.requestId&&kernel.global[_script._callbacksProperty][c.requestId]()}:script._addDeadScript(c))}),t},_deferredCancel:function(e){e.canceled=!0},_deferredOk:function(e){var r=e.ioArgs;return r.json||r.scriptLoaded||r},_deferredError:function(e,r){return e},_deadScripts:[],_counter:1,_addDeadScript:function(e){script._deadScripts.push({id:e.id,frameDoc:e.frameDoc}),e.frameDoc=null},_validCheck:function(e){var r=script._deadScripts;if(r&&r.length>0){for(var t=0;t<r.length;t++)script.remove(r[t].id,r[t].frameDoc),delete script["jsonp_"+r[t].id],r[t].frameDoc=null;script._deadScripts=[]}return!0},_ioCheck:function(dfd){var ioArgs=dfd.ioArgs;if(ioArgs.json||ioArgs.scriptLoaded&&!ioArgs.args.checkString)return!0;var checkString=ioArgs.args.checkString;return checkString&&eval("typeof("+checkString+") != 'undefined'")},_resHandle:function(e){script._ioCheck(e)?e.callback(e):e.errback(new Error("inconceivable dojo.io.script._resHandle error"))},_canAttach:function(){return!0},_jsonpCallback:function(e){this.ioArgs.json=e,this.ioArgs.requestId&&kernel.global[_script._callbacksProperty][this.ioArgs.requestId](e)}};return lang.setObject("dojo.io.script",script),script});