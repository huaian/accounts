define("dijit/focus",["dojo/aspect","dojo/_base/declare","dojo/dom","dojo/dom-attr","dojo/dom-class","dojo/dom-construct","dojo/Evented","dojo/_base/lang","dojo/on","dojo/domReady","dojo/sniff","dojo/Stateful","dojo/_base/window","dojo/window","./a11y","./registry","./main"],function(e,t,o,i,r,n,s,c,u,d,a,h,f,l,m,g,v){var _,N,T=t([h,s],{curNode:null,activeStack:[],constructor:function(){var t=c.hitch(this,function(e){o.isDescendant(this.curNode,e)&&this.set("curNode",null),o.isDescendant(this.prevNode,e)&&this.set("prevNode",null)});e.before(n,"empty",t),e.before(n,"destroy",t)},registerIframe:function(e){return this.registerWin(e.contentWindow,e)},registerWin:function(e,t){var o=this,i=e.document&&e.document.body;if(i){var r=a("pointer-events")?"pointerdown":a("MSPointer")?"MSPointerDown":a("touch-events")?"mousedown, touchstart":"mousedown",n=u(e.document,r,function(e){e&&e.target&&null==e.target.parentNode||o._onTouchNode(t||e.target,"mouse")}),s=u(i,"focusin",function(e){if(e.target.tagName){var i=e.target.tagName.toLowerCase();"#document"!=i&&"body"!=i&&(m.isFocusable(e.target)?o._onFocusNode(t||e.target):o._onTouchNode(t||e.target))}}),c=u(i,"focusout",function(e){o._onBlurNode(t||e.target)});return{remove:function(){n.remove(),s.remove(),c.remove(),n=s=c=null,i=null}}}},_onBlurNode:function(e){var t=(new Date).getTime();_+100>t||(this._clearFocusTimer&&clearTimeout(this._clearFocusTimer),this._clearFocusTimer=setTimeout(c.hitch(this,function(){this.set("prevNode",this.curNode),this.set("curNode",null)}),0),this._clearActiveWidgetsTimer&&clearTimeout(this._clearActiveWidgetsTimer),N+100>t||(this._clearActiveWidgetsTimer=setTimeout(c.hitch(this,function(){delete this._clearActiveWidgetsTimer,this._setStack([])}),0)))},_onTouchNode:function(e,t){N=(new Date).getTime(),this._clearActiveWidgetsTimer&&(clearTimeout(this._clearActiveWidgetsTimer),delete this._clearActiveWidgetsTimer),r.contains(e,"dijitPopup")&&(e=e.firstChild);var o=[];try{for(;e;){var n=i.get(e,"dijitPopupParent");if(n)e=g.byId(n).domNode;else if(e.tagName&&"body"==e.tagName.toLowerCase()){if(e===f.body())break;e=l.get(e.ownerDocument).frameElement}else{var s=e.getAttribute&&e.getAttribute("widgetId"),c=s&&g.byId(s);!c||"mouse"==t&&c.get("disabled")||o.unshift(s),e=e.parentNode}}}catch(u){}this._setStack(o,t)},_onFocusNode:function(e){e&&9!=e.nodeType&&(_=(new Date).getTime(),this._clearFocusTimer&&(clearTimeout(this._clearFocusTimer),delete this._clearFocusTimer),this._onTouchNode(e),e!=this.curNode&&(this.set("prevNode",this.curNode),this.set("curNode",e)))},_setStack:function(e,t){var o=this.activeStack,i=o.length-1,r=e.length-1;if(e[r]!=o[i]){this.set("activeStack",e);var n,s;for(s=i;s>=0&&o[s]!=e[s];s--)n=g.byId(o[s]),n&&(n._hasBeenBlurred=!0,n.set("focused",!1),n._focusManager==this&&n._onBlur(t),this.emit("widget-blur",n,t));for(s++;r>=s;s++)n=g.byId(e[s]),n&&(n.set("focused",!0),n._focusManager==this&&n._onFocus(t),this.emit("widget-focus",n,t))}},focus:function(e){if(e)try{e.focus()}catch(t){}}}),w=new T;d(function(){var e=w.registerWin(l.get(document));a("ie")&&u(window,"unload",function(){e&&(e.remove(),e=null)})}),v.focus=function(e){w.focus(e)};for(var b in w)/^_/.test(b)||(v.focus[b]="function"==typeof w[b]?c.hitch(w,b):w[b]);return w.watch(function(e,t,o){v.focus[e]=o}),w});