define("dgrid/Grid",["dojo/_base/declare","dojo/_base/kernel","dojo/dom-construct","dojo/dom-class","dojo/on","dojo/has","./List","./util/misc","dojo/_base/sniff"],function(e,t,r,i,o,s,n,l){function d(e,t){t&&t.nodeType&&e.appendChild(t)}function a(e){return l.escapeCssIdentifier(e,"-")}var u=e(n,{columns:null,hasNeutralSort:!1,cellNavigation:!0,tabableHeader:!0,showHeader:!0,column:function(e){return"object"!=typeof e?this.columns[e]:this.cell(e).column},listType:"grid",cell:function(e,t){if(e.column&&e.element)return e;e.target&&e.target.nodeType&&(e=e.target);var r;if(e.nodeType)do{if(this._rowIdToObject[e.id])break;var i=e.columnId;if(i){t=i,r=e;break}e=e.parentNode}while(e&&e!==this.domNode);if(!r&&"undefined"!=typeof t){var o=this.row(e),s=o&&o.element;if(s)for(var n=s.getElementsByTagName("td"),l=0;l<n.length;l++)if(n[l].columnId===t){r=n[l];break}}return null!=e?{row:o||this.row(e),column:t&&this.column(t),element:r}:void 0},createRowCells:function(e,t,i,o){var n,l,d,u,c,h,f,m,p,g,_,b,w,y=r.create("table",{className:"dgrid-row-table",role:"presentation"}),C=s("ie")<9?r.create("tbody",null,y):y;for(i=i||this.subRows,l=0,d=i.length;d>l;l++)for(h=i[l],n=r.create("tr",null,C),h.className&&(n.className=h.className),u=0,c=h.length;c>u;u++)f=h[u],m=f.id,p=f.field?" field-"+a(f.field):"",g="function"==typeof f.className?f.className(o):f.className,g&&(p+=" "+g),_=r.create(e,{className:"dgrid-cell"+(m?" dgrid-column-"+a(m):"")+p,role:"th"===e?"columnheader":"gridcell"}),_.columnId=m,b=f.colSpan,b&&(_.colSpan=b),w=f.rowSpan,w&&(_.rowSpan=w),t(_,f),n.appendChild(_);return y},left:function(e,t){return e.element||(e=this.cell(e)),this.cell(this._move(e,-(t||1),"dgrid-cell"))},right:function(e,t){return e.element||(e=this.cell(e)),this.cell(this._move(e,t||1,"dgrid-cell"))},_defaultRenderCell:function(e,t,r){if(this.formatter){var i=this.formatter,o=this.grid.formatterScope;r.innerHTML="string"==typeof i&&o?o[i](t,e):this.formatter(t,e)}else null!=t&&r.appendChild(document.createTextNode(t))},renderRow:function(e,t){var i=this,o=this.createRowCells("td",function(r,o){var s=e;o.get?s=o.get(e):"field"in o&&"_item"!==o.field&&(s=s[o.field]),o.renderCell?d(r,o.renderCell(e,s,r,t)):i._defaultRenderCell.call(o,e,s,r,t)},t&&t.subRows,e),s=r.create("div",{role:"row"});return s.appendChild(o),s},renderHeader:function(){var e=this,t=this.headerNode;t.setAttribute("role","row"),r.empty(t);var i=this.createRowCells("th",function(e,t){var r=t.headerNode=e,i=t.field;i&&(e.field=i),t.renderHeaderCell?d(r,t.renderHeaderCell(r)):("label"in t||t.field)&&r.appendChild(document.createTextNode("label"in t?t.label:t.field)),t.sortable!==!1&&i&&"_item"!==i&&(e.sortable=!0,e.className+=" dgrid-sortable")},this.subRows&&this.subRows.headerRows);this._rowIdToObject[i.id=this.id+"-header"]=this.columns,t.appendChild(i),this._sortListener&&this._sortListener.remove(),this._sortListener=o(i,"click,keydown",function(r){if("click"===r.type||32===r.keyCode||!s("opera")&&13===r.keyCode){var i,n,l,d,a=r.target;do if(a.sortable){i=a.field||a.columnId,n=e.sort[0],l=e.hasNeutralSort&&n&&n.property===i&&n.descending?[]:[{property:i,descending:n&&n.property===i&&!n.descending}],d={bubbles:!0,cancelable:!0,grid:e,parentType:r.type,sort:l},o.emit(r.target,"dgrid-sort",d)&&(e._sortNode=a,e.set("sort",l));break}while((a=a.parentNode)&&a!==t)}})},resize:function(){var e,t=this.headerNode.firstChild,r=this.contentNode;this.inherited(arguments),r.style.width="",r&&t&&(e=t.offsetWidth)>r.offsetWidth&&(r.style.width=e+"px")},destroy:function(){this._destroyColumns(),this._sortListener&&this._sortListener.remove(),this.inherited(arguments)},_setSort:function(){this.inherited(arguments),this.updateSortArrow(this.sort)},_findSortArrowParent:function(e){var t=this.columns;for(var r in t){var i=t[r];if(i.field===e)return i.headerNode}},updateSortArrow:function(e,t){if(this._lastSortedArrow&&(i.remove(this._lastSortedArrow.parentNode,"dgrid-sort-up dgrid-sort-down"),r.destroy(this._lastSortedArrow),delete this._lastSortedArrow),t&&(this.sort=e),e[0]){var o,s=e[0].property,n=e[0].descending,l=this._sortNode||this._findSortArrowParent(s);delete this._sortNode,l&&(l=l.contents||l,o=this._lastSortedArrow=r.create("div",{className:"dgrid-sort-arrow ui-icon",innerHTML:"&nbsp;",role:"presentation"},l,"first"),i.add(l,"dgrid-sort-"+(n?"down":"up")),this.resize())}},styleColumn:function(e,t){return this.addCssRule("#"+l.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+a(e),t)},_configColumns:function(e,r){function i(i,n){"string"==typeof i&&(r[n]=i={label:i}),s||i.field||(i.field=n),n=i.id=i.id||(isNaN(n)?n:e+n),this._configColumn&&(this._configColumn(i,r,e),n=i.id),s&&(this.columns[n]=i),i.grid=this,"function"==typeof i.init&&(t.deprecated("colum.init","Column plugins are being phased out in favor of mixins for better extensibility. column.init may be removed in a future release."),i.init()),o.push(i)}var o=[],s=r instanceof Array;return l.each(r,i,this),s?r:o},_destroyColumns:function(){var e,r,i,o,s=this.subRows,n=s&&s.length;for(this.cleanup(),e=0;n>e;e++)for(r=0,o=s[e].length;o>r;r++)i=s[e][r],"function"==typeof i.destroy&&(t.deprecated("colum.destroy","Column plugins are being phased out in favor of mixins for better extensibility. column.destroy may be removed in a future release."),i.destroy())},configStructure:function(){var e=this.subRows,t=this._columns=this.columns;if(this.columns=!t||t instanceof Array?{}:t,e)for(var r=0;r<e.length;r++)e[r]=this._configColumns(r+"-",e[r]);else this.subRows=[this._configColumns("",t)]},_getColumns:function(){return this._columns||this.columns},_setColumns:function(e){this._destroyColumns(),this.subRows=null,this.columns=e,this._updateColumns()},_setSubRows:function(e){this._destroyColumns(),this.subRows=e,this._updateColumns()},_updateColumns:function(){this.configStructure(),this.renderHeader(),this.refresh(),this._lastCollection&&this.renderArray(this._lastCollection),this._started&&(this.sort.length?(this._lastSortedArrow=null,this.updateSortArrow(this.sort)):this.resize())}});return u.appendIfNode=d,u});