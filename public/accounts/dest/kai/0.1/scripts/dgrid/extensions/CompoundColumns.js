define("dgrid/extensions/CompoundColumns",["dojo/_base/lang","dojo/_base/declare","dojo/sniff","dojo/query","../util/misc"],function(e,n,i,t,o){return n(null,{configStructure:function(){function n(i,d,u,a){function h(o,h){"string"==typeof o&&(o={label:o}),i instanceof Array||o.field||(o.field=h),l=o.children,f=l&&o.showChildHeaders!==!1,o.parentColumn=a,l?null==o.id?o.id=(a&&a.id||d-1)+"-"+r.length:a&&a.id&&(o.id=a.id+"-"+o.id):(s.push(o),r.push(e.delegate(o,{renderHeaderCell:m})),c++),f||(o=e.delegate(o,{rowSpan:-d})),l&&(c+=o.colSpan=n(l,d+1,f,o)),u&&(t[d]||(t[d]=[])).push(o)}var l,f,c=0,m=function(){};return o.each(i,h,this),c}var i=this.subRows&&this.subRows[0]||this.columns,t=[[]],r=t[0],s=[];t[0].className="dgrid-spacer-row",n(i,1,!0);var d,u,a,h,l=t.length;for(d=0;l>d;d++)for(a=t[d],u=0;u<a.length;u++)h=a[u],h.rowSpan<1&&(h.rowSpan+=l);s=[s],s.headerRows=t,this.subRows=s,this.inherited(arguments)},renderHeader:function(){var e,n=this.subRows[0],i=this.subRows.headerRows[0];for(this.inherited(arguments),e=n.length;e--;)n[e].headerNode=i[e].headerNode},_findSortArrowParent:function(){var e,n,i=this.inherited(arguments),o=t(".dgrid-spacer-row",this.headerNode)[0];return i&&o.contains(i)?(e=i.columnId,n=t(".dgrid-column-"+e,this.headerNode),n[n.length-1]):void 0},_configColumn:function(e,n,i){var t=e.parentColumn,o=e.id;if(t){var r=0===o.indexOf(i)?o.substring(i.length):o;i=t.id+"-",o=e.id=i+r}this.inherited(arguments,[e,n,i])},cell:function(e,n){if("object"!=typeof n){var i=this.column(n);i&&(n=i.id)}return this.inherited(arguments,[e,n])},column:function(e){var n=this.inherited(arguments);if(null==n&&"object"!=typeof e){var i="-"+e,t=i.length;for(var o in this.columns)if(-1!==o.indexOf(i,o.length-t))return this.columns[o]}return n},_updateCompoundHiddenStates:function(e,n){var i,t=this.columns[e];if(!t||t.hidden!==n)for(;t&&t.parentColumn;)t=t.parentColumn,i=t.colSpan=t.colSpan+(n?-1:1),i&&(t.headerNode.colSpan=i),1!==i||n?!i&&n&&this._hideColumn(t.id):this._showColumn(t.id)},_hideColumn:function(e){var n=this;this._updateCompoundHiddenStates(e,!0),this.inherited(arguments),i("ff")&&(this.headerNode.style.display="none",setTimeout(function(){n.headerNode.style.display="",n.resize()},0))},_showColumn:function(e){this._updateCompoundHiddenStates(e,!1),this.inherited(arguments)},_getResizedColumnWidths:function(){var e,n=0,i=this.columns;for(e in i)n+=i[e].headerNode.offsetWidth;return{totalWidth:n,lastColId:this.subRows[0][this.subRows[0].length-1].id}}})});