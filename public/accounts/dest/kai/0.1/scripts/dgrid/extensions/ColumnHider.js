define("dgrid/extensions/ColumnHider",["dojo/_base/declare","dojo/dom-construct","dojo/has","dojo/on","../util/misc","dojo/i18n!./nls/columnHider"],function(e,i,n,d,t,o){function s(e,i){return e.id.substr(i.id.length+18)}var r,u;return e(null,{hiderMenuNode:null,hiderToggleNode:null,i18nColumnHider:o,_hiderMenuOpened:!1,_columnHiderRules:null,_columnHiderCheckboxes:null,_renderHiderMenuEntries:function(){var e,i,n,d,t=this.subRows,o=!0;for(delete this._columnHiderFirstCheckbox,n=0,e=t.length;e>n;n++)for(d=0,i=t[n].length;i>d;d++)this._renderHiderMenuEntry(t[n][d]),o&&(o=!1,this._columnHiderFirstCheckbox=this._columnHiderCheckboxes[t[n][d].id])},_renderHiderMenuEntry:function(e){var n,d,o,s,r=e.id,u=t.escapeCssIdentifier(r,"-");e.hidden&&(e.hidden=!1,this._hideColumn(r),e.hidden=!0),e.unhidable||(n=i.create("div",{className:"dgrid-hider-menu-row"}),d=this.domNode.id+"-hider-menu-check-"+u,o=this._columnHiderCheckboxes[r]=i.create("input",{className:"dgrid-hider-menu-check hider-menu-check-"+u,id:d,type:"checkbox"},n),s=i.create("label",{className:"dgrid-hider-menu-label hider-menu-label-"+u,"for":d},n),s.appendChild(document.createTextNode(e.label||e.field||"")),this.hiderMenuNode.appendChild(n),e.hidden||(o.checked=!0))},renderHeader:function(){function e(e){e.stopPropagation()}var t,o=this,l=this.hiderMenuNode,h=this.hiderToggleNode;if(this.inherited(arguments),l){for(t in this._columnHiderRules)this._columnHiderRules[t].remove();l.innerHTML=""}else h=this.hiderToggleNode=i.create("button",{"aria-label":this.i18nColumnHider.popupTriggerLabel,className:"ui-icon dgrid-hider-toggle",type:"button"},this.domNode),this._listeners.push(d(h,"click",function(e){o._toggleColumnHiderMenu(e)})),l=this.hiderMenuNode=i.create("div",{"aria-label":this.i18nColumnHider.popupLabel,className:"dgrid-hider-menu",id:this.id+"-hider-menu",role:"dialog"}),this._listeners.push(d(l,"keyup",function(e){var i=e.charCode||e.keyCode;27===i&&(o._toggleColumnHiderMenu(e),h.focus())})),l.style.display="none",this.domNode.appendChild(l),this._listeners.push(d(l,".dgrid-hider-menu-check:"+(n("ie")<9?"click":"change"),function(e){o._updateColumnHiddenState(s(e.target,o),!e.target.checked)})),this._listeners.push(d(l,"mousedown",e),d(h,"mousedown",e)),u||(u=d.pausable(document,"mousedown",function(e){r&&r._toggleColumnHiderMenu(e)}),u.pause());this._columnHiderCheckboxes={},this._columnHiderRules={},this._renderHiderMenuEntries()},destroy:function(){this.inherited(arguments);for(var e in this._columnHiderRules)this._columnHiderRules[e].remove()},left:function(e,i){return this.right(e,-i)},right:function(e,i){e.element||(e=this.cell(e));for(var n=this.inherited(arguments),d=e;n.column.hidden;){if(n=this.inherited(arguments,[n,i>0?1:-1]),d.element===n.element)return e;d=n}return n},isColumnHidden:function(e){return!!this._columnHiderRules[e]},_toggleColumnHiderMenu:function(){var e,i=this._hiderMenuOpened,n=this.hiderMenuNode,d=this.domNode;n.style.display=i?"none":"",i?n.style.height="":(n.offsetHeight>d.offsetHeight-12&&(n.style.height=d.offsetHeight-12+"px"),(e=this._columnHiderFirstCheckbox)&&e.focus()),u[i?"pause":"resume"](),r=i?null:this,this._hiderMenuOpened=!i},_hideColumn:function(e){var i,d=this,o="#"+t.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-";this._columnHiderRules[e]||(this._columnHiderRules[e]=t.addCssRule(o+t.escapeCssIdentifier(e,"-"),"display: none;"),(8===n("ie")||10===n("ie"))&&(i=t.addCssRule(".dgrid-row-table","display: inline-table;"),window.setTimeout(function(){i.remove(),d.resize()},0)))},_showColumn:function(e){this._columnHiderRules[e]&&(this._columnHiderRules[e].remove(),delete this._columnHiderRules[e])},_updateColumnHiddenState:function(e,i){this[i?"_hideColumn":"_showColumn"](e),this.columns[e].hidden=i,d.emit(this.domNode,"dgrid-columnstatechange",{grid:this,column:this.columns[e],hidden:i,bubbles:!0}),this.resize()},toggleColumnHiddenState:function(e,i){"undefined"==typeof i&&(i=!this._columnHiderRules[e]),this._updateColumnHiddenState(e,i),this._columnHiderCheckboxes[e]&&(this._columnHiderCheckboxes[e].checked=!i)}})});