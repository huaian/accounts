define("dgrid/extensions/ColumnResizer",["dojo/_base/declare","dojo/on","dojo/query","dojo/_base/lang","dojo/dom","dojo/dom-construct","dojo/dom-geometry","dojo/has","../util/misc","dojo/_base/html"],function(e,t,i,s,o,n,d,r,u){function l(e,t,i,s,o){for(var n=1;t>n;n++)e[i+n][s]=o}function h(e){for(var t=e.length,i=t,s=e[0].length,o=new Array(t);t--;)o[t]=new Array(s);var n={};for(t=0;i>t;t++)for(var d=o[t],r=e[t],u=0,h=0;s>u;u++){var a,c=r[h];if("undefined"==typeof d[u]){if(d[u]=c.id,c.rowSpan&&c.rowSpan>1&&l(o,c.rowSpan,t,u,c.id),t>0&&c.colSpan&&c.colSpan>1)for(a=1;a<c.colSpan;a++)d[++u]=c.id,c.rowSpan&&c.rowSpan>1&&l(o,c.rowSpan,t,u,c.id);n[c.id]=e[0][u].id,h++}}return n}function a(e,i,s,o,n){if(!(0>=s)){var d,r,l=e.columns[i];if(l)return d={grid:e,columnId:i,width:s,bubbles:!0,cancelable:!0},o&&(d.parentType=o),!e._resizedColumns||t.emit(e.headerNode,"dgrid-columnresize",d)?("auto"===s?delete l.width:(l.width=s,s+="px"),r=e._columnSizes[i],r?r.set("width",s):r=u.addCssRule("#"+u.escapeCssIdentifier(e.domNode.id)+" .dgrid-column-"+u.escapeCssIdentifier(i,"-"),"width: "+s+";"),e._columnSizes[i]=r,n!==!1&&e.resize(),!0):void 0}}var c,m,f=0,p={create:function(){c=n.create("div",{className:"dgrid-column-resizer"}),m=n.create("div",{className:"dgrid-resize-guard"})},destroy:function(){n.destroy(c),n.destroy(m),c=m=null},show:function(e){var t=d.position(e.domNode,!0);c.style.top=t.y+"px",c.style.height=t.h+"px",document.body.appendChild(c),e.domNode.appendChild(m)},move:function(e){c.style.left=e+"px"},hide:function(){c.parentNode.removeChild(c),m.parentNode.removeChild(m)}};return e(null,{resizeNode:null,minWidth:40,adjustLastColumn:!0,_resizedColumns:!1,buildRendering:function(){this.inherited(arguments),f||p.create(),f++},destroy:function(){this.inherited(arguments);for(var e in this._columnSizes)this._columnSizes[e].remove();--f||p.destroy()},resizeColumnWidth:function(e,t){return a(this,e,t)},configStructure:function(){var e,t=this._oldColumnSizes=s.mixin({},this._columnSizes);this._resizedColumns=!1,this._columnSizes={},this.inherited(arguments);for(e in t)e in this._columnSizes||t[e].remove();delete this._oldColumnSizes},_configColumn:function(e){this.inherited(arguments);var t,i=e.id;"width"in e&&((t=this._oldColumnSizes[i])?t.set("width",e.width+"px"):t=u.addCssRule("#"+u.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-"+u.escapeCssIdentifier(i,"-"),"width: "+e.width+"px;"),this._columnSizes[i]=t)},renderHeader:function(){this.inherited(arguments);var e,o=this;if(this.columnSets&&this.columnSets.length)for(var d=this.columnSets.length;d--;)e=s.mixin(e||{},h(this.columnSets[d]));else this.subRows&&this.subRows.length>1&&(e=h(this.subRows));for(var l=i(".dgrid-cell",o.headerNode),a=l.length;a--;){var c,m=l[a],f=m.columnId,p=o.columns[f],g=m.childNodes;if(p&&p.resizable!==!1){var _=n.create("div",{className:"dgrid-resize-header-container"});for(m.contents=_;g.length>0;)_.appendChild(g[0]);c=n.create("div",{className:"dgrid-resize-handle resizeNode-"+u.escapeCssIdentifier(f,"-")},_),m.appendChild(_),c.columnId=e&&e[f]||f}}o.mouseMoveListen||(t(o.headerNode,".dgrid-resize-handle:mousedown"+(r("touch")?",.dgrid-resize-handle:touchstart":""),function(e){o._resizeMouseDown(e,this),o.mouseMoveListen.resume(),o.mouseUpListen.resume()}),o._listeners.push(o.mouseMoveListen=t.pausable(document,"mousemove"+(r("touch")?",touchmove":""),u.throttleDelayed(function(e){o._updateResizerPosition(e)}))),o._listeners.push(o.mouseUpListen=t.pausable(document,"mouseup"+(r("touch")?",touchend":""),function(e){o._resizeMouseUp(e),o.mouseMoveListen.pause(),o.mouseUpListen.pause()})),o.mouseMoveListen.pause(),o.mouseUpListen.pause())},_resizeMouseDown:function(e,t){e.preventDefault(),o.setSelectable(this.domNode,!1),this._startX=this._getResizeMouseLocation(e),this._targetCell=i(".dgrid-column-"+u.escapeCssIdentifier(t.columnId,"-"),this.headerNode)[0],this._updateResizerPosition(e),p.show(this)},_resizeMouseUp:function(e){var t,s,n,d=this._columnSizes;this.adjustLastColumn&&(n=this.headerNode.clientWidth-1),this._resizedColumns||(t=i(".dgrid-cell",this.headerNode),this.columnSets&&this.columnSets.length?t=t.filter(function(e){var t=e.columnId.split("-");return"0"===t[0]&&!(e.columnId in d)}):this.subRows&&this.subRows.length>1&&(t=t.filter(function(e){return"0"===e.columnId.charAt(0)&&!(e.columnId in d)})),s=t.map(function(e){return e.offsetWidth}),t.forEach(function(e,t){a(this,e.columnId,s[t],null,!1)},this),this._resizedColumns=!0),o.setSelectable(this.domNode,!0);var r=this._targetCell,l=this._getResizeMouseLocation(e)-this._startX,h=r.offsetWidth+l,c=this._getResizedColumnWidths(),m=c.totalWidth,f=c.lastColId,g=i(".dgrid-column-"+u.escapeCssIdentifier(f,"-"),this.headerNode)[0].offsetWidth;h<this.minWidth&&(h=this.minWidth),a(this,r.columnId,h,e.type)&&r.columnId!==f&&this.adjustLastColumn&&(n>m+l?a(this,f,"auto",e.type):g-l<=this.minWidth&&a(this,f,this.minWidth,e.type)),p.hide(),delete this._startX,delete this._targetCell},_updateResizerPosition:function(e){if(this._targetCell){var t=this._getResizeMouseLocation(e),i=t-this._startX,s=this._targetCell.offsetWidth,o=t;s+i<this.minWidth&&(o=this._startX-(s-this.minWidth)),p.move(o)}},_getResizeMouseLocation:function(e){var t=0;return e.pageX?t=e.pageX:e.clientX&&(t=e.clientX+document.body.scrollLeft+document.documentElement.scrollLeft),t},_getResizedColumnWidths:function(){var e=0,t=i((this.columnSets?".dgrid-column-set-cell ":"")+"tr:first-child .dgrid-cell",this.headerNode),s=t.length;if(!s)return{};for(var o=t[s-1].columnId;s--;)e+=t[s].offsetWidth;return{totalWidth:e,lastColId:o}}})});