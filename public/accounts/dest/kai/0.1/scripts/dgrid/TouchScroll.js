define("dgrid/TouchScroll",["dojo/_base/declare","dojo/dom-construct","dojo/dom-class","dojo/on","./util/touch","./util/has-css3"],function(e,t,o,l,r,s){function c(e,l){var r,s=e.touchNode,c=s.parentNode,i=c.offsetWidth-_,a=c.offsetHeight-_,n=l.scrollWidth=s.scrollWidth,d=l.scrollHeight=s.scrollHeight,h=l.parentWidth=c.offsetWidth,u=l.parentHeight=c.offsetHeight;n>h?(e._scrollbarXNode||(r=t.create("div",{className:"touchscroll-x"},c)),r=e._scrollbarXNode=e._scrollbarXNode||t.create("div",{className:"touchscroll-bar"},r),r.style.width=i*i/n+"px",r.style.left=s.offsetLeft+"px",o.add(c,"touchscroll-scrollable-x"),l.scrollableX=!0):o.remove(c,"touchscroll-scrollable-x"),d>u?(e._scrollbarYNode||(r=t.create("div",{className:"touchscroll-y"},c)),r=e._scrollbarYNode=e._scrollbarYNode||t.create("div",{className:"touchscroll-bar"},r),r.style.height=a*a/d+"px",r.style.top=s.offsetTop+"px",o.add(c,"touchscroll-scrollable-y"),l.scrollableY=!0):o.remove(c,"touchscroll-scrollable-y"),o.remove(c,"touchscroll-fadeout")}function i(e,t){var o,r,s,c,i,a=e.touchNode,n=T[e.id];"object"!=typeof t?(c=t,i=arguments[2],t=arguments[3],r=s=!0):(r="x"in t,s="y"in t,r&&s||(o=e.getScrollPosition()),c=r?t.x:o.x,i=s?t.y:o.y),a.style[N]=X+-c+"px,"+-i+"px"+Y,n&&r&&e._scrollbarXNode&&(e._scrollbarXNode.style[N]=X+c*n.parentWidth/n.scrollWidth+"px,0"+Y),n&&s&&e._scrollbarYNode&&(e._scrollbarYNode.style[N]=X+"0,"+i*n.parentHeight/n.scrollHeight+"px"+Y),l.emit(e.touchNode.parentNode,"scroll",{scrollLeft:c,scrollTop:i})}function a(e){return T[e.id]?w.exec(window.getComputedStyle(e.touchNode)[N]):W.exec(e.touchNode.style[N])}function n(e){var t=this.widget,l=[this.node,t._scrollbarXNode,t._scrollbarYNode],r=l.length;for(this.timer&&(clearTimeout(this.timer),this.timer=null),this.transitionHandler&&this.transitionHandler.remove();r--;)l[r]&&(l[r].style[b+"Duration"]="0");e&&e.preserveScrollbars||o.add(this.node.parentNode,"touchscroll-fadeout"),delete this.resetEffects}function d(e){var t,o,l,s=e.widget,c=s.touchNode,i=s.id,n=0,d=0;r.countCurrentTouches(e,c)===s.touchesToScroll&&(o=a(s),o&&(n=+o[1],d=+o[2]),(l=T[i])&&(l.resetEffects&&l.resetEffects({preserveScrollbars:!0}),c.style[N]=X+n+"px,"+d+"px"+Y,H[i]=l),t=e.targetTouches[0],l=T[i]={widget:s,node:c,startX:n-t.pageX,startY:d-t.pageY,lastX:n,lastY:d,pageX:t.pageX,pageY:t.pageY,tickFunc:function(){f(i)}},l.timer=setTimeout(l.tickFunc,y))}function h(e){var t,o,l,s,a,n,d,h,u=e.widget,f=u.id,g=u.touchesToScroll,p=T[f];if(!p||(t=r.countCurrentTouches(e,u.touchNode))!==g)return void(t>g&&u.cancelTouchScroll());if(o=e.targetTouches,l=o[0],!p.scrollbarsShown&&(H[f]||Math.abs(l.pageX-p.pageX)>u.scrollThreshold||Math.abs(l.pageY-p.pageY)>u.scrollThreshold))for(c(u,p),p.scrollbarsShown=!0,h=o.length;h--;)o[h].touchScrolled=!0;p.scrollbarsShown&&(p.scrollableX||p.scrollableY)&&(e.preventDefault(),s=p.scrollableX?p.startX+l.pageX:0,a=p.scrollableY?p.startY+l.pageY:0,n=p.scrollableX?-(p.scrollWidth-p.parentWidth):0,d=p.scrollableY?-(p.scrollHeight-p.parentHeight):0,s>0?s/=2:n>s&&(s=n-(n-s)/2),a>0?a/=2:d>a&&(a=d-(d-a)/2),i(u,-s,-a))}function u(e){var t=e.widget,o=t.id,l=T[o];l&&r.countCurrentTouches(e,t.touchNode)===t.touchesToScroll-1&&p(o)}function f(e){var t,o,l,r,s=T[e];s&&(t=s.node,o=W.exec(t.style[N]),o?(l=+o[1],r=+o[2],s.velX=l-s.lastX,s.velY=r-s.lastY,s.lastX=l,s.lastY=r):s.lastX=s.lastY=0,s.timer=setTimeout(s.tickFunc,y))}function g(e,t,o){function r(){delete c.transitionHandler,c.resetEffects(),delete T[e]}var s,c=T[e],i=c.widget,a=c.node,n=c.scrollableX?Math.max(Math.min(0,t),-(c.scrollWidth-c.parentWidth)):t,d=c.scrollableY?Math.max(Math.min(0,o),-(c.scrollHeight-c.parentHeight)):o;delete c.timer,n!==t||d!==o?(c.transitionHandler=l.once(a,M,r),a.style[b+"Duration"]=i.bounceDuration+"ms",a.style[N]=X+n+"px,"+d+"px"+Y,n!==t&&c.scrollableX&&(s=c.widget._scrollbarXNode,s.style[b+"Duration"]=i.bounceDuration+"ms",t>n?s.style[N]=X+"0,0"+Y:s.style[N]=X+(s.parentNode.offsetWidth-s.offsetWidth)+"px,0"+Y),d!==o&&c.scrollableY&&(s=c.widget._scrollbarYNode,s.style[b+"Duration"]=i.bounceDuration+"ms",o>d?s.style[N]=X+"0,0"+Y:s.style[N]=X+"0,"+(s.parentNode.offsetHeight-s.offsetHeight)+"px"+Y)):r()}function p(e){function t(e,t){return(e.velX<=0&&t.velX<=0||e.velX>=0&&t.velX>=0)&&(e.velY<=0&&t.velY<=0||e.velY>=0&&t.velY>=0)}var o,l,r,s=T[e],c=H[e],i=1.15;return delete H[e],s.timer&&clearTimeout(s.timer),s.resetEffects=n,o=W.exec(s.node.style[N]),o?(l=+o[1],r=+o[2]):l=r=0,!s.velX&&!s.velY||(l>=0||l<=-(s.scrollWidth-s.parentWidth))&&(r>=0||r<=-(s.scrollHeight-s.parentHeight))?void g(e,l,r):(c&&(c.velX||c.velY)&&t(s,c)&&(s.velX=(s.velX+c.velX)*i,s.velY=(s.velY+c.velY)*i),s.lastX=l,s.lastY=r,s.calcFunc=function(){v(e)},void(s.timer=setTimeout(s.calcFunc,x)))}function v(e){var t,o,l,r,s,c,a,n,d=T[e],h=6;if(d)if(t=d.node,o=t.parentNode,l=d.widget,a=l.glideDecel(d.velX),n=l.glideDecel(d.velY),Math.abs(a)>=S||Math.abs(n)>=S){if(s=d.lastX+a,c=d.lastY+n,s>0||s<-(d.scrollWidth-d.parentWidth))for(r=h;r--;)a=l.glideDecel(a);if(c>0||c<-(d.scrollHeight-d.parentHeight))for(r=h;r--;)n=l.glideDecel(n);i(l,-s,-c),d.lastX=s,d.lastY=c,d.velX=a,d.velY=n,d.timer=setTimeout(d.calcFunc,x)}else g(e,d.lastX,d.lastY)}var m,b,N,X,Y,y=50,x=30,T={},H={},S=1,_=8,W=/^translate(?:3d)?\((-?\d+)(?:\.\d*)?(?:px)?, (-?\d+)/,w=/^matrix\(1, 0, 0, 1, (-?\d+)(?:\.\d*)?(?:px)?, (-?\d+)/,D=s("css-transitions"),M=s("transitionend"),E=s("css-transforms"),F=s("css-transforms3d");return F?(X="translate3d(",Y=",0)"):E&&(X="translate(",Y=")"),D&&X?(N=F||E,N=N===!0?"transform":N+"Transform",b=D===!0?"transition":D+"Transition",m=E===!0?"":"-"+E.toLowerCase()+"-",e(null,{touchesToScroll:1,touchNode:null,scrollThreshold:10,bounceDuration:300,postCreate:function(){this._initTouch(),this.inherited(arguments)},_initTouch:function(){function e(){s.cancelTouchScroll()}function t(t){return function(o){o.widget=s,o.cancelTouchScroll=e,t.call(this,o)}}var o,r=this.touchNode=this.touchNode||this.containerNode,s=this;r&&r.parentNode&&(o=r.parentNode,o.style.overflow="hidden",r.style[b+"Property"]=m+"transform",r.style[b+"TimingFunction"]="cubic-bezier(0.33, 0.66, 0.66, 1)",this._touchScrollListeners=[l(o,"touchstart",t(d)),l(o,"touchmove",t(h)),l(o,"touchend,touchcancel",t(u))])},destroy:function(){for(var e=this._touchScrollListeners.length;e--;)this._touchScrollListeners[e].remove();delete T[this.id],this.inherited(arguments)},scrollTo:function(e){var t=T[this.id],o=this.touchNode,l=o.parentNode;!e.preserveMomentum&&t&&t.resetEffects&&t.resetEffects(),e.x&&(e.x=Math.max(0,Math.min(e.x,o.scrollWidth-l.offsetWidth))),e.y&&(e.y=Math.max(0,Math.min(e.y,o.scrollHeight-l.offsetHeight))),i(this,e)},getScrollPosition:function(){var e=a(this);return e?{x:-e[1],y:-e[2]}:{x:0,y:0}},cancelTouchScroll:function(){var e=T[this.id];e&&(e.resetEffects?e.resetEffects():(e.timer&&clearTimeout(e.timer),o.add(e.node.parentNode,"touchscroll-fadeout")),delete T[this.id])},glideDecel:function(e){return.9*e}})):function(){}});