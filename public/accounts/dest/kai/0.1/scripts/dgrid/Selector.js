define("dgrid/Selector",["dojo/_base/declare","dojo/_base/lang","dojo/_base/sniff","dojo/dom-construct","dojo/dom-class","./Selection"],function(e,t,l,i,o,c){return e(c,{postCreate:function(){this.inherited(arguments),this.on(".dgrid-selector:click,.dgrid-selector:keydown",t.hitch(this,"_handleSelectorClick")),this.on("dgrid-select",t.hitch(this,"_changeSelectorInput",!0)),this.on("dgrid-deselect",t.hitch(this,"_changeSelectorInput",!1))},_defaultRenderSelectorInput:function(e,t,l,c){var s=e.grid;return o.add(l,"dgrid-selector"),l.input||(l.input=i.create("input",{"aria-checked":t,checked:t,disabled:!s.allowSelect(s.row(c)),tabIndex:isNaN(e.tabIndex)?-1:e.tabIndex,type:e.selector},l))},_configureSelectorColumn:function(e){var t=this,l=e.selector;this._selectorColumns.push(e),this._selectorSingleRow=this._selectorSingleRow||"radio"===e.selector;var i="function"==typeof l?l:this._defaultRenderSelectorInput;e.sortable=!1,e.renderCell=function(l,o,c){var s=l&&t.row(l);o=s&&t.selection[s.id],i(e,!!o,c,l)},e.renderHeaderCell=function(l){var o="label"in e?e.label:e.field||"";"radio"!==e.selector&&t.allowSelectAll?(e._selectorHeaderCheckbox=i(e,!1,l,{}),t._hasSelectorHeaderCheckbox=!0):l.appendChild(document.createTextNode(o))}},_handleSelectorClick:function(e){var t=this.cell(e),i=t.row;if("click"===e.type||32===e.keyCode||!l("opera")&&13===e.keyCode||0===e.keyCode){if(this._selectionTriggerEvent=e,i){if(this.allowSelect(i)){var o=this._lastSelected&&this.row(this._lastSelected);this._selectorSingleRow?o&&o.id===i.id||(this.clearSelection(),this.select(i,null,!0),this._lastSelected=i.element):i&&(e.shiftKey?this._changeSelectorInput(!0,{rows:[i]}):o=null,o=e.shiftKey?o:null,this.select(o||i,i,o?void 0:null),this._lastSelected=i.element)}}else this[this.allSelected?"clearSelection":"selectAll"]();this._selectionTriggerEvent=null}},_changeSelectorInput:function(e,t){this._selectorColumns.length&&this._updateRowSelectors(e,t),this._hasSelectorHeaderCheckbox&&this._updateHeaderCheckboxes()},_updateRowSelectors:function(e,t){for(var l=t.rows,i=l.length,o=this._selectorColumns.length,c=0;i>c;c++)for(var s=0;o>s;s++){var r=this._selectorColumns[s],n=this.cell(l[c],r.id).element;n&&(n=(n.contents||n).input,n&&!n.disabled&&(n.checked=e,n.setAttribute("aria-checked",e)))}},_updateHeaderCheckboxes:function(){for(var e=this._selectorColumns.length,t=0;e>t;t++){var l,i,o=this._selectorColumns[t],c="false",s=o._selectorHeaderCheckbox;if(s){l=this.selection,i=!1;for(var r in l)if(l[r]!=this.allSelected){i=!0;break}s.indeterminate=i,s.checked=this.allSelected,i?c="mixed":this.allSelected&&(c="true"),s.setAttribute("aria-checked",c)}}},configStructure:function(){this.inherited(arguments);var e=this.columns;this._selectorColumns=[],this._hasSelectorHeaderCheckbox=this._selectorSingleRow=!1;for(var t in e)e[t].selector&&this._configureSelectorColumn(e[t])},_handleSelect:function(e){var t=this.cell(e).column;t&&t.selector||this.inherited(arguments)}})});