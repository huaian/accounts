define("dgrid/ColumnSet",["dojo/_base/declare","dojo/_base/lang","dojo/dom-class","dojo/dom-construct","dojo/on","dojo/aspect","dojo/query","dojo/has","./util/misc","dojo/_base/sniff"],function(t,e,o,n,r,l,s,i,c){function u(t,e){var o=t._columnSetScrollLefts;s(".dgrid-column-set",e).forEach(function(t){t.scrollLeft=o[t.getAttribute(S)]})}function h(t,e){if(t&&t.length){for(var o=[],n=e+"-",r=0,l=t.length;l>r;r++){var s=t[r],i=[];i.className=s.className;for(var c=0,u=s.length;u>c;c++){var h=s[c];null!=h.id&&0===h.id.indexOf(n)&&i.push(h)}o.push(i)}return o}}function d(t,e){return e&&t===e||o.contains(t,"dgrid")}function a(t,e){for(1!==t.nodeType&&(t=t.parentNode);t&&!s.matches(t,".dgrid-column-set["+S+"]",e);){if(d(t,e))return null;t=t.parentNode}return t}function f(t){var e=i("pointer");return e?(t=g[t]||t,"MS"===e.slice(0,2)?"MSPointer"+t.slice(0,1).toUpperCase()+t.slice(1):"pointer"+t):"touch"+t}function m(t,e,o){var n=e.getAttribute(S),r=t._columnSetScrollers[n],l=r.scrollLeft+o;r.scrollLeft=0>l?0:l}i.add("event-mousewheel",function(t,e,o){return"onmousewheel"in o}),i.add("event-wheel",function(t,e,o){return"onwheel"in o});var S="data-dgrid-column-set-id",g={start:"down",end:"up"},_=i("touch")&&function(t){return function(e,o){var n=[r(e,f("start"),function(o){if(!t._currentlyTouchedColumnSet){var n=a(o.target,e);!n||o.pointerType&&"touch"!==o.pointerType&&2!==o.pointerType||(t._currentlyTouchedColumnSet=n,t._lastColumnSetTouchX=o.clientX,t._lastColumnSetTouchY=o.clientY)}}),r(e,f("move"),function(e){if(null!==t._currentlyTouchedColumnSet){var n=a(e.target);n&&(o.call(null,t,n,t._lastColumnSetTouchX-e.clientX),t._lastColumnSetTouchX=e.clientX,t._lastColumnSetTouchY=e.clientY)}}),r(e,f("end"),function(){t._currentlyTouchedColumnSet=null})];return{remove:function(){for(var t=n.length;t--;)n[t].remove()}}}},v=i("event-mousewheel")||i("event-wheel")?function(t){return function(e,o){return r(e,i("event-wheel")?"wheel":"mousewheel",function(n){var r,l=a(n.target,e);l&&(r=n.deltaX||-n.wheelDeltaX/3,r&&o.call(null,t,l,r))})}}:function(t){return function(e,o){return r(e,".dgrid-column-set["+S+"]:MozMousePixelScroll",function(e){1===e.axis&&o.call(null,t,this,e.detail)})}};return t(null,{postCreate:function(){var t=this;this.inherited(arguments),this.on(v(this),m),i("touch")&&this.on(_(this),m),this.on(".dgrid-column-set:dgrid-cellfocusin",function(e){t._onColumnSetCellFocus(e,this)}),"function"==typeof this.expand&&l.after(this,"expand",function(e,o){return e.then(function(){var e=t.row(o[0]);t._expanded[e.id]&&u(t,e.element.connected)}),e})},columnSets:[],createRowCells:function(t,e,o,r){for(var l=n.create("table",{className:"dgrid-row-table"}),s=n.create("tbody",null,l),i=n.create("tr",null,s),c=0,u=this.columnSets.length;u>c;c++){var d=n.create(t,{className:"dgrid-column-set-cell dgrid-column-set-"+c},i);d=n.create("div",{className:"dgrid-column-set"},d),d.setAttribute(S,c);var a=h(o||this.subRows,c)||this.columnSets[c];d.appendChild(this.inherited(arguments,[t,e,a,r]))}return l},renderArray:function(){for(var t=this.inherited(arguments),e=0;e<t.length;e++)u(this,t[e]);return t},insertRow:function(){var t=this.inherited(arguments);return u(this,t),t},renderHeader:function(){function t(){i._positionScrollers()}this.inherited(arguments);var e,o,r=this.columnSets,s=this._columnSetScrollers,i=this;if(this._columnSetScrollerContents={},this._columnSetScrollLefts={},s)for(e in s)n.destroy(s[e]);else l.after(this,"resize",t,!0),l.after(this,"styleColumn",t,!0),this._columnSetScrollerNode=n.create("div",{className:"dgrid-column-set-scroller-container"},this.footerNode,"after");for(s=this._columnSetScrollers={},e=0,o=r.length;o>e;e++)this._putScroller(r[e],e);this._positionScrollers()},styleColumnSet:function(t,e){var o=this.addCssRule("#"+c.escapeCssIdentifier(this.domNode.id)+" .dgrid-column-set-"+c.escapeCssIdentifier(t,"-"),e);return this._positionScrollers(),o},_destroyColumns:function(){var t,e,o,n,r,l,s,i,c=this.columnSets.length;for(t=0;c>t;t++)for(l=this.columnSets[t],e=0,n=l.length;n>e;e++)for(s=l[e],o=0,r=s.length;r>o;o++)i=s[o],"function"==typeof i.destroy&&i.destroy();this.inherited(arguments)},configStructure:function(){this.columns={},this.subRows=[];for(var t=0,e=this.columnSets.length;e>t;t++)for(var o=this.columnSets[t],n=0;n<o.length;n++)o[n]=this._configColumns(t+"-"+n+"-",o[n]);this.inherited(arguments)},_positionScrollers:function(){var t,e,o,n,r=this.domNode,l=this._columnSetScrollers,c=this._columnSetScrollerContents,u=this.columnSets,h=0,d=0;for(t=0,e=u.length;e>t;t++)o=s(".dgrid-column-set["+S+'="'+t+'"]',r)[0],h=o.offsetWidth,n=o.firstChild.offsetWidth,c[t].style.width=n+"px",l[t].style.width=h+"px",i("ie")<9&&(l[t].style.overflowX=n>h?"scroll":"auto"),n>h&&d++;this._columnSetScrollerNode.style.bottom=this.showFooter?this.footerNode.offsetHeight+"px":"0",this.bodyNode.style.bottom=d?i("dom-scrollbar-height")+(i("ie")?1:0)+"px":"0"},_putScroller:function(t,o){var l=this._columnSetScrollers[o]=n.create("span",{className:"dgrid-column-set-scroller dgrid-column-set-scroller-"+o+(i("ie")<9?" dgrid-scrollbar-height":"")},this._columnSetScrollerNode);l.setAttribute(S,o),this._columnSetScrollerContents[o]=n.create("div",{className:"dgrid-column-set-scroller-content"},l),r(l,"scroll",e.hitch(this,"_onColumnSetScroll"))},_onColumnSetScroll:function(t){var e,o=t.target.scrollLeft,n=t.target.getAttribute(S);this._columnSetScrollLefts[n]!==o&&(s(".dgrid-column-set["+S+'="'+n+'"],.dgrid-column-set-scroller['+S+'="'+n+'"]',this.domNode).forEach(function(t,n){t.scrollLeft=o,n||(e=t.scrollLeft)}),this._columnSetScrollLefts[n]=e)},_setColumnSets:function(t){this._destroyColumns(),this.columnSets=t,this._updateColumns()},_scrollColumnSet:function(t,e){var o=t.tagName?t.getAttribute(S):t,n=this._columnSetScrollers[o];n.scrollLeft=0>e?0:e},_onColumnSetCellFocus:function(t,e){var o=t.target,n=e.getAttribute(S),r=this._columnSetScrollers[n],l=o.offsetLeft-r.scrollLeft+o.offsetWidth;(l>e.offsetWidth||r.scrollLeft>o.offsetLeft)&&this._scrollColumnSet(e,o.offsetLeft)}})});