define("dgrid/CellSelection",["dojo/_base/declare","dojo/aspect","dojo/dom-class","dojo/on","dojo/has","./Selection"],function(e,t,i,l,n,o){return e(o,{selectionDelegate:".dgrid-cell",_selectionTargetType:"cells",_select:function(e,t,l){var n,o;if("undefined"==typeof l&&(l=!0),"object"==typeof e&&"element"in e){if(!e.row){if(l&&"object"==typeof l)for(o in l)this._select(this.cell(e.id,o),null,l[o]);else for(o in this.columns)this._select(this.cell(e.id,o),null,l);return}}else e=this.cell(e);if(this.allowSelect(e)){var s=this.selection,c=e.row.id,r=s[c];if(!e.column){for(n in this.columns)this._select(this.cell(c,n),null,l);return}var d=r&&r[e.column.id];null===l&&(l=!d);var u=e.element;r=r||{},r[e.column.id]=l,this.selection[c]=r;var h=!1;for(n in r)if(r[n]===!0){h=!0;break}if(h||delete this.selection[c],u&&(l?i.add(u,"dgrid-selected"+(this.addUiClasses?" ui-state-active":"")):i.remove(u,"dgrid-selected ui-state-active")),l!=d&&u&&this._selectionEventQueues[(l?"":"de")+"select"].push(e),t){if(t.element||(t=this.cell(t)),!t||!t.row)return void(this._lastSelected=u);var a=t.element,f=e.element,m=this._determineSelectionDirection(f,a);m||(t=this.cell(document.getElementById(t.row.element.id),a.columnId),a=t&&t.element,m=this._determineSelectionDirection(f,a));var v,w=e.column.id,S=t.column.id,g=[];for(o in this.columns)if(v&&g.push(o),o===w&&(w=g)||o===S&&(S=g)){if(g.push(o),v||w==g&&o==S)break;v=!0}var _=e.row,p=_.element;a=t.row.element;do{for(n=0;n<g.length;n++)e=this.cell(p,g[n]),this._select(e,null,l);if(p==a)break}while(p=e.row.element[m])}}},_determineSelectionDirection:function(){var e=this.inherited(arguments);return"down"===e?"nextSibling":"up"===e?"previousSibling":e},isSelected:function(e,t){if("undefined"==typeof e||null===e)return!1;e.element||(e=this.cell(e,t));var i=e.row.id;return i in this.selection?!!this.selection[i][e.column.id]:this.allSelected&&(!e.row.data||this.allowSelect(e))},clearSelection:function(e){e=!1,this.inherited(arguments)}})});