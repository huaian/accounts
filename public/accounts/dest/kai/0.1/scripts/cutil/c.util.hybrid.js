define("cutil/c.util.hybrid",[],function(){"use strict";window.resolveLocalFileSystemURL=window.resolveLocalFileSystemURL||window.webkitResolveLocalFileSystemURL;var o={};return o.updateAPK=function(o){var o=o||{};return"undefined"==typeof cordova?(Kai.showToast("当前不是app环境"),!1):cordova.file?void window.resolveLocalFileSystemURL(cordova.file.externalRootDirectory,function(e){e.getDirectory(o.apkStoredDirectory||"",{create:!0,exclusive:!1},function(e){var t,n=new FileTransfer,i=encodeURI(o.apkDownloadURL);n.onprogress=function(o){t=Math.round(o.loaded/o.total*100)};for(var a=0;1e3>a;a++)_.delay(function(){Kai.showConfirm({datamodel:{title:"版本升级进度",content:(t||0)+"%",btns:[]}})},500*a);n.download(i,e.toInternalURL()+o.apkName+".apk",function(o){cordova.plugins.fileOpener2.open(o.toInternalURL(),"application/vnd.android.package-archive",{error:function(o){},success:function(){}})},function(o){Kai.showToast({text:JSON.stringify(o)})},!0)},function(){Kai.showToast({text:"升级失败－－创建安装包目录失败"})})}):(Kai.showToast("当前环境不支持升级"),!1)},o.removeFiles=function(o){var o=o||{};return"undefined"==typeof cordova?(Kai.showToast("当前不是app环境"),!1):cordova.file?void window.resolveLocalFileSystemURL(cordova.file.externalRootDirectory,function(e){e.getDirectory(o.directory,{create:!0,exclusive:!1},function(o){o.removeRecursively(function(){},function(){})},function(){Kai.showToast({text:"升级失败－－创建安装包目录失败"})})}):(Kai.showToast("当前环境不支持升级"),!1)},o.start=function(e){var e=e||{},t=e.controller,n=e.app;if(_.isEmpty(e))throw Error("配置不能为空");var i=dojoConfig.cacheBust.match(/_v=(\w{0,}).{0,1}\w{0,}_k/)[1];e.hybridResStore.version.get("").then(function(a){return a&&a.body?void(i&&a.body.version>i?Kai.showConfirm({datamodel:{title:"版本升级提示",content:"当前版本为"+i+",存在更新版本"+a.body.version+",是否升级?",btns:[{name:"升级",className:"cui-btns-ok"},{name:"取消",className:"cui-btns-cancel"}]},okAction:function(){o.updateAPK({apkStoredDirectory:e.apkStoredDirectory,apkName:e.apkName,apkDownloadURL:Kai.env.hybrid.apkDownloadURL}),this.hide()},cancelAction:function(){this.hide(),t.start(n)}}):t.start(n)):(t.start(n),!1)},function(o){t.start(n)})},o});