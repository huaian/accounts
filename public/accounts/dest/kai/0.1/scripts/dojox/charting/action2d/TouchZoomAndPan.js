define("dojox/charting/action2d/TouchZoomAndPan",["dojo/_base/lang","dojo/_base/declare","dojo/_base/event","dojo/sniff","./ChartAction","../Element","dojo/touch","../plot2d/common","dojo/has!dojo-bidi?../bidi/action2d/ZoomAndPan"],function(t,e,a,o,i,s,h,r,n){var c=e(s,{constructor:function(t){},render:function(){this.isDirty()&&(this.cleanGroup(),this.group.createRect({width:this.chart.dim.width,height:this.chart.dim.height}).setFill("rgba(0,0,0,0)"))},clear:function(){return this.dirty=!0,this.chart.stack[0]!=this&&this.chart.movePlotToFront(this.name),this},getSeriesStats:function(){return t.delegate(r.defaultStats)},initializeScalers:function(){return this},isDirty:function(){return this.dirty}}),d=e(o("dojo-bidi")?"dojox.charting.action2d.NonBidiTouchZoomAndPan":"dojox.charting.action2d.TouchZoomAndPan",i,{defaultParams:{axis:"x",scaleFactor:1.2,maxScale:100,enableScroll:!0,enableZoom:!0},optionalParams:{},constructor:function(t,e,a){this._listeners=[{eventName:h.press,methodName:"onTouchStart"},{eventName:h.move,methodName:"onTouchMove"},{eventName:h.release,methodName:"onTouchEnd"}],a||(a={}),this.axis=a.axis?a.axis:"x",this.scaleFactor=a.scaleFactor?a.scaleFactor:1.2,this.maxScale=a.maxScale?a.maxScale:100,this.enableScroll=void 0!=a.enableScroll?a.enableScroll:!0,this.enableZoom=void 0!=a.enableScroll?a.enableZoom:!0,this._uName="touchZoomPan"+this.axis,this.connect()},connect:function(){this.inherited(arguments),-1!=this.chart.surface.declaredClass.indexOf("svg")&&this.chart.addPlot(this._uName,{type:c})},disconnect:function(){-1!=this.chart.surface.declaredClass.indexOf("svg")&&this.chart.removePlot(this._uName),this.inherited(arguments)},onTouchStart:function(t){var e=this.chart,o=e.getAxis(this.axis),i=t.touches?t.touches.length:1,s=t.touches?t.touches[0]:t,h=this._startPageCoord;if(this._startPageCoord={x:s.pageX,y:s.pageY},(this.enableZoom||this.enableScroll)&&e._delayedRenderHandle&&e.render(),this.enableZoom&&i>=2){this._startTime=0,this._endPageCoord={x:t.touches[1].pageX,y:t.touches[1].pageY};var r={x:(this._startPageCoord.x+this._endPageCoord.x)/2,y:(this._startPageCoord.y+this._endPageCoord.y)/2},n=o.getScaler();this._initScale=o.getWindowScale();var c=this._initData=this.plot.toData();this._middleCoord=c(r)[this.axis],this._startCoord=n.bounds.from,this._endCoord=n.bounds.to}else t.touches&&1!=t.touches.length?this._startTime=0:this._startTime?(new Date).getTime()-this._startTime<250&&Math.abs(this._startPageCoord.x-h.x)<30&&Math.abs(this._startPageCoord.y-h.y)<30?(this._startTime=0,this.onDoubleTap(t)):this._startTime=0:this._startTime=(new Date).getTime(),this.enableScroll&&(this._startScroll(o),a.stop(t))},onTouchMove:function(t){var e=this.chart,o=e.getAxis(this.axis),i=t.touches?t.touches.length:1,s=o.vertical?"pageY":"pageX",h=o.vertical?"y":"x";if(this._startTime=0,this.enableZoom&&i>=2){var r={x:(t.touches[1].pageX+t.touches[0].pageX)/2,y:(t.touches[1].pageY+t.touches[0].pageY)/2},n=(this._endPageCoord[h]-this._startPageCoord[h])/(t.touches[1][s]-t.touches[0][s]);if(this._initScale/n>this.maxScale)return;var c=this._initData(r)[this.axis],d=n*(this._startCoord-c)+this._middleCoord,l=n*(this._endCoord-c)+this._middleCoord;e.zoomIn(this.axis,[d,l]),a.stop(t)}else if(this.enableScroll){var u=this._getDelta(t);e.setAxisWindow(this.axis,this._lastScale,this._initOffset-u/this._lastFactor/this._lastScale),e.delayedRender(),a.stop(t)}},onTouchEnd:function(t){var e=this.chart,a=e.getAxis(this.axis);if((!t.touches||1==t.touches.length)&&this.enableScroll){var o=t.touches?t.touches[0]:t;this._startPageCoord={x:o.pageX,y:o.pageY},this._startScroll(a)}},_startScroll:function(t){var e=t.getScaler().bounds;this._initOffset=t.getWindowOffset(),this._lastScale=t.getWindowScale(),this._lastFactor=e.span/(e.upper-e.lower)},onDoubleTap:function(t){var e=this.chart,o=e.getAxis(this.axis),i=1/this.scaleFactor;if(1==o.getWindowScale()){var s=o.getScaler(),h=s.bounds.from,r=s.bounds.to,n=(h+r)/2,c=this.plot.toData(this._startPageCoord)[this.axis],d=i*(h-n)+c,l=i*(r-n)+c;e.zoomIn(this.axis,[d,l])}else e.setAxisWindow(this.axis,1,0),e.render();a.stop(t)},_getDelta:function(t){var e=this.chart.getAxis(this.axis),a=e.vertical?"pageY":"pageX",o=e.vertical?"y":"x",i=t.touches?t.touches[0]:t;return e.vertical?this._startPageCoord[o]-i[a]:i[a]-this._startPageCoord[o]}});return o("dojo-bidi")?e("dojox.charting.action2d.TouchZoomAndPan",[d,n]):d});