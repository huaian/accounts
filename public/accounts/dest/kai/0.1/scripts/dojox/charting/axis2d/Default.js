define("dojox/charting/axis2d/Default",["dojo/_base/lang","dojo/_base/array","dojo/sniff","dojo/_base/declare","dojo/_base/connect","dojo/dom-geometry","./Invisible","../scaler/linear","./common","dojox/gfx","dojox/lang/utils","dojox/lang/functional","dojo/has!dojo-bidi?../bidi/axis2d/Default"],function(t,e,i,a,l,r,n,o,s,h,c,m,x){var b=45,d=a(i("dojo-bidi")?"dojox.charting.axis2d.NonBidiDefault":"dojox.charting.axis2d.Default",n,{defaultParams:{vertical:!1,fixUpper:"none",fixLower:"none",natural:!1,leftBottom:!0,includeZero:!1,fixed:!0,majorLabels:!0,minorTicks:!0,minorLabels:!0,microTicks:!1,rotation:0,htmlLabels:!0,enableCache:!1,dropLabels:!0,labelSizeChange:!1,position:"leftOrBottom"},optionalParams:{min:0,max:1,from:0,to:1,majorTickStep:4,minorTickStep:2,microTickStep:1,labels:[],labelFunc:null,maxLabelSize:0,maxLabelCharCount:0,trailingSymbol:null,stroke:{},majorTick:{},minorTick:{},microTick:{},tick:{},font:"",fontColor:"",title:"",titleGap:0,titleFont:"",titleFontColor:"",titleOrientation:""},constructor:function(e,i){this.opt=t.clone(this.defaultParams),c.updateWithObject(this.opt,i),c.updateWithPattern(this.opt,i,this.optionalParams),this.opt.enableCache&&(this._textFreePool=[],this._lineFreePool=[],this._textUsePool=[],this._lineUsePool=[]),this._invalidMaxLabelSize=!0,i&&"position"in i||(this.opt.position=this.opt.leftBottom?"leftOrBottom":"rightOrTop"),this.renderingOptions={"shape-rendering":"crispEdges"}},setWindow:function(t,e){return t!=this.scale&&(this._invalidMaxLabelSize=!0),this.inherited(arguments)},_groupLabelWidth:function(e,i,a){if(!e.length)return 0;e.length>50&&(e.length=50),t.isObject(e[0])&&(e=m.map(e,function(t){return t.text})),a&&(e=m.map(e,function(e){return 0==t.trim(e).length?"":e.substring(0,a)+this.trailingSymbol},this));var l=e.join("<br>");return h._base._getTextBox(l,{font:i}).w||0},_getMaxLabelSize:function(i,a,l,r,n,s){if(null==this._maxLabelSize&&6==arguments.length){var h=this.opt;this.scaler.minMinorStep=this._prevMinMinorStep=0;var c=t.clone(h);delete c.to,delete c.from;var m=o.buildScaler(i,a,l,c,h.to-h.from);m.minMinorStep=0,this._majorStart=m.major.start;var x=o.buildTicks(m,h);if(s&&x){var b=0,d=0,u=function(t){t.label&&this.push(t.label)},p=[];this.opt.majorLabels&&(e.forEach(x.major,u,p),b=this._groupLabelWidth(p,n,c.maxLabelCharCount),c.maxLabelSize&&(b=Math.min(c.maxLabelSize,b))),p=[],this.opt.dropLabels&&this.opt.minorLabels&&(e.forEach(x.minor,u,p),d=this._groupLabelWidth(p,n,c.maxLabelCharCount),c.maxLabelSize&&(d=Math.min(c.maxLabelSize,d))),this._maxLabelSize={majLabelW:b,minLabelW:d,majLabelH:s,minLabelH:s}}else this._maxLabelSize=null}return this._maxLabelSize},calculate:function(t,e,i){if(this.inherited(arguments),this.scaler.minMinorStep=this._prevMinMinorStep,(this._invalidMaxLabelSize||i!=this._oldSpan)&&t!=1/0&&e!=-(1/0)){this._invalidMaxLabelSize=!1,this.opt.labelSizeChange&&(this._maxLabelSize=null),this._oldSpan=i;var a=this.opt,l=this.chart.theme.axis,r=a.rotation%360,n=this.chart.theme.axis.tick.labelGap,s=a.font||l.majorTick&&l.majorTick.font||l.tick&&l.tick.font,c=s?h.normalizedLength(h.splitFontString(s).size):0,m=this._getMaxLabelSize(t,e,i,r,s,c);if("number"!=typeof n&&(n=4),m&&a.dropLabels){var x,b,d=Math.abs(Math.cos(r*Math.PI/180)),u=Math.abs(Math.sin(r*Math.PI/180));switch(0>r&&(r+=360),r){case 0:case 180:this.vertical?x=b=c:(x=m.majLabelW,b=m.minLabelW);break;case 90:case 270:this.vertical?(x=m.majLabelW,b=m.minLabelW):x=b=c;break;default:x=this.vertical?Math.min(m.majLabelW,c/d):Math.min(m.majLabelW,c/u);var p=Math.sqrt(m.minLabelW*m.minLabelW+c*c),g=this.vertical?c*d+m.minLabelW*u:m.minLabelW*d+c*u;b=Math.min(p,g)}this.scaler.minMinorStep=this._prevMinMinorStep=Math.max(x,b)+n;var f=this.scaler.minMinorStep<=this.scaler.minor.tick*this.scaler.bounds.scale;f?this._skipInterval=0:this._skipInterval=Math.floor((x+n)/(this.scaler.major.tick*this.scaler.bounds.scale))}else this._skipInterval=0}return this.ticks=o.buildTicks(this.scaler,this.opt),this},getOffsets:function(){var t=this.scaler,e={l:0,r:0,t:0,b:0};if(!t)return e;var i=this.opt,a=this.chart.theme.axis,l=this.chart.theme.axis.tick.labelGap,r=i.titleFont||a.title&&a.title.font,n=0==i.titleGap?0:i.titleGap||a.title&&a.title.gap,o=this.chart.theme.getTick("major",i),s=this.chart.theme.getTick("minor",i),c=r?h.normalizedLength(h.splitFontString(r).size):0,m=i.rotation%360,x=i.position,d="rightOrTop"!==x,u=Math.abs(Math.cos(m*Math.PI/180)),p=Math.abs(Math.sin(m*Math.PI/180));this.trailingSymbol=void 0===i.trailingSymbol||null===i.trailingSymbol?this.trailingSymbol:i.trailingSymbol,"number"!=typeof l&&(l=4),0>m&&(m+=360);var g=this._getMaxLabelSize();if(g){var f,y=Math.ceil(Math.max(g.majLabelW,g.minLabelW))+1,L=Math.ceil(Math.max(g.majLabelH,g.minLabelH))+1;if(this.vertical){switch(f=d?"l":"r",m){case 0:case 180:e[f]="center"===x?0:y,e.t=e.b=L/2;break;case 90:case 270:e[f]=L,e.t=e.b=y/2;break;default:b>=m||m>180&&180+b>=m?(e[f]=L*p/2+y*u,e[d?"t":"b"]=L*u/2+y*p,e[d?"b":"t"]=L*u/2):m>360-b||180>m&&m>180-b?(e[f]=L*p/2+y*u,e[d?"b":"t"]=L*u/2+y*p,e[d?"t":"b"]=L*u/2):90>m||m>180&&270>m?(e[f]=L*p+y*u,e[d?"t":"b"]=L*u+y*p):(e[f]=L*p+y*u,e[d?"b":"t"]=L*u+y*p)}"center"===x?e[f]=0:e[f]+=l+Math.max(o.length>0?o.length:0,s.length>0?s.length:0)+(i.title?c+n:0)}else{switch(f=d?"b":"t",m){case 0:case 180:e[f]="center"===x?0:L,e.l=e.r=y/2;break;case 90:case 270:e[f]=y,e.l=e.r=L/2;break;default:m>=90-b&&90>=m||m>=270-b&&270>=m?(e[f]=L*u/2+y*p,e[d?"r":"l"]=L*p/2+y*u,e[d?"l":"r"]=L*p/2):m>=90&&90+b>=m||m>=270&&270+b>=m?(e[f]=L*u/2+y*p,e[d?"l":"r"]=L*p/2+y*u,e[d?"r":"l"]=L*p/2):b>m||m>180&&180+b>m?(e[f]=L*u+y*p,e[d?"r":"l"]=L*p+y*u):(e[f]=L*u+y*p,e[d?"l":"r"]=L*p+y*u)}"center"===x?e[f]=0:e[f]+=l+Math.max(o.length>0?o.length:0,s.length>0?s.length:0)+(i.title?c+n:0)}}return e},cleanGroup:function(t){this.opt.enableCache&&this.group&&(this._lineFreePool=this._lineFreePool.concat(this._lineUsePool),this._lineUsePool=[],this._textFreePool=this._textFreePool.concat(this._textUsePool),this._textUsePool=[]),this.inherited(arguments)},createText:function(t,e,i,a,l,r,n,o,h){if(!this.opt.enableCache||"html"==t)return s.createText[t](this.chart,e,i,a,l,r,n,o,h);var c;return this._textFreePool.length>0?(c=this._textFreePool.pop(),c.setShape({x:i,y:a,text:r,align:l}),e.add(c)):c=s.createText[t](this.chart,e,i,a,l,r,n,o),this._textUsePool.push(c),c},createLine:function(t,e){var i;return this.opt.enableCache&&this._lineFreePool.length>0?(i=this._lineFreePool.pop(),i.setShape(e),t.add(i)):i=t.createLine(e),this.opt.enableCache&&this._lineUsePool.push(i),i},render:function(t,a){var l=this._isRtl();if(!this.dirty||!this.scaler)return this;var r,n,c,m,x,d,u,p,g,f=this.opt,y=this.chart.theme.axis,L=f.position,k="rightOrTop"!==L,v=f.rotation%360,M=0,S=this.chart.theme.axis.tick.labelGap,_=f.font||y.majorTick&&y.majorTick.font||y.tick&&y.tick.font,j=f.titleFont||y.title&&y.title.font,T=f.fontColor||y.majorTick&&y.majorTick.fontColor||y.tick&&y.tick.fontColor||"black",C=f.titleFontColor||y.title&&y.title.fontColor||"black",z=0==f.titleGap?0:f.titleGap||y.title&&y.title.gap||15,P=f.titleOrientation||y.title&&y.title.orientation||"axis",W=this.chart.theme.getTick("major",f),w=this.chart.theme.getTick("minor",f),F=this.chart.theme.getTick("micro",f),I="stroke"in f?f.stroke:y.stroke,O=_?h.normalizedLength(h.splitFontString(_).size):0,G=Math.abs(Math.cos(v*Math.PI/180)),E=Math.abs(Math.sin(v*Math.PI/180)),U=j?h.normalizedLength(h.splitFontString(j).size):0;"number"!=typeof S&&(S=4),0>v&&(v+=360);var B=this._getMaxLabelSize();if(B=B&&B.majLabelW,this.vertical){switch(r={y:t.height-a.b},n={y:a.t},c={y:(t.height-a.b+a.t)/2},m=O*E+(B||0)*G+S+Math.max(W.length>0?W.length:0,w.length>0?w.length:0)+U+z,x={x:0,y:-1},p={x:0,y:0},d={x:1,y:0},u={x:S,y:0},v){case 0:g="end",p.y=.4*O;break;case 90:g="middle",p.x=-O;break;case 180:g="start",p.y=.4*-O;break;case 270:g="middle";break;default:b>v?(g="end",p.y=.4*O):90>v?(g="end",p.y=.4*O):180-b>v?g="start":180+b>v?(g="start",p.y=.4*-O):270>v?(g="start",p.x=k?0:.4*O):360-b>v?(g="end",p.x=k?0:.4*O):(g="end",p.y=.4*O)}if(k)r.x=n.x="center"===L?t.width/2:a.l,M=P&&"away"==P?90:270,c.x=a.l-m+(270==M?U:0),d.x=-1,u.x=-u.x;else switch(r.x=n.x=t.width-a.r,M=P&&"axis"==P?90:270,c.x=t.width-a.r+m-(270==M?0:U),g){case"start":g="end";break;case"end":g="start";break;case"middle":p.x+=O}}else{switch(r={x:a.l},n={x:t.width-a.r},c={x:(t.width-a.r+a.l)/2},m=O*G+(B||0)*E+S+Math.max(W.length>0?W.length:0,w.length>0?w.length:0)+U+z,x={x:l?-1:1,y:0},p={x:0,y:0},d={x:0,y:1},u={x:0,y:S},v){case 0:g="middle",p.y=O;break;case 90:g="start",p.x=.4*-O;break;case 180:g="middle";break;case 270:g="end",p.x=.4*O;break;default:90-b>v?(g="start",p.y=k?O:0):90+b>v?(g="start",p.x=.4*-O):180>v?(g="start",p.y=k?0:-O):270-b>v?(g="end",p.y=k?0:-O):270+b>v?(g="end",p.y=k?.4*O:0):(g="end",p.y=k?O:0)}if(k)r.y=n.y="center"===L?t.height/2:t.height-a.b,M=P&&"axis"==P?180:0,c.y=t.height-a.b+m-(M?U:0);else switch(r.y=n.y=a.t,M=P&&"away"==P?180:0,c.y=a.t-m+(M?0:U),d.y=-1,u.y=-u.y,g){case"start":g="end";break;case"end":g="start";break;case"middle":p.y-=O}}this.cleanGroup();var q=this.group,D=this.scaler,H=this.ticks,A=o.getTransformerFromModel(this.scaler),R=f.title&&M||v||!this.opt.htmlLabels||i("ie")||i("opera")?"gfx":"html",N=d.x*W.length,Z=d.y*W.length,J=this._skipInterval;if(q.createLine({x1:r.x,y1:r.y,x2:n.x,y2:n.y}).setStroke(I),f.title){var K=s.createText[R](this.chart,q,c.x,c.y,"middle",f.title,j,C);"html"==R?this.htmlElements.push(K):K.setTransform(h.matrix.rotategAt(M,c.x,c.y))}if(null==H)return this.dirty=!1,this;var Q=H.major.length>0?(H.major[0].value-this._majorStart)/D.major.tick:0,V=this.opt.majorLabels;return e.forEach(H.major,function(t,e){var i,a=A(t.value),o=(l?n.x:r.x)+x.x*a,s=r.y+x.y*a;if(e+=Q,this.createLine(q,{x1:o,y1:s,x2:o+N,y2:s+Z}).setStroke(W),t.label&&(!J||(e-(1+J))%(1+J)==0)){var c=f.maxLabelCharCount?this.getTextWithLimitCharCount(t.label,_,f.maxLabelCharCount):{text:t.label,truncated:!1};c=f.maxLabelSize?this.getTextWithLimitLength(c.text,_,f.maxLabelSize,c.truncated):c,i=this.createText(R,q,o+(W.length>0?N:0)+u.x+(v?0:p.x),s+(W.length>0?Z:0)+u.y+(v?0:p.y),g,c.text,_,T),c.truncated&&this.chart.formatTruncatedLabel(i,t.label,R),c.truncated&&this.labelTooltip(i,this.chart,t.label,c.text,_,R),"html"==R?this.htmlElements.push(i):v&&i.setTransform([{dx:p.x,dy:p.y},h.matrix.rotategAt(v,o+(W.length>0?N:0)+u.x,s+(W.length>0?Z:0)+u.y)])}},this),N=d.x*w.length,Z=d.y*w.length,V=this.opt.minorLabels&&D.minMinorStep<=D.minor.tick*D.bounds.scale,e.forEach(H.minor,function(t){var e,i=A(t.value),a=(l?n.x:r.x)+x.x*i,o=r.y+x.y*i;if(this.createLine(q,{x1:a,y1:o,x2:a+N,y2:o+Z}).setStroke(w),V&&t.label){var s=f.maxLabelCharCount?this.getTextWithLimitCharCount(t.label,_,f.maxLabelCharCount):{text:t.label,truncated:!1};s=f.maxLabelSize?this.getTextWithLimitLength(s.text,_,f.maxLabelSize,s.truncated):s,e=this.createText(R,q,a+(w.length>0?N:0)+u.x+(v?0:p.x),o+(w.length>0?Z:0)+u.y+(v?0:p.y),g,s.text,_,T),s.truncated&&this.chart.formatTruncatedLabel(e,t.label,R),s.truncated&&this.labelTooltip(e,this.chart,t.label,s.text,_,R),"html"==R?this.htmlElements.push(e):v&&e.setTransform([{dx:p.x,dy:p.y},h.matrix.rotategAt(v,a+(w.length>0?N:0)+u.x,o+(w.length>0?Z:0)+u.y)])}},this),N=d.x*F.length,Z=d.y*F.length,e.forEach(H.micro,function(t){var e=A(t.value),i=r.x+x.x*e,a=r.y+x.y*e;this.createLine(q,{x1:i,y1:a,x2:i+N,y2:a+Z}).setStroke(F)},this),this.dirty=!1,this},labelTooltip:function(e,i,a,n,o,s){var c=["dijit/Tooltip"],m={type:"rect"},x=["above","below"],b=h._base._getTextBox(n,{font:o}).w||0,d=o?h.normalizedLength(h.splitFontString(o).size):0;if("html"==s)t.mixin(m,r.position(e.firstChild,!0)),m.width=Math.ceil(b),m.height=Math.ceil(d),this._events.push({shape:dojo,handle:l.connect(e.firstChild,"onmouseover",this,function(t){require(c,function(t){t.show(a,m,x)})})}),this._events.push({shape:dojo,handle:l.connect(e.firstChild,"onmouseout",this,function(t){require(c,function(t){t.hide(m)})})});else{var u=e.getShape(),p=i.getCoords();m=t.mixin(m,{x:u.x-b/2,y:u.y}),m.x+=p.x,m.y+=p.y,m.x=Math.round(m.x),m.y=Math.round(m.y),m.width=Math.ceil(b),m.height=Math.ceil(d),this._events.push({shape:e,handle:e.connect("onmouseenter",this,function(t){require(c,function(t){t.show(a,m,x)})})}),this._events.push({shape:e,handle:e.connect("onmouseleave",this,function(t){require(c,function(t){t.hide(m)})})})}},_isRtl:function(){return!1}});return i("dojo-bidi")?a("dojox.charting.axis2d.Default",[d,x]):d});