define("dojox/layout/ResizeHandle",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/connect","dojo/_base/array","dojo/_base/event","dojo/_base/fx","dojo/_base/window","dojo/fx","dojo/dom","dojo/dom-class","dojo/dom-geometry","dojo/dom-style","dojo/_base/declare","dojo/touch","dijit/_base/manager","dijit/_Widget","dijit/_TemplatedMixin"],function(t,e,i,s,o,a,h,r,n,d,z,g,c,l,m,p,_){t.experimental("dojox.layout.ResizeHandle");var x=c("dojox.layout._ResizeHelper",p,{show:function(){g.set(this.domNode,"display","")},hide:function(){g.set(this.domNode,"display","none")},resize:function(t){z.setMarginBox(this.domNode,t)}}),w=c("dojox.layout.ResizeHandle",[p,_],{targetId:"",targetContainer:null,resizeAxis:"xy",activeResize:!1,activeResizeClass:"dojoxResizeHandleClone",animateSizing:!0,animateMethod:"chain",animateDuration:225,minHeight:100,minWidth:100,constrainMax:!1,maxHeight:0,maxWidth:0,fixedAspect:!1,intermediateChanges:!1,startTopic:"/dojo/resize/start",endTopic:"/dojo/resize/stop",templateString:'<div dojoAttachPoint="resizeHandle" class="dojoxResizeHandle"><div></div></div>',postCreate:function(){this.connect(this.resizeHandle,l.press,"_beginSizing"),this.activeResize?this.animateSizing=!1:(this._resizeHelper=m.byId("dojoxGlobalResizeHelper"),this._resizeHelper||(this._resizeHelper=new x({id:"dojoxGlobalResizeHelper"}).placeAt(h.body()),d.add(this._resizeHelper.domNode,this.activeResizeClass))),this.minSize||(this.minSize={w:this.minWidth,h:this.minHeight}),this.constrainMax&&(this.maxSize={w:this.maxWidth,h:this.maxHeight}),this._resizeX=this._resizeY=!1;var t=e.partial(d.add,this.resizeHandle);switch(this.resizeAxis.toLowerCase()){case"xy":this._resizeX=this._resizeY=!0,t("dojoxResizeNW");break;case"x":this._resizeX=!0,t("dojoxResizeW");break;case"y":this._resizeY=!0,t("dojoxResizeN")}},_beginSizing:function(t){if(!this._isSizing&&(i.publish(this.startTopic,[this]),this.targetWidget=m.byId(this.targetId),this.targetDomNode=this.targetWidget?this.targetWidget.domNode:n.byId(this.targetId),this.targetContainer&&(this.targetDomNode=this.targetContainer),this.targetDomNode)){if(!this.activeResize){var e=z.position(this.targetDomNode,!0);this._resizeHelper.resize({l:e.x,t:e.y,w:e.w,h:e.h}),this._resizeHelper.show(),this.isLeftToRight()||(this._resizeHelper.startPosition={l:e.x,t:e.y})}this._isSizing=!0,this.startPoint={x:t.clientX,y:t.clientY};var s=g.getComputedStyle(this.targetDomNode),a="border-model"===z.boxModel,r=a?{w:0,h:0}:z.getPadBorderExtents(this.targetDomNode,s),d=z.getMarginExtents(this.targetDomNode,s);if(this.startSize={w:g.get(this.targetDomNode,"width",s),h:g.get(this.targetDomNode,"height",s),pbw:r.w,pbh:r.h,mw:d.w,mh:d.h},!this.isLeftToRight()&&"absolute"==g.get(this.targetDomNode,"position")){var c=z.position(this.targetDomNode,!0);this.startPosition={l:c.x,t:c.y}}this._pconnects=[i.connect(h.doc,l.move,this,"_updateSizing"),i.connect(h.doc,l.release,this,"_endSizing")],o.stop(t)}},_updateSizing:function(t){if(this.activeResize)this._changeSizing(t);else{var e=this._getNewCoords(t,"border",this._resizeHelper.startPosition);if(e===!1)return;this._resizeHelper.resize(e)}t.preventDefault()},_getNewCoords:function(t,e,i){try{if(!t.clientX||!t.clientY)return!1}catch(s){return!1}this._activeResizeLastEvent=t;var o=(this.isLeftToRight()?1:-1)*(this.startPoint.x-t.clientX),a=this.startPoint.y-t.clientY,h=this.startSize.w-(this._resizeX?o:0),r=this.startSize.h-(this._resizeY?a:0),n=this._checkConstraints(h,r);switch(i=i||this.startPosition,i&&this._resizeX&&(n.l=i.l+o,n.w!=h&&(n.l+=h-n.w),n.t=i.t),e){case"margin":n.w+=this.startSize.mw,n.h+=this.startSize.mh;case"border":n.w+=this.startSize.pbw,n.h+=this.startSize.pbh}return n},_checkConstraints:function(t,e){if(this.minSize){var i=this.minSize;t<i.w&&(t=i.w),e<i.h&&(e=i.h)}if(this.constrainMax&&this.maxSize){var s=this.maxSize;t>s.w&&(t=s.w),e>s.h&&(e=s.h)}if(this.fixedAspect){var o=this.startSize.w,a=this.startSize.h,h=o*e-a*t;0>h?t=e*o/a:h>0&&(e=t*a/o)}return{w:t,h:e}},_changeSizing:function(t){var i=this.targetWidget&&e.isFunction(this.targetWidget.resize),s=this._getNewCoords(t,i&&"margin");if(s!==!1){if(i)this.targetWidget.resize(s);else if(this.animateSizing){var o=r[this.animateMethod]([a.animateProperty({node:this.targetDomNode,properties:{width:{start:this.startSize.w,end:s.w}},duration:this.animateDuration}),a.animateProperty({node:this.targetDomNode,properties:{height:{start:this.startSize.h,end:s.h}},duration:this.animateDuration})]);o.play()}else g.set(this.targetDomNode,{width:s.w+"px",height:s.h+"px"});this.intermediateChanges&&this.onResize(t)}},_endSizing:function(t){s.forEach(this._pconnects,i.disconnect);var o=e.partial(i.publish,this.endTopic,[this]);this.activeResize?o():(this._resizeHelper.hide(),this._changeSizing(t),setTimeout(o,this.animateDuration+15)),this._isSizing=!1,this.onResize(t)},onResize:function(t){}});return w});