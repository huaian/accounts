define("dojox/atom/io/Connection",["dojo/_base/declare","dojo/_base/kernel","dojo/_base/xhr","./model"],function(e,t,r,s){return e("dojox.atom.io.Connection",null,{constructor:function(e,t){this.sync=e,this.preventCache=t},preventCache:!1,alertsEnabled:!1,getFeed:function(e,t,r,n){this._getXmlDoc(e,"feed",new s.Feed,s._Constants.ATOM_NS,t,r,n)},getService:function(e,t,r,n){this._getXmlDoc(e,"service",new s.Service(e),s._Constants.APP_NS,t,r,n)},getEntry:function(e,t,r,n){this._getXmlDoc(e,"entry",new s.Entry,s._Constants.ATOM_NS,t,r,n)},_getXmlDoc:function(e,s,n,o,a,l,i){i||(i=t.global);var c=this.alertsEnabled,h={url:e,handleAs:"xml",sync:this.sync,preventCache:this.preventCache,load:function(e,t){var r,l=null,h=e;if(h){if("undefined"!=typeof h.getElementsByTagNameNS)r=h.getElementsByTagNameNS(o,s),r&&r.length>0?l=r.item(0):h.lastChild&&(l=h.lastChild);else if("undefined"!=typeof h.getElementsByTagName)if(r=h.getElementsByTagName(s),r&&r.length>0){for(var d=0;d<r.length;d++)if(r[d].namespaceURI==o){l=r[d];break}}else h.lastChild&&(l=h.lastChild);else{if(!h.lastChild)return void a.call(i,null,null,t);l=h.lastChild}if(n.buildFromDom(l),a)a.call(i,n,h,t);else if(c)throw new Error("The callback value does not exist.")}else a.call(i,null,null,t)}};this.user&&null!==this.user&&(h.user=this.user),this.password&&null!==this.password&&(h.password=this.password),l?h.error=function(e,t){l.call(i,e,t)}:h.error=function(){throw new Error("The URL requested cannot be accessed")},r.get(h)},updateEntry:function(e,s,n,o,a,l){l||(l=t.global),e.updated=new Date;var i=e.getEditHref();if(!i)throw new Error("A URL has not been specified for editing this entry.");var c=this,h=this.alertsEnabled,d={url:i,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,load:function(t,r){var n=null;if(o){n=r.xhr.getResponseHeader("Location"),n||(n=i);var a=function(e,t,r){if(s)s.call(l,e,n,r);else if(h)throw new Error("The callback value does not exist.")};c.getEntry(n,a)}else if(s)s.call(l,e,r.xhr.getResponseHeader("Location"),r);else if(h)throw new Error("The callback value does not exist.");return t}};if(this.user&&null!==this.user&&(d.user=this.user),this.password&&null!==this.password&&(d.password=this.password),n?d.error=function(e,t){n.call(l,e,t)}:d.error=function(){throw new Error("The URL requested cannot be accessed")},a)d.postData=e.toString(!0),d.headers={"X-Method-Override":"PUT"},r.post(d);else{d.putData=e.toString(!0);r.put(d)}},addEntry:function(e,s,n,o,a,l){l||(l=t.global),e.published=new Date,e.updated=new Date;var i=e.feedUrl,c=this.alertsEnabled;if(!s&&i&&(s=i),s){var h=this,d={url:s,handleAs:"text",contentType:"text/xml",sync:this.sync,preventCache:this.preventCache,postData:e.toString(!0),load:function(t,r){var o=r.xhr.getResponseHeader("Location");if(o||(o=s),r.retrieveEntry){var a=function(e,t,r){if(n)n.call(l,e,o,r);else if(c)throw new Error("The callback value does not exist.")};h.getEntry(o,a)}else if(n)n.call(l,e,o,r);else if(c)throw new Error("The callback value does not exist.");return t}};this.user&&null!==this.user&&(d.user=this.user),this.password&&null!==this.password&&(d.password=this.password),o?d.error=function(e,t){o.call(l,e,t)}:d.error=function(){throw new Error("The URL requested cannot be accessed")},r.post(d)}else if(c)throw new Error("The request cannot be processed because the URL parameter is missing.")},deleteEntry:function(e,s,n,o,a){a||(a=t.global);var l=null;if(l="string"==typeof e?e:e.getEditHref(),!l)throw s.call(a,!1,null),new Error("The request cannot be processed because the URL parameter is missing.");var i={url:l,handleAs:"text",sync:this.sync,preventCache:this.preventCache,load:function(e,t){return s.call(a,t),e}};this.user&&null!==this.user&&(i.user=this.user),this.password&&null!==this.password&&(i.password=this.password),n?i.error=function(e,t){n.call(a,e,t)}:i.error=function(){throw new Error("The URL requested cannot be accessed")},o?(i.headers={"X-Method-Override":"DELETE"},dhxr.post(i)):r.del(i)}})});