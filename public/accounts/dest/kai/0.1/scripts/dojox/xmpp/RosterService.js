define("dojox/xmpp/RosterService",["dojo","dijit","dojox"],function(e,r,t){e.provide("dojox.xmpp.RosterService"),t.xmpp.roster={ADDED:101,CHANGED:102,REMOVED:103},e.declare("dojox.xmpp.RosterService",null,{constructor:function(e){this.session=e},addRosterItem:function(e,r,s){if(!e)throw new Error("Roster::addRosterItem() - User ID is null");var o=this.session.getNextIqId(),i={id:o,from:this.session.jid+"/"+this.session.resource,type:"set"},n=new t.string.Builder(t.xmpp.util.createElement("iq",i,!1));if(n.append(t.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1)),e=t.xmpp.util.encodeJid(e),-1==e.indexOf("@")&&(e=e+"@"+this.session.domain),n.append(t.xmpp.util.createElement("item",{jid:e,name:t.xmpp.util.xmlEncode(r)},!1)),s)for(var p=0;p<s.length;p++)n.append("<group>"),n.append(s[p]),n.append("</group>");n.append("</item></query></iq>");var u=this.session.dispatchPacket(n.toString(),"iq",i.id);return u.addCallback(this,"verifyRoster"),u},updateRosterItem:function(e,r,s){-1==e.indexOf("@")&&(e+=e+"@"+this.session.domain);var o={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"},i=new t.string.Builder(t.xmpp.util.createElement("iq",o,!1));i.append(t.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1));var n=this.session.getRosterIndex(e);if(-1!=n){var p={jid:e};r?p.name=r:this.session.roster[n].name&&(p.name=this.session.roster[n].name),p.name&&(p.name=t.xmpp.util.xmlEncode(p.name)),i.append(t.xmpp.util.createElement("item",p,!1));var u=s?s:this.session.roster[n].groups;if(u)for(var d=0;d<u.length;d++)i.append("<group>"),i.append(u[d]),i.append("</group>");i.append("</item></query></iq>");var a=this.session.dispatchPacket(i.toString(),"iq",o.id);return a.addCallback(this,"verifyRoster"),a}},verifyRoster:function(e){if("result"==e.getAttribute("type"));else{var r=this.session.processXmppError(e);this.onAddRosterItemFailed(r)}return e},addRosterItemToGroup:function(e,r){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!r)throw new Error("Roster::addRosterItemToGroup() group is null or undefined");var s=this.session.getRosterIndex(e);if(-1!=s){for(var o=this.session.roster[s],i=!1,n=0;o<o.groups.length&&!i;n++)o.groups[n]==r&&(i=!0);return i?t.xmpp.xmpp.INVALID_ID:this.updateRosterItem(e,o.name,o.groups.concat(r),s)}},removeRosterGroup:function(e){for(var r=this.session.roster,t=0;t<r.length;t++){var s=r[t];if(s.groups.length>0)for(var o=0;o<s.groups.length;o++)s.groups[o]==e&&(s.groups.splice(o,1),this.updateRosterItem(s.jid,s.name,s.groups))}},renameRosterGroup:function(e,r){for(var t=this.session.roster,s=0;s<t.length;s++){var o=t[s];if(o.groups.length>0)for(var i=0;i<o.groups.length;i++)o.groups[i]==e&&(o.groups[i]=r,this.updateRosterItem(o.jid,o.name,o.groups))}},removeRosterItemFromGroup:function(e,r){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!r)throw new Error("Roster::addRosterItemToGroup() group is null or undefined");var s=this.session.getRosterIndex(e);if(-1!=s){for(var o=this.session.roster[s],i=!1,n=0;n<o.groups.length&&!i;n++)o.groups[n]==r&&(i=!0,s=n);return 1==i?(o.groups.splice(s,1),this.updateRosterItem(e,o.name,o.groups)):t.xmpp.xmpp.INVALID_ID}},rosterItemRenameGroup:function(e,r,s){if(!e)throw new Error("Roster::rosterItemRenameGroup() JID is null or undefined");if(!s)throw new Error("Roster::rosterItemRenameGroup() group is null or undefined");var o=this.session.getRosterIndex(e);if(-1!=o){for(var i=this.session.roster[o],n=!1,p=0;p<i.groups.length&&!n;p++)i.groups[p]==r&&(i.groups[p]=s,n=!0);return 1==n?this.updateRosterItem(e,i.name,i.groups):t.xmpp.xmpp.INVALID_ID}},renameRosterItem:function(e,r){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");if(!r)throw new Error("Roster::addRosterItemToGroup() New Name is null or undefined");var t=this.session.getRosterIndex(e);if(-1!=t)return this.updateRosterItem(e,r,this.session.roster.groups,t)},removeRosterItem:function(e){if(!e)throw new Error("Roster::addRosterItemToGroup() JID is null or undefined");var r={id:this.session.getNextIqId(),from:this.session.jid+"/"+this.session.resource,type:"set"},s=new t.string.Builder(t.xmpp.util.createElement("iq",r,!1));s.append(t.xmpp.util.createElement("query",{xmlns:"jabber:iq:roster"},!1)),-1==e.indexOf("@")&&(e+=e+"@"+this.session.domain),s.append(t.xmpp.util.createElement("item",{jid:e,subscription:"remove"},!0)),s.append("</query></iq>");var o=this.session.dispatchPacket(s.toString(),"iq",r.id);return o.addCallback(this,"verifyRoster"),o},getAvatar:function(e){},publishAvatar:function(e,r){},onVerifyRoster:function(e){},onVerifyRosterFailed:function(e){}})});