define("dojox/gfx/vml_attach",["dojo/_base/kernel","dojo/_base/lang","./_base","./matrix","./path","dojo/_base/Color","./vml"],function(e,t,a,r,o,n,l){e.experimental("dojox.gfx.vml_attach"),l.attachNode=function(e){if(!e)return null;var t=null;switch(e.tagName.toLowerCase()){case l.Rect.nodeType:t=new l.Rect(e),c(t);break;case l.Ellipse.nodeType:e.style.width==e.style.height?(t=new l.Circle(e),f(t)):(t=new l.Ellipse(e),d(t));break;case l.Path.nodeType:switch(e.getAttribute("dojoGfxType")){case"line":t=new l.Line(e),y(t);break;case"polyline":t=new l.Polyline(e),x(t);break;case"path":t=new l.Path(e),k(t);break;case"text":t=new l.Text(e),m(t),v(t),N(t);break;case"textpath":t=new l.TextPath(e),k(t),m(t),v(t)}break;case l.Image.nodeType:switch(e.getAttribute("dojoGfxType")){case"image":t=new l.Image(e),u(t),g(t)}break;default:return null}return t instanceof l.Image||(i(t),s(t),t instanceof l.Text||p(t)),t},l.attachSurface=function(e){var t=new l.Surface;t.clipNode=e;var a=t.rawNode=e.firstChild,r=a.firstChild;return r&&"rect"==r.tagName?(t.bgNode=a,t):null};var i=function(e){var o,i,s,p=null,c=e.rawNode,d=c.fill;if(d.on&&"gradient"==d.type)for(p=t.clone(a.defaultLinearGradient),rad=r._degToRad(d.angle),p.x2=Math.cos(rad),p.y2=Math.sin(rad),p.colors=[],o=d.colors.value.split(";"),i=0;i<o.length;++i)s=o[i].match(/\S+/g),s&&2==s.length&&p.colors.push({offset:l._parseFloat(s[0]),color:new n(s[1])});else if(d.on&&"gradientradial"==d.type)for(p=t.clone(a.defaultRadialGradient),w=parseFloat(c.style.width),h=parseFloat(c.style.height),p.cx=isNaN(w)?0:d.focusposition.x*w,p.cy=isNaN(h)?0:d.focusposition.y*h,p.r=isNaN(w)?1:w/2,p.colors=[],o=d.colors.value.split(";"),i=o.length-1;i>=0;--i)s=o[i].match(/\S+/g),s&&2==s.length&&p.colors.push({offset:l._parseFloat(s[0]),color:new n(s[1])});else d.on&&"tile"==d.type?(p=t.clone(a.defaultPattern),p.width=a.pt2px(d.size.x),p.height=a.pt2px(d.size.y),p.x=d.origin.x*p.width,p.y=d.origin.y*p.height,p.src=d.src):d.on&&c.fillcolor&&(p=new n(c.fillcolor+""),p.a=d.opacity);e.fillStyle=p},s=function(e){var r=e.rawNode;if(!r.stroked)return void(e.strokeStyle=null);var o=e.strokeStyle=t.clone(a.defaultStroke),l=r.stroke;o.color=new n(r.strokecolor.value),o.width=a.normalizedLength(r.strokeweight+""),o.color.a=l.opacity,o.cap=this._translate(this._capMapReversed,l.endcap),o.join="miter"==l.joinstyle?l.miterlimit:l.joinstyle,o.style=l.dashstyle},p=function(e){var t=e.rawNode.skew,o=t.matrix,n=t.offset;e.matrix=r.normalize({xx:o.xtox,xy:o.ytox,yx:o.xtoy,yy:o.ytoy,dx:a.pt2px(n.x),dy:a.pt2px(n.y)})},c=function(e){var t=e.rawNode,r=t.outerHTML.match(/arcsize = \"(\d*\.?\d+[%f]?)\"/)[1],o=t.style,n=parseFloat(o.width),i=parseFloat(o.height);r=r.indexOf("%")>=0?parseFloat(r)/100:l._parseFloat(r),e.shape=a.makeParameters(a.defaultRect,{x:parseInt(o.left),y:parseInt(o.top),width:n,height:i,r:Math.min(n,i)*r})},d=function(e){var t=e.rawNode.style,r=parseInt(t.width)/2,o=parseInt(t.height)/2;e.shape=a.makeParameters(a.defaultEllipse,{cx:parseInt(t.left)+r,cy:parseInt(t.top)+o,rx:r,ry:o})},f=function(e){var t=e.rawNode.style,r=parseInt(t.width)/2;e.shape=a.makeParameters(a.defaultCircle,{cx:parseInt(t.left)+r,cy:parseInt(t.top)+r,r:r})},y=function(e){var r=e.shape=t.clone(a.defaultLine),o=e.rawNode.path.v.match(a.pathVmlRegExp);do{if(o.length<7||"m"!=o[0]||"l"!=o[3]||"e"!=o[6])break;r.x1=parseInt(o[1]),r.y1=parseInt(o[2]),r.x2=parseInt(o[4]),r.y2=parseInt(o[5])}while(!1)},x=function(e){var r=e.shape=t.clone(a.defaultPolyline),o=e.rawNode.path.v.match(a.pathVmlRegExp);do{if(o.length<3||"m"!=o[0])break;var n=parseInt(o[0]),l=parseInt(o[1]);if(isNaN(n)||isNaN(l))break;if(r.points.push({x:n,y:l}),o.length<6||"l"!=o[3])break;for(var i=4;i<o.length&&(n=parseInt(o[i]),l=parseInt(o[i+1]),!isNaN(n)&&!isNaN(l));i+=2)r.points.push({x:n,y:l})}while(!1)},u=function(e){e.shape=t.clone(a.defaultImage),e.shape.src=e.rawNode.firstChild.src},g=function(e){var t=e.rawNode.filters["DXImageTransform.Microsoft.Matrix"];e.matrix=r.normalize({xx:t.M11,xy:t.M12,yx:t.M21,yy:t.M22,dx:t.Dx,dy:t.Dy})},m=function(e){var r=e.shape=t.clone(a.defaultText),o=e.rawNode,n=o.path.v.match(a.pathVmlRegExp);do{if(!n||7!=n.length)break;for(var i=o.childNodes,s=0;s<i.length&&"textpath"!=i[s].tagName;++s);if(s>=i.length)break;var h=i[s].style;switch(r.text=i[s].string,h["v-text-align"]){case"left":r.x=parseInt(n[1]),r.align="start";break;case"center":r.x=(parseInt(n[1])+parseInt(n[4]))/2,r.align="middle";break;case"right":r.x=parseInt(n[4]),r.align="end"}return r.y=parseInt(n[2]),r.decoration=h["text-decoration"],r.rotated=h["v-rotate-letters"].toLowerCase()in l._bool,void(r.kerning=h["v-text-kern"].toLowerCase()in l._bool)}while(!1);e.shape=null},v=function(e){for(var r=e.fontStyle=t.clone(a.defaultFont),o=e.rawNode.childNodes,n=0;n<o.length&&"textpath"==o[n].tagName;++n);if(n>=o.length)return void(e.fontStyle=null);var l=o[n].style;r.style=l.fontstyle,r.variant=l.fontvariant,r.weight=l.fontweight,r.size=l.fontsize,r.family=l.fontfamily},N=function(e){p(e);var t=e.matrix,o=e.fontStyle;t&&o&&(e.matrix=r.multiply(t,{dy:.35*a.normalizedLength(o.size)}))},k=function(e){for(var r=e.shape=t.clone(a.defaultPath),n=e.rawNode.path.v.match(a.pathVmlRegExp),l=[],i=!1,s=o._pathVmlToSvgMap,h=0;h<n.length;++n){var p=n[h];if(p in s)i=!1,l.push(s[p]);else if(!i){var c=parseInt(p);isNaN(c)?i=!0:l.push(c)}}var d=l.length;d>=4&&""==l[d-1]&&0==l[d-2]&&0==l[d-3]&&"l"==l[d-4]&&l.splice(d-4,4),d&&(r.path=l.join(" "))};return l});