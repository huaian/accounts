define("dojox/wire/ml/Invocation",["dojo","dijit","dojox","dojo/require!dojox/wire/ml/Action"],function(e,r,t){e.provide("dojox.wire.ml.Invocation"),e.require("dojox.wire.ml.Action"),e.declare("dojox.wire.ml.Invocation",t.wire.ml.Action,{object:"",method:"",topic:"",parameters:"",result:"",error:"",_run:function(){if(this.topic){var r=this._getParameters(arguments);try{e.publish(this.topic,r),this.onComplete()}catch(o){this.onError(o)}}else if(this.method){var i=this.object?t.wire.ml._getValue(this.object):e.global;if(!i)return;var r=this._getParameters(arguments),n=i[this.method];if(!n){if(n=i.callMethod,!n)return;r=[this.method,r]}try{var a=!1;if(i.getFeatures){var s=i.getFeatures();if("fetch"==this.method&&s["dojo.data.api.Read"]||"save"==this.method&&s["dojo.data.api.Write"]){var l=r[0];l.onComplete||(l.onComplete=function(){}),this.connect(l,"onComplete","onComplete"),l.onError||(l.onError=function(){}),this.connect(l,"onError","onError"),a=!0}}var h=n.apply(i,r);if(!a)if(h&&h instanceof e.Deferred){var m=this;h.addCallbacks(function(e){m.onComplete(e)},function(e){m.onError(e)})}else this.onComplete(h)}catch(o){this.onError(o)}}},onComplete:function(e){this.result&&t.wire.ml._setValue(this.result,e),this.error&&t.wire.ml._setValue(this.error,"")},onError:function(e){this.error&&(e&&e.message&&(e=e.message),t.wire.ml._setValue(this.error,e))},_getParameters:function(r){if(!this.parameters)return r;var o=[],i=this.parameters.split(",");if(1==i.length){var n=t.wire.ml._getValue(e.trim(i[0]),r);e.isArray(n)?o=n:o.push(n)}else for(var a in i)o.push(t.wire.ml._getValue(e.trim(i[a]),r));return o}})});