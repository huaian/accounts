define("dojox/gfx3d/scheduler",["dojo/_base/lang","dojo/_base/array","dojo/_base/declare","./_base","./vector"],function(r,t,e,n,i){n.scheduler={zOrder:function(r,t){return t=t?t:n.scheduler.order,r.sort(function(r,e){return t(e)-t(r)}),r},bsp:function(r,e){e=e?e:n.scheduler.outline;var i=new n.scheduler.BinarySearchTree(r[0],e);return t.forEach(r.slice(1),function(r){i.add(r,e)}),i.iterate(e)},order:function(r){return r.getZOrder()},outline:function(r){return r.getOutline()}};var o=e("dojox.gfx3d.scheduler.BinarySearchTree",null,{constructor:function(r,t){this.plus=null,this.minus=null,this.object=r;var e=t(r);this.orient=e[0],this.normal=i.normalize(e)},add:function(r,e){var o=.5,s=e(r),u=i,c=this.normal,a=this.orient,h=n.scheduler.BinarySearchTree;if(t.every(s,function(r){return Math.floor(o+u.dotProduct(c,u.substract(r,a)))<=0}))this.minus?this.minus.add(r,e):this.minus=new h(r,e);else{if(!t.every(s,function(r){return Math.floor(o+u.dotProduct(c,u.substract(r,a)))>=0}))throw"The case: polygon cross siblings' plate is not implemented yet";this.plus?this.plus.add(r,e):this.plus=new h(r,e)}},iterate:function(r){var t=.5,e=i,n=[],o=null,s={x:0,y:0,z:-1e4};return o=Math.floor(t+e.dotProduct(this.normal,e.substract(s,this.orient)))<=0?[this.plus,this.minus]:[this.minus,this.plus],o[0]&&(n=n.concat(o[0].iterate())),n.push(this.object),o[1]&&(n=n.concat(o[1].iterate())),n}});n.drawer={conservative:function(r,e,n){t.forEach(this.objects,function(r){r.destroy()}),t.forEach(e,function(r){r.draw(n.lighting)})},chart:function(r,e,n){t.forEach(this.todos,function(r){r.draw(n.lighting)})}};var s={scheduler:n.scheduler,drawer:n.drawer,BinarySearchTree:o};return s});