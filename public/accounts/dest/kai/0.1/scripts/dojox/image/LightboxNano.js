define("dojox/image/LightboxNano",["dojo/_base/lang","dojo/_base/declare","dojo/_base/array","dojo/_base/fx","dojo/dom","dojo/dom-construct","dojo/dom-geometry","dojo/dom-style","dojo/dom-class","dojo/on","dojo/query","dojo/fx"],function(e,t,o,n,i,d,a,s,r,c,h,l){var _="absolute",g="visibility";return getViewport=function(){var e="BackCompat"==document.compatMode?document.body:document.documentElement,t=a.docScroll();return{w:e.clientWidth,h:e.clientHeight,l:t.x,t:t.y}},t("dojox.image.LightboxNano",null,{href:"",duration:500,preloadDelay:5e3,constructor:function(t,o){var n,a=this;e.mixin(a,t),o=a._node=i.byId(o),o&&(/a/i.test(o.tagName)||(n=d.create("a",{href:a.href,"class":o.className},o,"after"),o.className="",n.appendChild(o),o=n),s.set(o,"position","relative"),d.create("div",{"class":"nano-enlarge",style:{position:"absolute",display:"none"}},o),i.setSelectable(o,!1),a._onClickEvt=c(o,"click",e.hitch(a,"_load"))),a.href&&setTimeout(function(){(new Image).src=a.href,a._hideLoading()},a.preloadDelay)},destroy:function(){var e=this._connects||[];e.push(this._onClickEvt),o.forEach(e,function(e){e.remove()}),d.destroy(this._node)},_load:function(t){var o=this;if(t&&t.preventDefault(),!o._loading){o._loading=!0,o._reset();var n,i=o._img=d.create("img",{"class":"nano-image nano-image-hidden"},document.body),r=o._loadingNode,l=h("img",o._node)[0]||o._node,_=a.position(l,!0),g=a.getContentBox(l),m=a.getBorderExtents(l);null==r&&(o._loadingNode=r=d.create("div",{"class":"nano-loading",style:{position:"absolute",display:""}},o._node,"after"),n=a.getMarginBox(r),s.set(r,{left:parseInt((g.w-n.w)/2)+"px",top:parseInt((g.h-n.h)/2)+"px"})),g.x=_.x-10+m.l,g.y=_.y-10+m.t,o._start=g,o._connects=[c(i,"load",e.hitch(o,"_show"))],i.src=o.href}},_hideLoading:function(){this._loadingNode&&s.set(this._loadingNode,"display","none"),this._loadingNode=!1},_show:function(){var t=this,o=getViewport(),n=t._img.width,i=t._img.height,a=parseInt(.9*(o.w-20)),h=parseInt(.9*(o.h-20)),_=t._bg=d.create("div",{"class":"nano-background",style:{opacity:0}},document.body);t._loadingNode&&t._hideLoading(),r.remove(t._img,"nano-image-hidden"),s.set(t._node,g,"hidden"),t._loading=!1,t._connects=t._connects.concat([c(document,"mousedown",e.hitch(t,"_hide")),c(document,"keypress",e.hitch(t,"_key")),c(window,"resize",e.hitch(t,"_sizeBg"))]),n>a&&(i=i*a/n,n=a),i>h&&(n=n*h/i,i=h),t._end={x:(o.w-20-n)/2+o.l,y:(o.h-20-i)/2+o.t,w:n,h:i},t._sizeBg(),l.combine([t._anim(t._img,t._coords(t._start,t._end)),t._anim(_,{opacity:.5})]).play()},_sizeBg:function(){var e=document.documentElement;s.set(this._bg,{top:0,left:0,width:e.scrollWidth+"px",height:e.scrollHeight+"px"})},_key:function(e){e.preventDefault(),this._hide()},_coords:function(e,t){return{left:{start:e.x,end:t.x},top:{start:e.y,end:t.y},width:{start:e.w,end:t.w},height:{start:e.h,end:t.h}}},_hide:function(){var e=this;o.forEach(e._connects,function(e){e.remove()}),e._connects=[],l.combine([e._anim(e._img,e._coords(e._end,e._start),"_reset"),e._anim(e._bg,{opacity:0})]).play()},_reset:function(){s.set(this._node,g,"visible"),d.destroy(this._img),d.destroy(this._bg),this._img=this._bg=null,this._node.focus()},_anim:function(t,o,i){return n.animateProperty({node:t,duration:this.duration,properties:o,onEnd:i?e.hitch(this,i):null})},show:function(e){e=e||{},this.href=e.href||this.href;var t=i.byId(e.origin),o=getViewport();this._node=t||d.create("div",{style:{position:_,width:0,hieght:0,left:o.l+o.w/2+"px",top:o.t+o.h/2+"px"}},document.body),this._load(),t||d.destroy(this._node)}})});