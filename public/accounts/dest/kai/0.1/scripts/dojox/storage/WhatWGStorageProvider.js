define("dojox/storage/WhatWGStorageProvider",["dojo","dijit","dojox","dojo/require!dojox/storage/Provider,dojox/storage/manager"],function(e,t,i){e.provide("dojox.storage.WhatWGStorageProvider"),e.require("dojox.storage.Provider"),e.require("dojox.storage.manager"),e.declare("dojox.storage.WhatWGStorageProvider",[i.storage.Provider],{initialized:!1,_domain:null,_available:null,_statusHandler:null,_allNamespaces:null,_storageEventListener:null,initialize:function(){1!=e.config.disableWhatWGStorage&&(this._domain=location.hostname,this.initialized=!0,i.storage.manager.loaded())},isAvailable:function(){try{globalStorage[location.hostname]}catch(e){return this._available=!1,this._available}return this._available=!0,this._available},put:function(t,i,r,a){if(0==this.isValidKey(t))throw new Error("Invalid key given: "+t);a=a||this.DEFAULT_NAMESPACE,t=this.getFullKey(t,a),this._statusHandler=r,i=e.isString(i)?"string:"+i:e.toJson(i);var o=e.hitch(this,function(e){window.removeEventListener("storage",o,!1),r&&r.call(null,this.SUCCESS,t,null,a)});window.addEventListener("storage",o,!1);try{var n=globalStorage[this._domain];n.setItem(t,i)}catch(s){this._statusHandler.call(null,this.FAILED,t,s.toString(),a)}},get:function(t,i){if(0==this.isValidKey(t))throw new Error("Invalid key given: "+t);i=i||this.DEFAULT_NAMESPACE,t=this.getFullKey(t,i);var r=globalStorage[this._domain],a=r.getItem(t);return null==a||""==a?null:(a=a.value,a=e.isString(a)&&/^string:/.test(a)?a.substring("string:".length):e.fromJson(a))},getNamespaces:function(){for(var e=[this.DEFAULT_NAMESPACE],t={},i=globalStorage[this._domain],r=/^__([^_]*)_/,a=0;a<i.length;a++){var o=i.key(a);if(1==r.test(o)){var n=o.match(r)[1];"undefined"==typeof t[n]&&(t[n]=!0,e.push(n))}}return e},getKeys:function(e){if(e=e||this.DEFAULT_NAMESPACE,0==this.isValidKey(e))throw new Error("Invalid namespace given: "+e);var t;t=e==this.DEFAULT_NAMESPACE?new RegExp("^([^_]{2}.*)$"):new RegExp("^__"+e+"_(.*)$");for(var i=globalStorage[this._domain],r=[],a=0;a<i.length;a++){var o=i.key(a);1==t.test(o)&&(o=o.match(t)[1],r.push(o))}return r},clear:function(t){if(t=t||this.DEFAULT_NAMESPACE,0==this.isValidKey(t))throw new Error("Invalid namespace given: "+t);var i;i=t==this.DEFAULT_NAMESPACE?new RegExp("^[^_]{2}"):new RegExp("^__"+t+"_");for(var r=globalStorage[this._domain],a=[],o=0;o<r.length;o++)1==i.test(r.key(o))&&(a[a.length]=r.key(o));e.forEach(a,e.hitch(r,"removeItem"))},remove:function(e,t){e=this.getFullKey(e,t);var i=globalStorage[this._domain];i.removeItem(e)},isPermanent:function(){return!0},getMaximumSize:function(){return this.SIZE_NO_LIMIT},hasSettingsUI:function(){return!1},showSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")},hideSettingsUI:function(){throw new Error(this.declaredClass+" does not support a storage settings user-interface")},getFullKey:function(e,t){if(t=t||this.DEFAULT_NAMESPACE,0==this.isValidKey(t))throw new Error("Invalid namespace given: "+t);return t==this.DEFAULT_NAMESPACE?e:"__"+t+"_"+e}}),i.storage.manager.register("dojox.storage.WhatWGStorageProvider",new i.storage.WhatWGStorageProvider)});