define("dojox/storage/FlashStorageProvider",["dojo","dijit","dojox","dojo/require!dojox/flash,dojox/storage/manager,dojox/storage/Provider"],function(dojo,dijit,dojox){dojo.provide("dojox.storage.FlashStorageProvider"),dojo.require("dojox.flash"),dojo.require("dojox.storage.manager"),dojo.require("dojox.storage.Provider"),dojo.declare("dojox.storage.FlashStorageProvider",dojox.storage.Provider,{initialized:!1,_available:null,_statusHandler:null,_flashReady:!1,_pageReady:!1,initialize:function(){if(1!=dojo.config.disableFlashStorage){dojox.flash.addLoadedListener(dojo.hitch(this,function(){this._flashReady=!0,this._flashReady&&this._pageReady&&this._loaded()}));var o=dojo.moduleUrl("dojox","storage/Storage.swf").toString();dojox.flash.setSwf(o,!1),dojo.connect(dojo,"loaded",this,function(){this._pageReady=!0,this._flashReady&&this._pageReady&&this._loaded()})}},setFlushDelay:function(o){if(null===o||"undefined"==typeof o||isNaN(o))throw new Error("Invalid argunment: "+o);dojox.flash.comm.setFlushDelay(String(o))},getFlushDelay:function(){return Number(dojox.flash.comm.getFlushDelay())},flush:function(o){(null==o||"undefined"==typeof o)&&(o=dojox.storage.DEFAULT_NAMESPACE),dojox.flash.comm.flush(o)},isAvailable:function(){return this._available=!dojo.config.disableFlashStorage},put:function(o,e,i,t){if(!this.isValidKey(o))throw new Error("Invalid key given: "+o);if(t||(t=dojox.storage.DEFAULT_NAMESPACE),!this.isValidKey(t))throw new Error("Invalid namespace given: "+t);this._statusHandler=i,e=dojo.isString(e)?"string:"+e:dojo.toJson(e),dojox.flash.comm.put(o,e,t)},putMultiple:function(o,e,i,t){if(!this.isValidKeyArray(o)||!e instanceof Array||o.length!=e.length)throw new Error("Invalid arguments: keys = ["+o+"], values = ["+e+"]");if(t||(t=dojox.storage.DEFAULT_NAMESPACE),!this.isValidKey(t))throw new Error("Invalid namespace given: "+t);this._statusHandler=i;for(var a=o.join(","),s=[],r=0;r<e.length;r++)dojo.isString(e[r])?e[r]="string:"+e[r]:e[r]=dojo.toJson(e[r]),s[r]=e[r].length;var n=e.join(""),l=s.join(",");dojox.flash.comm.putMultiple(a,n,l,t)},get:function(o,e){if(!this.isValidKey(o))throw new Error("Invalid key given: "+o);if(e||(e=dojox.storage.DEFAULT_NAMESPACE),!this.isValidKey(e))throw new Error("Invalid namespace given: "+e);var i=dojox.flash.comm.get(o,e);return""==i?null:this._destringify(i)},getMultiple:function(keys,namespace){if(!this.isValidKeyArray(keys))throw new("Invalid key array given: "+keys);if(namespace||(namespace=dojox.storage.DEFAULT_NAMESPACE),!this.isValidKey(namespace))throw new Error("Invalid namespace given: "+namespace);for(var metaKey=keys.join(","),metaResults=dojox.flash.comm.getMultiple(metaKey,namespace),results=eval("("+metaResults+")"),i=0;i<results.length;i++)results[i]=""==results[i]?null:this._destringify(results[i]);return results},_destringify:function(o){return o=dojo.isString(o)&&/^string:/.test(o)?o.substring("string:".length):dojo.fromJson(o)},getKeys:function(o){if(o||(o=dojox.storage.DEFAULT_NAMESPACE),!this.isValidKey(o))throw new Error("Invalid namespace given: "+o);var e=dojox.flash.comm.getKeys(o);return(null==e||"null"==e)&&(e=""),e=e.split(","),e.sort(),e},getNamespaces:function(){var o=dojox.flash.comm.getNamespaces();return(null==o||"null"==o)&&(o=dojox.storage.DEFAULT_NAMESPACE),o=o.split(","),o.sort(),o},clear:function(o){if(o||(o=dojox.storage.DEFAULT_NAMESPACE),!this.isValidKey(o))throw new Error("Invalid namespace given: "+o);dojox.flash.comm.clear(o)},remove:function(o,e){if(e||(e=dojox.storage.DEFAULT_NAMESPACE),!this.isValidKey(e))throw new Error("Invalid namespace given: "+e);dojox.flash.comm.remove(o,e)},removeMultiple:function(o,e){if(this.isValidKeyArray(o)||dojo.raise("Invalid key array given: "+o),e||(e=dojox.storage.DEFAULT_NAMESPACE),!this.isValidKey(e))throw new Error("Invalid namespace given: "+e);var i=o.join(",");dojox.flash.comm.removeMultiple(i,e)},isPermanent:function(){return!0},getMaximumSize:function(){return dojox.storage.SIZE_NO_LIMIT},hasSettingsUI:function(){return!0},showSettingsUI:function(){dojox.flash.comm.showSettings(),dojox.flash.obj.setVisible(!0),dojox.flash.obj.center()},hideSettingsUI:function(){dojox.flash.obj.setVisible(!1),dojo.isFunction(dojox.storage.onHideSettingsUI)&&dojox.storage.onHideSettingsUI.call(null)},getResourceList:function(){return[]},_loaded:function(){this._allNamespaces=this.getNamespaces(),this.initialized=!0,dojox.storage.manager.loaded()},_onStatus:function(o,e,i){var t=dojox.storage,a=dojox.flash.obj;o==t.PENDING?(a.center(),a.setVisible(!0)):a.setVisible(!1),t._statusHandler&&t._statusHandler.call(null,o,e,null,i)}}),dojox.storage.manager.register("dojox.storage.FlashStorageProvider",new dojox.storage.FlashStorageProvider)});