define("dojox/app/controllers/Load",["require","dojo/_base/lang","dojo/_base/declare","dojo/on","dojo/Deferred","dojo/when","dojo/dom-style","../Controller"],function(e,i,t,a,o,r,l,n,s){return t("dojox.app.controllers.Load",n,{_waitingQueue:[],constructor:function(e,i){this.events={"app-init":this.init,"app-load":this.load}},init:function(e){r(this.createView(e.parent,null,null,{templateString:e.templateString,controller:e.controller},null,e.type),function(i){r(i.start(),e.callback)})},load:function(e){this.app.log("in app/controllers/Load event.viewId="+e.viewId+" event =",e);for(var t=e.viewId||"",a=[],l=t.split("+");l.length>0;){var n=l.shift();a.push(n)}var s;if(this.proceedLoadViewDef=new o,!(a&&a.length>1))return s=this.loadView(e);for(var d=0;d<a.length-1;d++){var h=i.clone(e);h.callback=null,h.viewId=a[d],this._waitingQueue.push(h)}this.proceedLoadView(this._waitingQueue.shift()),r(this.proceedLoadViewDef,i.hitch(this,function(){var t=i.clone(e);return t.viewId=a[d],s=this.loadView(t)}))},proceedLoadView:function(e){var t=this.loadView(e);r(t,i.hitch(this,function(){this.app.log("in app/controllers/Load proceedLoadView back from loadView for event",e);var i=this._waitingQueue.shift();i?(this.app.log("in app/controllers/Load proceedLoadView back from loadView calling this.proceedLoadView(nextEvt) for ",i),this.proceedLoadView(i)):(this._waitingQueue=[],this.proceedLoadViewDef.resolve())}))},loadView:function(e){var t=e.parent||this.app,a=e.viewId||"",o=a.split(","),l=o.shift(),n=o.join(","),s=e.params||"";this._handleDefault=!1,this._defaultHasPlus=!1;var d=this.loadChild(t,l,n,s,e);return e.callback&&r(d,i.hitch(this,function(){this._handleDefault&&!e.initLoad&&(this.app.log("logTransitions:",""," emit app-transition this.childViews=["+this.childViews+"]"),this.app.emit("app-transition",{viewId:this.childViews,defaultView:!0,forceTransitionNone:e.forceTransitionNone,opts:{params:s}})),e.callback(this._handleDefault,this._defaultHasPlus)})),d},createChild:function(e,i,t,a){var l=e.id+"_"+i;!a&&e.views[i]&&e.views[i].defaultParams&&(a=e.views[i].defaultParams);var n=e.children[l];if(n)return a&&(n.params=a),this.app.log("in app/controllers/Load createChild view is already loaded so return the loaded view with the new parms ",n),n;var s=new o;return r(this.createView(e,l,i,null,a,e.views[i].type),function(i){e.children[l]=i,r(i.start(),function(e){s.resolve(e)})}),s},createView:function(t,a,r,l,n,s){var d=new o,h=this.app;return e([s?s:"../View"],function(e){var o=new e(i.mixin({app:h,id:a,name:r,parent:t},{params:n},l));d.resolve(o)}),d},loadChild:function(e,t,a,l,n){if(!e)throw Error("No parent for Child '"+t+"'.");if(!t){var s=e.defaultView?e.defaultView.split(","):"default";if(e.defaultView&&!n.initLoad){var d=this._getViewNamesFromDefaults(e);this.app.log("logTransitions:","Load:loadChild","setting _handleDefault true for parent.defaultView childViews=["+d+"]"),this._handleDefault=!0,e.defaultView.indexOf("+")>=0&&(this._defaultHasPlus=!0)}else t=s.shift(),a=s.join(",")}var h,u=new o;try{h=this.createChild(e,t,a,l)}catch(c){return u.reject("load child '"+t+"' error."),u.promise}return r(h,i.hitch(this,function(e){if(!a&&e.defaultView){var i=this._getViewNamesFromDefaults(e);this.app.log("logTransitions:","Load:loadChild"," setting _handleDefault = true child.defaultView childViews=["+i+"]"),this._handleDefault=!0,e.defaultView.indexOf("+")>=0&&(this._defaultHasPlus=!0),this.childViews=i,u.resolve()}var o=a.split(",");if(t=o.shift(),a=o.join(","),t){var s=this.loadChild(e,t,a,l,n);r(s,function(){u.resolve()},function(){u.reject("load child '"+t+"' error.")})}else u.resolve()}),function(){u.reject("load child '"+t+"' error.")}),u.promise},_getViewNamesFromDefaults:function(e){for(var i=e.parent,t=e.name,a="";i!==this.app;)t=i.name+","+t,i=i.parent;var o=e.defaultView.split("+");for(var r in o)o[r]=t+","+o[r];return a=o.join("+")}})});