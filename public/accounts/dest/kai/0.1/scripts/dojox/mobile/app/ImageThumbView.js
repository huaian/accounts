define("dojox/mobile/app/ImageThumbView",["dojo","dijit","dojox","dojo/require!dijit/_WidgetBase,dojo/string"],function(e,i,t){e.provide("dojox.mobile.app.ImageThumbView"),e.experimental("dojox.mobile.app.ImageThumbView"),e.require("dijit._WidgetBase"),e.require("dojo.string"),e.declare("dojox.mobile.app.ImageThumbView",i._WidgetBase,{items:[],urlParam:"url",labelParam:null,itemTemplate:'<div class="mblThumbInner"><div class="mblThumbOverlay"></div><div class="mblThumbMask"><div class="mblThumbSrc" style="background-image:url(${url})"></div></div></div>',minPadding:4,maxPerRow:3,maxRows:-1,baseClass:"mblImageThumbView",thumbSize:"medium",animationEnabled:!0,selectedIndex:-1,cache:null,cacheMustMatch:!1,clickEvent:"onclick",cacheBust:!1,disableHide:!1,constructor:function(e,i){},postCreate:function(){this.inherited(arguments);var i=this;this.addThumb=e.hitch(this,this.addThumb),this.handleImgLoad=e.hitch(this,this.handleImgLoad),this.hideCached=e.hitch(this,this.hideCached),this._onLoadImages={},this.cache=[],this.visibleImages=[],this._cacheCounter=0,this.connect(this.domNode,this.clickEvent,function(t){var s=i._getItemNodeFromEvent(t);s&&!s._cached&&(i.onSelect(s._item,s._index,i.items),e.query(".selected",this.domNode).removeClass("selected"),e.addClass(s,"selected"))}),e.addClass(this.domNode,this.thumbSize),this.resize(),this.render()},onSelect:function(e,i,t){},_setAnimationEnabledAttr:function(i){this.animationEnabled=i,e[i?"addClass":"removeClass"](this.domNode,"animated")},_setItemsAttr:function(i){this.items=i||[];var t,s={};for(t=0;t<this.items.length;t++)s[this.items[t][this.urlParam]]=1;var h=[];for(var a in this._onLoadImages)!s[a]&&this._onLoadImages[a]._conn&&(e.disconnect(this._onLoadImages[a]._conn),this._onLoadImages[a].src=null,h.push(a));for(t=0;t<h.length;t++)delete this._onLoadImages[a];this.render()},_getItemNode:function(i){for(;i&&!e.hasClass(i,"mblThumb")&&i!=this.domNode;)i=i.parentNode;return i==this.domNode?null:i},_getItemNodeFromEvent:function(e){return e.touches&&e.touches.length>0&&(e=e.touches[0]),this._getItemNode(e.target)},resize:function(){this._thumbSize=null,this._size=e.contentBox(this.domNode),this.disableHide=!0,this.render(),this.disableHide=!1},hideCached:function(){for(var i=0;i<this.cache.length;i++)this.cache[i]&&e.style(this.cache[i],"display","none")},render:function(){for(var i,t,s,h;this.visibleImages&&this.visibleImages.length>0;)h=this.visibleImages.pop(),this.cache.push(h),this.disableHide||e.addClass(h,"hidden"),h._cached=!0;if(this.cache&&this.cache.length>0&&setTimeout(this.hideCached,1e3),this.items&&0!=this.items.length){for(i=0;i<this.items.length&&(s=this.items[i],t=e.isString(s)?s:s[this.urlParam],this.addThumb(s,t,i),!(this.maxRows>0&&(i+1)/this.maxPerRow>=this.maxRows));i++);if(this._thumbSize){var a=0,d=-1,n=this._thumbSize.w+2*this.padding,o=this._thumbSize.h+2*this.padding,m=this.thumbNodes=e.query(".mblThumb",this.domNode),l=0;for(m=this.visibleImages,i=0;i<m.length;i++)m[i]._cached||(l%this.maxPerRow==0&&d++,a=l%this.maxPerRow,this.place(m[i],a*n+this.padding,d*o+this.padding),m[i]._loading||e.removeClass(m[i],"hidden"),l==this.selectedIndex&&e[l==this.selectedIndex?"addClass":"removeClass"](m[i],"selected"),l++);var c=Math.ceil(l/this.maxPerRow);this._numRows=c,this.setContainerHeight(c*(this._thumbSize.h+2*this.padding))}}},setContainerHeight:function(i){e.style(this.domNode,"height",i+"px")},addThumb:function(i,t,s){var h,a=!1;if(this.cache.length>0){for(var d=!1,n=0;n<this.cache.length;n++)if(this.cache[n]._url==t){h=this.cache.splice(n,1)[0],d=!0;break}h||this.cacheMustMatch?a=!0:(h=this.cache.pop(),e.removeClass(h,"selected"))}if(h||(h=e.create("div",{"class":"mblThumb hidden",innerHTML:e.string.substitute(this.itemTemplate,{url:t},null,this)},this.domNode)),this.labelParam){var o=e.query(".mblThumbLabel",h)[0];o||(o=e.create("div",{"class":"mblThumbLabel"},h)),o.innerHTML=i[this.labelParam]||""}if(e.style(h,"display",""),this.disableHide||e.addClass(h,"hidden"),!a){var m=e.create("img",{});m._thumbDiv=h,m._conn=e.connect(m,"onload",this.handleImgLoad),m._url=t,h._loading=!0,this._onLoadImages[t]=m,m&&(m.src=t)}this.visibleImages.push(h),h._index=s,h._item=i,h._url=t,h._cached=!1,this._thumbSize||(this._thumbSize=e.marginBox(h),0==this._thumbSize.h&&(this._thumbSize.h=100,this._thumbSize.w=100),this.labelParam&&(this._thumbSize.h+=8),this.calcPadding())},handleImgLoad:function(i){var t=i.target;e.disconnect(t._conn),e.removeClass(t._thumbDiv,"hidden"),t._thumbDiv._loading=!1,t._conn=null;var s=t._url;this.cacheBust&&(s+=(s.indexOf("?")>-1?"&":"?")+"cacheBust="+(new Date).getTime()+"_"+this._cacheCounter++),e.query(".mblThumbSrc",t._thumbDiv).style("backgroundImage","url("+s+")"),delete this._onLoadImages[t._url]},calcPadding:function(){var e=this._size.w,i=this._thumbSize.w,t=i+this.minPadding;this.maxPerRow=Math.floor(e/t),this.padding=Math.floor((e-i*this.maxPerRow)/(2*this.maxPerRow))},place:function(i,t,s){e.style(i,{"-webkit-transform":"translate("+t+"px,"+s+"px)"})},destroy:function(){var e,i=0;for(var t in this._onLoadImages)e=this._onLoadImages[t],e&&(e.src=null,i++);this.inherited(arguments)}})});