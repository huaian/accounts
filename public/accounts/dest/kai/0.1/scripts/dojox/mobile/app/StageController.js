define("dojox/mobile/app/StageController",["dojo","dijit","dojox","dojo/require!dojox/mobile/app/SceneController"],function(e,s,n){e.provide("dojox.mobile.app.StageController"),e.experimental("dojox.mobile.app.StageController"),e.require("dojox.mobile.app.SceneController"),e.declare("dojox.mobile.app.StageController",null,{scenes:null,effect:"fade",constructor:function(s){this.domNode=s,this.scenes=[],e.config.mobileAnim&&(this.effect=e.config.mobileAnim)},getActiveSceneController:function(){return this.scenes[this.scenes.length-1]},pushScene:function(s,t){if(!this._opInProgress){this._opInProgress=!0;var o=e.create("div",{"class":"scene-wrapper",style:{visibility:"hidden"}},this.domNode),i=new n.mobile.app.SceneController({},o);this.scenes.length>0&&this.scenes[this.scenes.length-1].assistant.deactivate(),this.scenes.push(i);var c=this;e.forEach(this.scenes,this.setZIndex),i.stageController=this,i.init(s,t).addCallback(function(){1==c.scenes.length?(i.domNode.style.visibility="visible",c.scenes[c.scenes.length-1].assistant.activate(t),c._opInProgress=!1):c.scenes[c.scenes.length-2].performTransition(c.scenes[c.scenes.length-1].domNode,1,c.effect,null,function(){c.scenes[c.scenes.length-1].assistant.activate(t),c._opInProgress=!1})})}},setZIndex:function(s,n){e.style(s.domNode,"zIndex",n+1)},popScene:function(e){if(!this._opInProgress){var s=this;this.scenes.length>1&&(this._opInProgress=!0,this.scenes[s.scenes.length-2].assistant.activate(e),this.scenes[s.scenes.length-1].performTransition(s.scenes[this.scenes.length-2].domNode,-1,this.effect,null,function(){s._destroyScene(s.scenes[s.scenes.length-1]),s.scenes.splice(s.scenes.length-1,1),s._opInProgress=!1}))}},popScenesTo:function(e,s){if(!this._opInProgress){for(;this.scenes.length>2&&this.scenes[this.scenes.length-2].sceneName!=e;)this._destroyScene(this.scenes[this.scenes.length-2]),this.scenes.splice(this.scenes.length-2,1);this.popScene(s)}},_destroyScene:function(e){e.assistant.deactivate(),e.assistant.destroy(),e.destroyRecursive()}})});