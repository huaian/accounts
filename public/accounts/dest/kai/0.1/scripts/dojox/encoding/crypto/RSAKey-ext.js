define("dojox/encoding/crypto/RSAKey-ext",["dojo/_base/kernel","dojo/_base/lang","./RSAKey","../../math/BigInteger-ext"],function(t,e,i,r){function s(t,e){for(var i=t.toByteArray(),r=0,s=i.length;s>r&&!i[r];++r);if(i.length-r!==e-1||2!==i[r])return null;for(++r;i[r];)if(++r>=s)return null;for(var n="";++r<s;)n+=String.fromCharCode(i[r]);return n}return t.experimental("dojox.encoding.crypto.RSAKey-ext"),e.extend(i,{setPrivate:function(t,e,i){if(!(t&&e&&t.length&&e.length))throw new Error("Invalid RSA private key");this.n=new r(t,16),this.e=parseInt(e,16),this.d=new r(i,16)},setPrivateEx:function(t,e,i,s,n,h,o,d){if(!(t&&e&&t.length&&e.length))throw new Error("Invalid RSA private key");this.n=new r(t,16),this.e=parseInt(e,16),this.d=new r(i,16),this.p=new r(s,16),this.q=new r(n,16),this.dmp1=new r(h,16),this.dmq1=new r(o,16),this.coeff=new r(d,16)},generate:function(t,e){var i=this.rngf(),s=t>>1;this.e=parseInt(e,16);for(var n=new r(e,16);;){for(;this.p=new r(t-s,1,i),this.p.subtract(r.ONE).gcd(n).compareTo(r.ONE)||!this.p.isProbablePrime(10););for(;this.q=new r(s,1,i),this.q.subtract(r.ONE).gcd(n).compareTo(r.ONE)||!this.q.isProbablePrime(10););if(this.p.compareTo(this.q)<=0){var h=this.p;this.p=this.q,this.q=h}var o=this.p.subtract(r.ONE),d=this.q.subtract(r.ONE),a=o.multiply(d);if(!a.gcd(n).compareTo(r.ONE)){this.n=this.p.multiply(this.q),this.d=n.modInverse(a),this.dmp1=this.d.mod(o),this.dmq1=this.d.mod(d),this.coeff=this.q.modInverse(this.p);break}}i.destroy()},decrypt:function(t){var e,i=new r(t,16);if(this.p&&this.q){for(var n=i.mod(this.p).modPow(this.dmp1,this.p),h=i.mod(this.q).modPow(this.dmq1,this.q);n.compareTo(h)<0;)n=n.add(this.p);e=n.subtract(h).multiply(this.coeff).mod(this.p).multiply(this.q).add(h)}else e=i.modPow(this.d,this.n);return e?s(e,this.n.bitLength()+7>>3):null}}),i});