define("widgets/ChoosePhoto",["cHybridShell","MegaPixImage","fToolUtil"],function(e,t,i){var a={choosePhotoHelper:{renderHtml:function(a,l,n){var s,o,d,c=c||window.webkitURL,h=document.createElement("canvas"),r=h.getContext("2d"),y=new Image,o=l,d=n||null,m=document.createElement("div"),g=document.createElement("div"),p=document.createElement("span");p.classList.add("ext_file_img"),p.innerHTML="添加图片",s=document.createElement("input"),s.type="file",s.accept="image/*",s.id="img_txt",m.id="img_upload_div",m.style.position="absolute",m.style["z-index"]="10",m.style.top="0",m.style.width="80%",m.style.height="25",m.style.margin="0",g.style.position="relative",g.style["font-weight"]="300",g.style["font-size"]="12px",g.style.overflow="hidden",g.style.display="inline-block",g.style["text-decoration"]="none",g.style.border="0 none",g.style["vertical-align"]="middle",g.style.cursor="pointer",g.style.color="#099fde",g.style.width="100%",g.style.color="#099fde",g.style.width="100%",g.style.display="inline-block",g.className="nofastclick js_img_div",p.style.display="block",p.style["-webkit-animation"]="all 800ms ease-in-out,opacity 500ms ease-in-out",p.style["-moz-animation"]="all 800ms ease-in-out,opacity 500ms ease-in-out",p.style["-ms-animation"]="all 800ms ease-in-out,opacity 500ms ease-in-out",p.style.animation="all 800ms ease-in-out,opacity 500ms ease-in-out",p.style.width="100%",p.style.height="30px",p.style["float"]="left",p.style["font-size"]="15px",s.readOnly="readOnly",s.style.opacity="0",s.style.position="absolute",s.style.left="0",s.style.top="-20%",s.style["font-size"]="40px",s.style.width="100%",s.style.height="35px",s.style.direction="rtl",s.className="nofastclick",g.appendChild(p),g.appendChild(s),m.appendChild(g),a.append(m),!Kai.isHybrid&&(s.onchange=function(){if(s.files[0]&&s.value)if(c)try{y.src=c.createObjectURL(s.files[0])}catch(e){}else;}),y.onload=function(){var e=.6,a=768;if(y.width>a){var l=1-(y.width-a)/y.width;y.width=y.width*l,y.height=y.height*l}h.height=y.height,h.width=y.width,r.drawImage(y,0,0,h.width,h.height);var n;if(navigator.userAgent.match(/iphone/i)){var s=new t(y);s.render(h,{maxWidth:y.width,maxHeight:y.height,quality:e}),n=h.toDataURL("image/jpeg",e)}else if(navigator.userAgent.match(/Android/i)){var c=new i.JPEGEncoder;n=c.encode(r.getImageData(0,0,y.width,y.height),60)}else n=h.toDataURL("image/jpeg",e);o.html('<img class="share_contentimg" alt="" src="'+n+'">'),_.isFunction(d)&&d&&d()},Kai.isHybrid&&(s.onclick=function(t){t.preventDefault();var i=new e.Fn("choose_photo",function(e,t){e&&e.photoList&&e.photoList.length>0&&(o.html('<img alt="" src="data:image/gif;base64,'+e.photoList[0]+'">'),_.isFunction(d)&&d&&d())});_.delay(function(){i.run(512e3,1)},500)})}}};return a});