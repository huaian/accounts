define("common/c.img.lazyload",[],function(){"use strict";var i=_.inherit({__propertys__:function(){this.isError=!1,this.uuid=_.uniqueId()+(new Date).getTime()},initialize:function(i){this.__propertys__(),this.handleOpts(i),this.init()},checkWrapperDisplay:function(){this.isError||(this.TIMERRES&&clearInterval(this.TIMERRES),0===$(this.imgs[0]).offset().top&&(this.isError=!0,this.TIMERRES=setInterval($.proxy(function(){$(this.imgs[0]).offset().top>0&&(this.TIMERRES&&clearInterval(this.TIMERRES),this.isError=!1,this.refresh())},this),100)))},handleOpts:function(i){return this.isError=!1,i&&i.imgs&&i.imgs.length?(this.imgs=i.imgs,this.container=i.container||$(window),this.width=i.width,this.height=i.height,this.loadingImg=i.loadingImg||"http://pic.company.com/vacation_v2/h5/group_travel/no_product_pic.png",this.loadingBg=i.loadingBg||"#ebebeb",this.needWrapper=!1,(this.width||this.height)&&(this.needWrapper=!0),this.wrapper=i.wrapper||'<div class="cui_lazyload_wrapper" style="text-align: center; vertical-align: middle; "></div>',void(this.imgContainer={})):void(this.isError=!0)},init:function(){this.isError||(this.initImgContainer(),this.lazyLoad(),this.bindEvents())},refresh:function(i){i&&this.handleOpts(i),this.init()},bindEvents:function(){this.isError||(this.destroy(),this.container.on("scroll.imglazyload"+this.uuid,$.proxy(function(){this.lazyLoad()},this)),$(window).on("resize.imglazyload"+this.uuid,$.proxy(function(){this.initImgContainer()},this)))},initImgContainer:function(){if(!this.isError){var i,t,r,s;for(t=0,r=this.imgs.length;r>t;t++)i=$(this.imgs[t]),i.attr("data-src")&&"1"!=i.attr("data-load")&&(s=i.offset(),this.imgContainer[s.top]||(this.imgContainer[s.top]=[]),this.imgContainer[s.top].push(i))}},_handleImg:function(i){var t,r,s=this;i.attr("data-src")&&(this.needWrapper&&(r=$(this.wrapper),r.css({width:this.width+"px",height:this.height+"px","background-color":this.loadingBg}),r.insertBefore(i),r.append(i)),t=$(new Image),i.attr("src")||i.attr("src",this.loadingImg),t.on("error",function(){i.attr("src",s.loadingImg)}).on("load",function(){i.attr("src",i.attr("data-src")),i.attr("data-load","1"),setTimeout(function(){r&&r[0]&&(i.insertBefore(r),r.remove())},1)}).attr("src",i.attr("data-src")))},lazyLoad:function(){if(!this.isError){var i;if(this.container[0]===window)i=this.container.height();else{var t=this.container.offset();i=t.top+t.height}var r,s,n,o,e,a=this.container.scrollTop();for(r in this.imgContainer)if(parseInt(r,10)<a+i){for(s=this.imgContainer[r],o=0,e=s.length;e>o;o++)n=$(s[o]),this._handleImg(n);delete this.imgContainer[r]}}},destroy:function(){this.isError||(this.TIMERRES&&clearInterval(this.TIMERRES),this.container.off(".imglazyload"+this.uuid),$(window).off(".imglazyload"+this.uuid))}});return i});