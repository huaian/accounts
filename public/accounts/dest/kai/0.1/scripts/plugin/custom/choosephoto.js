define("plugin/custom/choosephoto",["./MegaPixImage","cutil/c.util.common"],function(e,t){var i=0,a={choosePhotoHelper:{renderHtml:function(a,l,n,s){var o,c,d,r,s=s||{},h=h||window.webkitURL,y=document.createElement("canvas"),m=y.getContext("2d"),p=new Image,d=l,r=n||null,g=document.createElement("div"),u=document.createElement("div"),f=document.createElement("span");f.classList.add("ext_file_img"),f.innerHTML="&nbsp; ",c=document.createElement("input"),c.type="file",c.accept="image/*",c.id="img_txt",s.capture&&$(c).attr("capture",s.capture||""),g.id="img_upload_div",g.classList.add("no_iscroll"),g.style.position="absolute",g.style["z-index"]="10",g.style.height="100%",g.style.top="0",g.style.width="100%",g.style.height="25",g.style.margin="0",u.style.position="relative",u.style["font-weight"]="300",u.style["font-size"]="12px",u.style.overflow="hidden",u.style.display="inline-block",u.style["text-decoration"]="none",u.style.border="0 none",u.style["vertical-align"]="middle",u.style.cursor="pointer",u.style.color="#099fde",u.style.width="100%",u.style.height="100%",u.style.color="#099fde",u.style.width="100%",u.style.display="inline-block",u.className="nofastclick js_img_div",f.style.display="block",f.style["-webkit-animation"]="all 800ms ease-in-out,opacity 500ms ease-in-out",f.style["-moz-animation"]="all 800ms ease-in-out,opacity 500ms ease-in-out",f.style["-ms-animation"]="all 800ms ease-in-out,opacity 500ms ease-in-out",f.style.animation="all 800ms ease-in-out,opacity 500ms ease-in-out",f.style.width="100%",f.style.height="30px",f.style["float"]="left",f.style["font-size"]="15px",c.readOnly="readOnly",c.style.opacity="0",c.style.position="absolute",c.style.left="0",c.style["font-size"]="40px",c.style.width="100%",c.style.height="100%",c.style.direction="rtl",c.className="nofastclick",u.appendChild(f),u.appendChild(c),g.appendChild(u),"function"==typeof $(a).append&&$(a).append(g),p.onload=function(){h.revokeObjectURL(p.src);var i=.8,a=768;if(p.width>a){var l=1-(p.width-a)/p.width;p.width=p.width*l,p.height=p.height*l}y.height=p.height,y.width=p.width,m.drawImage(p,0,0,y.width,y.height);var n;if(navigator.userAgent.match(/iphone/i)){var s=new e(p);s.render(y,{maxWidth:p.width,maxHeight:p.height,quality:i}),n=y.toDataURL("image/jpeg",i)}else if(navigator.userAgent.match(/Android/i)){var o=new t.JPEGEncoder;n=o.encode(m.getImageData(0,0,p.width,p.height),80)}else n=y.toDataURL("image/jpeg",i);$(d).html('<img  style="-webkit-transform: translate(0px, 0px) translateZ(0px);" class="share_contentimg no_inputclear" alt="" src="'+n+'">'),_.isFunction(r)&&r&&r()},c.onchange=function(){if(c.files[0]&&c.value)if(h){Kai.showToast({text:"图片上传中,请等待",closeTime:1500});try{var e;_.delay(function(){e=h.createObjectURL(c.files[0]);var t=2e3;if(i){var a=i-new Date;t=a>0?t+a:t}o=_.delay(function(){p.src=e},t),i=+new Date+t},2e3)}catch(t){}}else;}}}};return a});