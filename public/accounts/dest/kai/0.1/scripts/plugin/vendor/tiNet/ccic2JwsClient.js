define("plugin/vendor/tiNet/ccic2JwsClient",["dojo","dijit","dojox"],function(e,c,n){function t(){function e(){return jws.browserSupportsWebSockets()?new jws.jWebSocketCcicClient:void 0}jws.oop.addPlugIn(jws.jWebSocketCcicClient,jws.CcicJwsClientPlugIn),r=e()}function a(e,c){for(var n=0;n<c.length;n++)if(e==c[n])return!0}function i(){stateLocation="s1",l.connectionCloseCount>=11?(ccic2CallbackAction("agentDebug","连接失败,请稍后再试或联系管理员\n"),ccic2CallbackAction("cbDebug","连接失败,请稍后再试或联系管理员\n")):(ccic2CallbackAction("agentDebug","系统正在第"+l.connectionCloseCount+"次尝试连接..\n"),ccic2CallbackAction("cbDebug","<p>系统正在第"+l.connectionCloseCount+"次尝试连接...<p/>"),autoReconnectsitId=setInterval(function(){l.randoms=l.randoms-1,0==l.randoms&&(userBasic.setInitStatus("noCare"),r.login(),clearTimeout(autoReconnectsitId)),10==l.connectionCloseCount&&(ccic2CallbackAction("agentDebug","自动重连尝试已经达到最大次数(10次),请手动重连或联系管理员\n"),ccic2CallbackAction("cbDebug","<p>自动重连尝试已经达到最大次数(10次),请手动重连或联系管理员<p/>"),clearTimeout(autoReconnectsitId))},1e3))}function s(e){var c=Math.floor(Math.random()*e+5);return c}function o(){var e=navigator.userAgent,c=e.indexOf("Opera")>-1;return c?"Opera":e.indexOf("Firefox")>-1?"FF":e.indexOf("Safari")>-1?"Safari":e.indexOf("compatible")>-1&&e.indexOf("MSIE")>-1&&!c?"IE":void 0}var r,l={debugTimes:"",debug:"",lastPing:null,latency:0,isDebug:!1,pingValue:!1,connectionCloseCount:0,randoms:0,kickouts:!1,backendLogoutEvent:!1,monitoringArray:["threewayLink","threewayUnlink","threewayError","spyLink","spyUnlink","spyError","whisperLink","whisperUnlink","whisperError","bargeLink","bargeError","disconnectUnlink","disconnectError"],stateMachineArray:["ringing","previewOutcallBridge","consultLink","consultError","unconsult","consultThreeway","consultThreewayUnlink","consultTransfer"]},u=function(){var e=(new Date).toLocaleDateString()+(new Date).toLocaleTimeString();return e};jws.CcicJwsClientPlugIn={getSessionId:function(){return this.fSessionId},login:function(){if(this.isOpened())this.sendToken({type:"login",loginType:"frontend",initStatus:userBasic.getInitStatus(),hotline:userBasic.getHotLine()+"",cno:userBasic.getCno()+"",pwd:hex_md5(userBasic.getPwd()+r.getSessionId()),bindTel:userBasic.getBindTel()+"",bindType:userBasic.getBindType()+""});else{var e={};e.OnOpen=function(e,c,n){ccic2CallbackAction("agentDebug","connection open!\n"),ccic2CallbackAction("cbDebug","connection open!"),l.connectionCloseCount=0,l.randoms=s("5");var t={};t.msg="open",t.randoms=l.randoms,ccic2CallbackAction("cbBreakLine",t)},e.OnMessage=function(e,c){"agentDebug"!=e.reqType&&ccic2CallbackAction("agentDebug","返回时间："+u()+" Event:"+e.data+"\n"),ccic2CallbackAction("cbDebug","<p><span style='color:#00f'>返回时间："+u()+"</span> Event:"+e.data+"<p/>")},e.OnClose=function(e){if(0==l.kickouts&&0==l.backendLogoutEvent){l.connectionCloseCount=l.connectionCloseCount+1,l.randoms=s("5"),"IE"==o();var c={};c.msg="Connection interrupted",c.attempts=l.connectionCloseCount,c.randoms=l.randoms,ccic2CallbackAction("cbBreakLine",c),ccic2CallbackAction("agentDebug","connection close!\n"),ccic2CallbackAction("cbDebug","<p>connection close!<p/>"),i()}};var c=document.location.href,n=c.indexOf("https")>-1;n?this.open(jws.JWS_SERVER_SSL_URL,e):this.open(jws.JWS_SERVER_URL,e)}},logout:function(e){this.sendToken({RemoveBinding:e,loginType:"frontend",type:"logout"})},queueStatus:function(){this.sendToken({type:"queueStatus"})},pause:function(e){this.sendToken({type:"pause",pauseDescription:e+"",loginType:"frontend"})},unpause:function(){this.sendToken({type:"unpause",loginType:"frontend"})},unlink:function(){this.sendToken({type:"unlink"})},hold:function(e){this.sendToken({type:"hold",holdType:e+""})},unhold:function(){this.sendToken({type:"unhold"})},consult:function(e,c){this.sendToken({type:"consult",consultObject:e+"",objectType:c+""})},unconsult:function(){this.sendToken({type:"unconsult"})},consultCancel:function(){this.sendToken({type:"consultCancel"})},consultThreeway:function(){this.sendToken({type:"consultThreeway"})},consultTransfer:function(e){this.sendToken({type:"consultTransfer",limitTimeSecond:e.limitTimeSecond,limitTimeAlertSecond:e.limitTimeAlertSecond,limitTimeFile:e.limitTimeFile})},transfer:function(e,c){this.sendToken({type:"transfer",transferObject:e+"",objectType:c+""})},interact:function(e){this.sendToken({type:"interact",interactObject:e+""})},investigation:function(){this.sendToken({type:"investigation"})},spy:function(e,c,n){this.sendToken({type:"spy",spyObject:e+"",objectType:c+"",spiedCno:n+""})},unspy:function(e){this.sendToken({type:"unspy",spiedCno:e+""})},whisper:function(e,c,n){this.sendToken({type:"whisper",whisperObject:e+"",objectType:c+"",whisperedCno:n+""})},unwhisper:function(e){this.sendToken({type:"unwhisper",whisperedCno:e+""})},barge:function(e,c,n){this.sendToken({type:"barge",bargeObject:e+"",objectType:c+"",bargedCno:n+""})},setPause:function(e,c){this.sendToken({type:"setPause",monitorCno:e+"",monitoredCno:c+""})},setUnpause:function(e,c){this.sendToken({type:"setUnpause",monitorCno:e+"",monitoredCno:c+""})},pickup:function(e){this.sendToken({type:"pickup",pickupCno:e+""})},threewayOk:function(e,c,n){this.sendToken({type:"threeway",threewayedCno:e+"",objectType:c+"",threewayedObject:n+""})},unthreeway:function(e){this.sendToken({type:"unthreeway",threewayedCno:e+""})},disconnects:function(e){this.sendToken({type:"disconnect",disconnectedCno:e+""})},status:function(){this.sendToken({type:"status"})},refuse:function(){this.sendToken({type:"refuse"})},previewOutCall:function(e,c,n,t,a,i,s,o,r){this.sendToken({type:"previewOutCall",previewOutcallTel:e+"",callType:c+"",taskId:n+"",customerCrmId:t+"",taskInventoryId:a+"",userField:o+"",obClidLeftNumber:s+"",orderCallBackId:r+""},{spawnThread:!0})},previewOutcallCancel:function(){this.sendToken({type:"previewOutcallCancel"})},webChat:function(e,c,n,t){this.sendToken({type:"webchat",webchatMsg:e+"",webchatType:c+"",cno:t+"",groupId:parseInt(n,10)})},changeBindTel:function(e,c){this.sendToken({type:"changeBindTel",bindTel:e+"",bindType:c+""})},saveAgentDebug:function(e,c,n){this.sendToken({type:"agentDebug",cno:c+"",enterpriseId:n+"",message:e})},mute:function(e,c){this.sendToken({type:"mute",direction:e,state:c})},ping:function(e){var c=!0;e&&e.echo&&(c=!0),this.isConnected()&&(this.sendToken({type:"ping",echo:c},e),l.lastPing=(new Date).getTime());var n=3;this.keepAlive=setInterval(function(){if(n-=1,0==n)if(l.pingValue)clearInterval(this.keepAlive);else{clearInterval(this.keepAlive),l.connectionCloseCount=l.connectionCloseCount+1,l.randoms=s("5");var e={};e.msg="Connection interrupted",e.attempts=l.connectionCloseCount,e.randoms=l.randoms,ccic2CallbackAction("cbBreakLine",e),ccic2CallbackAction("agentDebug","connection close!\n"),ccic2CallbackAction("cbDebug","<p>connection close!<p/>"),i()}},1e3)},closes:function(){userBasic.Api=!1,this.close()}},jws.oop.declareClass("jws","jWebSocketCcicClient",jws.jWebSocketJSONClient,{sendToken:function(e,c){return"agentDebug"!=e.type&&ccic2CallbackAction("agentDebug","发送时间："+u()+" "+this.tokenToStream(e)),ccic2CallbackAction("cbDebug","<p><span style='color:#00f'>发送时间："+u()+"</span>"+this.tokenToStream(e)+"<p/>"),arguments.callee.inherited.call(this,e,c)},tokenToStream:function(e){e.utid=jws.CUR_TOKEN_ID,this.fSessionId&&(e.usid=this.fSessionId);var c=JSON.stringify(e);return c+"\n"},processToken:function(e){switch(e.type){case"response":if("-1"==e.code)break;switch(e.reqType){case"login":"0"==e.code?(userBasic.setEnterpriseId(e.enterpriseId),"1"==e.isAgentDebug&&(l.isDebug=!0),r.ping(),userBasic.Api=!0,ccic2CallbackAction("cbLogin",e)):(userBasic.Api=!1,ccic2CallbackAction("cbLogin",e),this.close());break;case"logout":userBasic.Api=!1,stateLocation="s1",l.kickouts=!0,ccic2CallbackAction("cbLogout",e),this.close();break;case"ping":l.pingValue=!0,setTimeout(function(){r.ping()},3e4),userBasic.setLatency(new Date-l.lastPing);break;case"queueStatus":ccic2CallbackAction("cbQueueStatus",e);break;case"unlink":ccic2CallbackAction("cbUnLink",e);break;case"hold":ccic2CallbackAction("cbHold",e);break;case"unhold":ccic2CallbackAction("cbUnhold",e);break;case"consult":"ok"!=e.msg?(stateLocation="s5",recordPhone.et="e23",stateCore(recordPhone),ccic2CallbackAction("cbConsultError",e)):(e.action="a26",ccic2CallbackAction("cbThisStatus",e));break;case"consultCancel":ccic2CallbackAction("cbConsultCancel",e);break;case"unconsult":ccic2CallbackAction("cbUnconsult",e);break;case"consultThreeway":e.action="a27",e.eventName="consultThreeBusy",ccic2CallbackAction("cbThisStatus",e),ccic2CallbackAction("cbConsultThreeway",e);break;case"consultTransfer":ccic2CallbackAction("cbConsultTransfer",e);break;case"transfer":ccic2CallbackAction("cbTransfer",e);break;case"interact":e.action="a28",e.eventName="transferInteract","ok"==e.msg&&ccic2CallbackAction("cbThisStatus",e),ccic2CallbackAction("cbInteract",e);break;case"investigation":ccic2CallbackAction("cbInvestigation",e);break;case"changeBindTel":ccic2CallbackAction("cbChangeBindTel",e),"ok"==e.msg&&userBasic.setBindTel(e.bindTel);break;case"pause":ccic2CallbackAction("cbPause",e);break;case"unpause":ccic2CallbackAction("cbUnpause",e);break;case"previewOutCall":ccic2CallbackAction("cbPreviewOutCall",e);break;case"previewOutcallCancel":ccic2CallbackAction("cbPreviewOutCallCancel",e);break;case"threeway":ccic2CallbackAction("cbThreewayOk",e);break;case"unthreeway":ccic2CallbackAction("cbUnthreeway",e);break;case"spy":ccic2CallbackAction("cbSpy",e);break;case"unspy":ccic2CallbackAction("cbUnspy",e);break;case"whisper":ccic2CallbackAction("cbWhisper",e);break;case"unwhisper":ccic2CallbackAction("cbUnwhisper",e);break;case"barge":ccic2CallbackAction("cbBarge",e);break;case"setPause":ccic2CallbackAction("cbSetPause",e);break;case"setUnpause":ccic2CallbackAction("cbSetUnpause",e);break;case"disconnect":ccic2CallbackAction("cbDisconnects",e);break;case"pickUp":ccic2CallbackAction("cbPickup",e);break;case"refuse":ccic2CallbackAction("cbRefuse",e)}this.checkCallbacks(e);break;case"event":if(a(e.name,l.monitoringArray))return void ccic2CallbackAction("cbMonitoringStatus",e);if(a(e.name,l.stateMachineArray)){var c=statePrepare(e);return void stateCore(c)}switch(e.name){case"welcome":l.debugTime=(new Date).getTime(),e.sessionId&&(this.fSessionId=e.sessionId,this.fClientId=e.sourceId,this.notifyPlugInsOpened(),this.sendToken({type:"login",loginType:"frontend",initStatus:userBasic.getInitStatus()+"",hotline:userBasic.getHotLine()+"",cno:userBasic.getCno()+"",pwd:hex_md5(userBasic.getPwd()+r.getSessionId()),bindTel:userBasic.getBindTel()+"",bindType:userBasic.getBindType()+""}),ccic2CallbackAction("cbWelcome",e));break;case"goodbye":this.fSessionId=null,this.close();break;case"status":if(ccic2CallbackAction("cbStatus",e),userBasic.getCno()==e.cno&&userBasic.getEnterpriseId()==e.enterpriseId){var c=statePrepare(e);stateCore(c)}break;case"incoming":break;case"answer":break;case"joinQueue":ccic2CallbackAction("cbQueue",e);break;case"queueCall":ccic2CallbackAction("cbQueue",e);break;case"leaveQueue":ccic2CallbackAction("cbQueue",e);break;case"kickout":this.close(),l.kickouts=!0,ccic2CallbackAction("cbKickout",e);break;case"webchatMsg":ccic2CallbackAction("cbWebChat",e);break;case"previewStart":ccic2CallbackAction("cbPreview",e);break;case"previewPause":ccic2CallbackAction("cbPreview",e);break;case"previewComplete":ccic2CallbackAction("cbPreview",e);break;case"agenda":ccic2CallbackAction("cbAgenda",e);break;case"unanswer":ccic2CallbackAction("cbUnanswer",e);break;case"interactReturn":e.action="a29",e.eventName="interactReturn",ccic2CallbackAction("cbThisStatus",e);break;case"backendLogoutEvent":l.kickouts=!0,l.backendLogoutEvent=!0,ccic2CallbackAction("cbBackendLogout",e);break;case"smsReceive":ccic2CallbackAction("cbSmsReceive",e);case"openAgentDebug":l.isDebug=!0;break;case"closeAgentDebug":l.isDebug=!1;break;case"agentScreenShot":ccic2CallbackAction("agentScreenShot",e);break;case"orderCallBack":ccic2CallbackAction("cbOrderCallBack",e)}}var n=jws.jWebSocketTokenClient.fPlugIns;if(n)for(var t=0,i=n.length;i>t;t++){var s=n[t];s.processToken&&s.processToken.call(this,e)}},streamToToken:function(e){var c=JSON.parse(e);return c}}),t();var b={deviceStatusLoginStatus:function(e,c,n){var t=c,a=n;void 0==t&&(t=""),void 0==a&&(a="");var i="";switch(e){case"idleonline":i="空闲";break;case"idleoffline":i="离线";break;case"undefinedoffline":i="离线";break;case"idlepause":i=b.idlepause(t);break;case"ringingonline":i="响铃";break;case"ringingoffline":i="离线";break;case"ringingpause":i="响铃";break;case"busyonline":i=b.busyonline(a);break;case"busyoffline":i="离线";break;case"busypause":i=""!=t?b.busypause(t):b.busypause(a);break;case"unavalibleonline":i="失效";break;case"unavalibleoffline":i="离线";break;case"unavaliblepause":i=b.unavaliblepause(t)}return i},idlepause:function(e){var c="";switch(e){case"pauseWrapup":c="整理";break;case"pauseOutCalling":c="外呼中";break;case"Auto-Pause":c="自动置忙";break;case"":c="忙";break;default:c=e}return c},ringingpause:function(e){var c="";switch(e){case"pauseWrapup":c="响铃";break;case"pauseOutCalling":c="响铃";break;default:c="响铃"}return c},busypause:function(e){var c="";switch(e){case"pauseWrapup":c="通话";break;case"pauseOutCalling":c="通话";break;case"busyOnhold":c="保持";break;default:c="通话"}return c},unavaliblepause:function(e){var c="";switch(e){case"pauseWrapup":c="失效";break;case"pauseOutCalling":c="失效";break;default:c="失效"}return c},busyonline:function(e){var c="";switch(e){case"busyOnhold":c="保持";break;default:c="通话"}return c}};window.jWebSocketClient=r,window.ccic2Global=l,window.deviceStatus=b,window.myBrowser=o,window.randomNumber=s,window.autoReconnect=i,window.monitoringFunction=a});