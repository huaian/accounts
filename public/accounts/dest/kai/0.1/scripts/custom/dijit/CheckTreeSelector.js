require({cache:{"url:custom/dijit/templates/CheckTreeSelector.html":'<div style=\'position:relative;display:inline-block;\' data-dojo-attach-point="containerNode">\n    <input data-dojo-attach-point=\'descInput\' data-dojo-type="dijit/form/TextBox" type="text" name="${name}Desc" id="tree_input_${id}" data-dojo-props=\'readOnly:true\' />\n    <input data-dojo-attach-point=\'realInput\' id="real_input_${id}" name="${name}" class="real_input" type="hidden"  data-dojo-type="dijit/form/TextBox" />\n    <button data-dojo-type="dijit/form/Button" type="button" id=\'tree_button_${id}\' class=\'dijitArrowButtonInner-custom\'></button>\n    <div id="tree_container_${id}" style=\'display:none;height:150px;background-color:#FFF;z-index:100;overflow-y:scroll;left:0;border:1px solid #8babc7;;min-width:160px;position:absolute\' tabindex=\'0\'>\n    </div>\n</div>\n'}}),define("custom/dijit/CheckTreeSelector",["dojo/_base/lang","ui/promptpop/ui.promptpop","dojo/on","dojo/store/Memory","dijit/tree/ObjectStoreModel","dijit/Tree","dijit/_WidgetBase","dijit/_TemplatedMixin","dijit/_WidgetsInTemplateMixin","dojo/text!./templates/CheckTreeSelector.html","dojo/_base/declare","dijit/registry","custom/dgrid/cdgrid"],function(e,t,i,n,s,o,d,r,a,c,u,h,l,m){return u([d,r,a],{view:null,name:"",templateString:c,maxCheckCount:2,needCheckbox:!1,baseClass:"treeSelectorWidget",_bindEvents:function(){var n=this,s=this.get("tree"),o=this.get("input"),d=(this.get("realInput"),h.byId("tree_button_"+this.id)),r=$(this.domNode).find("#tree_container_"+this.id);s.on("check",function(e){var i=arguments[2],o=i?i.target.checked:!0;if(this.checkedItems=this.checkedItems||[],""===e.id)return i&&i.preventDefault(),n._resetInputValue(),n._setCheckedItemsAttr([]),!0;if(this.checkedItems.length===this.maxCheckCount&&o){if(!(this.maxCheckCount<=1)){i&&i.preventDefault();var d=new t({});return s.hovering&&d.display({text:"可以最多选择"+n.maxCheckCount+"项",textClass:"popTextColor"}),!1}this.checkedItems=[]}o?this.checkedItems.push(_.omit(e,"bubbles","cancelable","detail")):this.checkedItems=_.without(this.checkedItems,_.findWhere(this.checkedItems,e)),n._setInpuValue(),n.onChange(this.checkedItems)}),i(r[0],"blur",function(){return s.hovering?!1:void r.hide()}),i(s,"blur",function(){_.defer(function(){r.focus()})}),i(o,"click",function(e){return n.readOnly?!1:void(r.is(":hidden")?(r.show(),r.focus()):r.hide())}),i(d,"click",function(e){return n.readOnly?!1:(r.show(),void s.focus())}),i(s,"change",function(e){n.onChange(e)}),s.on("click",function(t,i,s){return t.leaf?this.needCheckbox?(s&&"treeNodeCheckbox"!==s.target.getAttribute("class")&&$(i.domNode).find(".treeNodeCheckbox").click(),!1):(this.checkedItems=[t],n._setInpuValue(),n.onChange(e.clone(this.checkedItems)),void r.hide()):!1})},_setReadOnlyAttr:function(e){this.get("input");this.readOnly=e},_resetInputValue:function(){var e=this.get("input"),t=this.get("realInput");e.reset(),t.reset()},_setInpuValue:function(){var e="",t="",i=this.get("tree"),n=this.get("input"),s=this.get("realInput");_.each(i.checkedItems,function(n,s){s>0&&s!==i.checkedItems.length&&(e+=",",t+=","),e+=n.id?n.id+"-"+n.name:n.name,t+=n.id}),n.set("value",e),s.set("value",t),this.checkedName=i.checkedItems[0]&&i.checkedItems[0].name},_getTreeAttr:function(){return h.byId("tree_"+this.id)},_getInputAttr:function(){return h.byId("tree_input_"+this.id)},_getCheckedNameAttr:function(){return this.checkedName||""},_getRealInputAttr:function(){return h.byId("real_input_"+this.id)},_getValueAttr:function(){return $(this.domNode).find(".real_input").val()},_getDisplayedValueAttr:function(){return this.get("input").get("value")},_setDisplayedValueAttr:function(t){var i=this,t=t||"";if(_.isString(t)){var n=t.split(","),s=[];_.each(n,function(e){e.split("-").length>1&&(e=e.split("-")[1]),_.each(i.treeItems,function(t){t.name===e&&s.push(_.omit(t,"bubbles","cancelable","detail"))})}),s.length?this.set("checkedItems",e.clone(s)):this.get("input").set("value",t)}},isValidValue:function(e){var t=!1;return this.treeItems&&$.each(this.treeItems,function(i,n){return n.id===e?(t=!0,!1):void 0}),t},_setObjValueAttr:function(e){if(_.isObject(e)){var t=!1;this.treeItems&&($.each(this.treeItems,function(i,n){return n.id===e.value?(t=!0,!1):void 0}),t?this.set("value",e.value):this.set("displayedValue",e.desc))}},_setValueAttr:function(t){var i=this,t=t||"";if(_.isString(t)){var n=t.split(","),s=[];_.each(n,function(e){_.each(i.treeItems,function(t){t.id===e&&s.push(_.omit(t,"bubbles","cancelable","detail"))})}),this.set("checkedItems",e.clone(s))}},_getCheckedItemsAttr:function(){return this.tree.get("checkedItems")},_setCheckedItemsAttr:function(e){this.tree.set("checkedItems",e),this.onChange(e)},onChange:function(){},generateTree:function(){this.name&&this.get("realInput").set("name",this.name);var e=new n({data:this.treeItems,getChildren:function(e){return this.query({parent:e.id})}}),t=new s({store:e,query:{id:null},mayHaveChildren:function(e){return!e.leaf}}),i=new o({model:t,maxCheckCount:this.maxCheckCount,needCheckbox:this.needCheckbox,id:"tree_"+this.id,showRoot:!1,getIconClass:function(e,t){return!e||this.model.mayHaveChildren(e)?t?"dijitFolderOpened":"dijitFolderClosed":"dijitLeaf leaf"}}),d=$(this.domNode).find("#tree_container_"+this.id);i.placeAt(d[0]),this.tree=i,this._bindEvents()},_setDisabledAttr:function(e){this.realInput.set("disabled",!!e),this.descInput.set("disabled",!!e),this.disabled=!!e},_onMouseOut:function(){domClass.remove(this.displayNode,"dijitInlineEditBoxDisplayModeHover")},postCreate:function(){var e=this;e.generateTree()}})});