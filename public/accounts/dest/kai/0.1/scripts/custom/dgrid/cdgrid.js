define("custom/dgrid/cdgrid",["dojo/query","dojo/_base/declare","dojo/dom-construct","dojo/_base/lang","dojo/has","data/model/dataHandlerFactory","module","dgrid/Grid","dgrid/Keyboard","dgrid/Editor","dgrid/extensions/Pagination","dgrid/extensions/ColumnHider","dgrid/Selection","dgrid/Selector","dgrid/extensions/ColumnResizer","dgrid/extensions/DijitRegistry","dojo/domReady!"],function(e,t,i,n,a,o,d,r,s,c,l,u,h,f,g,p){return t([r,c,h,f,l,u,g],{selectionMode:"single",allowTextSelection:!0,noDataMessage:"没有结果.",loadingMessage:"查询中...",firstLastArrows:!0,pagingLinks:!1,pagingTextBox:!0,rowsPerPage:25,pageSizeOptions:[5,10,15,25],getBeforePut:!1,showFooter:!0,showHeader:!0,className:"dgrid-autoheight",postscript:function(e,t){var i=this;(this._Row=function(e,t,i){this.id=e,this.data=t,this.element=i}).prototype.remove=function(){i.removeRow(this.element)};var n=function(e){return document.getElementById(e)};t&&(t.nodeType?this.srcNodeRef=t:e.view&&e.view.$el&&0!==e.view.$el.find("#"+t).length?this.srcNodeRef=t=e.view.$el.find("#"+t)[0]:this.srcNodeRef=t=n(t)),this.create(e,t)},_createEditor:function(e,t){var o,d,r,s,c=e.editor,l=e.editOn,u=this,h="string"!=typeof c&&c,f={};if(o=e.editorArgs||{},"function"==typeof o&&(o=o.call(this,e)),h?("function"==typeof o.canEdit&&(o.disabled=!o.canEdit(t)),d=new h(o),r=d.focusNode||d.domNode,r.className+=" dgrid-input",d.on(l?"blur":"change",function(){d._dgridIgnoreChange||u._updatePropertyFromEditor(e,this,{type:"widget"})})):(this._hasInputListener||(this._hasInputListener=!0,this.on("change",function(e){u._handleEditorChange(e)})),"textarea"===c?s="textarea":(s="input",f.type=c),d=r=i.create(s,n.mixin(f,{className:"dgrid-input",name:e.field,tabIndex:isNaN(e.tabIndex)?-1:e.tabIndex},o)),a("ie")<9&&("radio"===c||"checkbox"===c?this._editorColumnListeners.push(on(d,"click",function(t){u._handleEditorChange(t,e)})):this._editorColumnListeners.push(on(d,"change",function(t){u._handleEditorChange(t,e)})))),e.autoSelect){var g=d.focusNode||d;g.select&&on(g,"focus",function(){setTimeout(function(){g.select()},0)})}return d},_configureEditorColumn:function(e){var t=e.editor,i=this,n=e.renderCell||this._defaultRenderCell,a=e.editOn,o="string"!=typeof t;a?this._editorInstances[e.id]=this._createSharedEditor(e,n):o&&this._alwaysOnWidgetColumns.push(e),e.renderCell=a?function(t,o,d,r){return r&&r.alreadyHooked||i._editorColumnListeners.push(on(d,a,function(){i._activeOptions=r,i.edit(this)})),n.call(e,t,o,d,r)}:function(t,a,d,r){if(e.canEdit&&!e.canEdit(t,a))return n.call(e,t,a,d,r);var s=i._createEditor(e,t);i._showEditor(s,e,d,a),d[o?"widget":"input"]=s}},_getSelectedItem:function(e){return this.selectedItem},_getSelectedItems:function(e){return this.selectedItems},_getSelectedItemsData:function(e){return this.selectedItemsData},_getSelectedItemData:function(e){return this.selectedItemData},postCreate:function(){var e=this,t=function(t){var i=e.collection.idProperty;e.selectedItem=t.rows[0],e.selectedItemData=t.rows[0].data;var n=_.pluck(t.rows,"data"),a=_.pluck(n,i);if(e.selectedItemsData){e.selectedItemsData=_.reject(e.selectedItemsData,function(e){return!_.isObject(e)||_.contains(a,e[i]+"")}),"dgrid-select"==t.type&&(e.selectedItemsData=e.selectedItemsData.concat(_.pluck(t.rows,"data")));var o=e.getSelectedIds();e.selectedItemsData=_.compact(_.reject(e.selectedItemsData,function(e){return!_.contains(o,e[i]+"")}))}else e.selectedItemsData=n};this.on("dgrid-select",function(e){t(e)}),this.on("dgrid-deselect",function(e){t(e)}),this.inherited(arguments)},getSelectedItem:function(){var e=_.keys(this.selection)[0],t=this.collection.data.filter(function(t){return t.id==e});return t[0]},_updateInputValue:function(e,t){if(e.value=t,"radio"===e.type||"checkbox"===e.type){var i=t;"Y"===t?i=!0:"N"===t&&(i=!1),e.checked=e.defaultChecked=!!i}},_retrieveEditorValue:function(e,t){return"function"==typeof t.get?("checkbox"===t.type||"radio"===t.type?e.useYN?value=t.checked?"Y":"N":value=t.checked:value=t.get("value"),this._convertEditorValue(value)):("checkbox"===t.type||"radio"===t.type?e.useYN?value=t.checked?"Y":"N":value=t.checked:value=t.value,this._convertEditorValue(value))},_updatePropertyFromEditor:function(t,i,n){var a,o,d;if((!i.isValid||i.isValid())&&(a=this._updateProperty((i.domNode||i).parentNode,this._activeCell?this._activeValue:i._dgridLastValue,this._retrieveEditorValue(t,i),n),this._activeCell?this._activeValue=a:i._dgridLastValue=a,"radio"===i.type&&i.name&&!t.editOn&&t.field)){d=this.row(i),e("input[type=radio][name="+i.name+"]",this.contentNode).forEach(function(e){var n=this.row(e);e!==i&&e._dgridLastValue&&("N"===e._dgridLastValue||"Y"===e._dgridLastValue?e._dgridLastValue="N":e._dgridLastValue=!1,this.updateDirty?"N"===e._dgridLastValue?this.updateDirty(n.id,t.field,"N"):this.updateDirty(n.id,t.field,!1):n.data[t.field]=!1)},this);for(o in this.dirty)d.id.toString()!==o&&this.dirty[o][t.field]&&"N"!==this.dirty[o][t.field]&&this.updateDirty(o,t.field,!1)}},_startupEditor:function(e,t,i,n){e.domNode&&(e._started||e.startup(),e._dgridIgnoreChange=!0,"N"===n||e.set("value",n),setTimeout(function(){e._dgridIgnoreChange=!1},0)),e._dgridLastValue=n,this._activeCell&&(this._activeValue=n,on.emit(i,"dgrid-editor-show",{grid:this,cell:this.cell(i),column:t,editor:e,bubbles:!0,cancelable:!1}))},reload:function(e){var t=this;if(t.revert(),e&&e.isRest);else if(_.isObject(e)&&_.isArray(e.data))t.revert(),t.collection.setData(e.data),t.refresh();else{var i=o.create(d.config().models),n=this.modelName,a=this.paramObj||{};i[n](a).then(function(e){t.revert(),t.collection.setData(e.list),t.refresh()},function(e){e.msg&&Kai.showToast(e.msg)})}},getSelectedItemData:function(){return(this.getSelectedItems()||[])[0]},getSelectedIds:function(){var e=this,t=[];for(var i in e.selection)e.selection[i]&&t.push(i);return t.length?t:[]},getSelectedItems:function(){var e=this,t=_.keys(e.selection);if(!t.length)return[];var i;i=e.collection.data?e.collection.data:e.collection.root?e.collection.root.data:e.collection.cachingStore.data;var n=i.filter(function(e){var i=!1;return _.each(t,function(t){return t==e.id?void(i=!0):void 0}),i});return n},getDirtyItems:function(){var e=this,t=[];return _.each(e.dirty,function(i,n){_.each(e.collection.data,function(e){e.id===n&&t.push(_.extend(e,i))})}),t},_onNotification:function(e,t,i){var n=this.rowsPerPage,a=this._currentPage*n,o="add"===t.type&&t.index<a||"delete"===t.type&&t.previousIndex<a||"update"===t.type&&Math.floor(t.index/n)!==Math.floor(t.previousIndex/n);o||i===this._renderedCollection&&t.totalLength!==this._total&&(this._updatePaginationStatus(t.totalLength),this._updateNavigation(t.totalLength))}})});