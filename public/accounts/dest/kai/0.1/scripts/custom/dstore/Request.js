define("custom/dstore/Request",["dojo/request","dojo/_base/lang","dojo/_base/array","dojo/json","dojo/_base/declare","dstore/Store","dstore/QueryResults"],function(e,r,t,n,a,s,i){var o=[].push;return a(s,{constructor:function(){this.headers||(this.headers={}),this.target.url?this._targetContainsQueryString=this.target.url.lastIndexOf("?")>=0:this._targetContainsQueryString=this.target.lastIndexOf("?")>=0},headers:{},parse:n.parse,target:"",ascendingPrefix:"+",descendingPrefix:"-",accepts:"application/json",fetch:function(){var e=this._request();return new i(e.data,{response:e.response})},fetchRange:function(e){var r=e.start,t=e.end,n={};this.useRangeHeaders?n.headers=this._renderRangeHeaders(r,t):n.queryParams=this._renderRangeParams(r,t);var a=this._request(n);return new i(a.data,{totalLength:a.total,response:a.response})},_request:function(t){t=t||{};var n=r.delegate(this.headers,{Accept:this.accepts});"headers"in t&&r.mixin(n,t.headers);var a,s=this._renderQueryParams();a=this.target.url?this.target.url:this.target,"queryParams"in t&&o.apply(s,t.queryParams),s.length>0&&(a+=(this._targetContainsQueryString?"&":"?")+s.join("&"));var i=e(a,{method:"GET",headers:n}),u=this;return{data:i.then(function(e){var r=u.parse(e);r=r.items||r;for(var t=0,n=r.length;n>t;t++)r[t]=u._restore(r[t],!0);return r}),total:i.response.then(function(e){var r=e.data.total;if(r>-1)return r;var t=e.getHeader("Content-Range");return t&&(t=t.match(/\/(.*)/))&&+t[1]}),response:i.response}},_renderFilterParams:function(e){var r=e.type,n=e.args;return r?"string"===r?[n[0]]:"and"===r||"or"===r?[t.map(e.args,function(e){var t=this._renderFilterParams(e);return"and"!==e.type&&"or"!==e.type||e.type===r?t:"("+t+")"},this).join("and"===r?"&":"|")]:[encodeURIComponent(n[0])+"="+("eq"===r?"":r+"=")+encodeURIComponent(n[1])]:[""]},_renderSortParams:function(e){var r=t.map(e,function(e){var r=e.descending?this.descendingPrefix:this.ascendingPrefix;return r+encodeURIComponent(e.property)},this),n=[];return r&&n.push(this.sortParam?encodeURIComponent(this.sortParam)+"="+r:"sort("+r+")"),n},_renderRangeParams:function(e,r){var t=[];return this.rangeStartParam?t.push(this.rangeStartParam+"="+e,this.rangeCountParam+"="+(r-e)):t.push("limit("+(r-e)+(e?","+e:"")+")"),t},_renderQueryParams:function(){var e=[];return t.forEach(this.queryLog,function(r){var t=r.type,n="_render"+t[0].toUpperCase()+t.substr(1)+"Params";this[n]&&o.apply(e,this[n].apply(this,r.normalizedArguments))},this),e},_renderUrl:function(){var e=this._renderQueryParams(),r=this.target;return e.length>0&&(r+="?"+e.join("&")),r},_renderRangeHeaders:function(e,r){var t="items="+e+"-"+(r-1);return{Range:t,"X-Range":t}}})});