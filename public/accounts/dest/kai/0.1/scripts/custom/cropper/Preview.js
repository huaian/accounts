define("custom/cropper/Preview",["dojo/_base/declare","dijit/_Widget","dojo/dnd/move","dojox/layout/ResizeHandle"],function(i,e){var t=dojo,s=function(i,e){var t=dojo.create(e);return dojo.place(t,i,"before"),dojo.place(i,t,"first"),t},o="absolute",n="position",a="px",h=Math.floor;i("image.Preview",e,{glassSize:150,scale:2,withMouseMove:!1,withDrag:!0,moveInterval:50,hoverable:!1,resizeable:!0,opacity:.35,postCreate:function(){var i=this.glassSize,e=this.scale,r=t.marginBox(this.domNode);this.currentSize=r,this.container=s(this.domNode,"div"),t.marginBox(this.container,r),this.picker=t.create("div",{"class":"imageDragger",style:{opacity:this.hoverable?0:this.opacity,width:i+a,height:i+a}},this.domNode,"before"),this.preview=t.create("div",{style:{position:o,overflow:"hidden",width:h(i*e)+a,height:h(i*e)+a,display:"none"}},t.body());var c=s(t.create("img",{style:{position:o},src:this.altSrc||this.domNode.src},this.preview),"div");t.style(c,n,"relative"),t.style(this.domNode,n,o),t.style(this.domNode,"width","100%"),this.domNode.parentElement&&this.domNode.parentElement.removeAttribute("style"),this.image=t.query("img",this.preview).onload(t.hitch(this,"_adjustImage"))[0],this._positionPicker(),this.mover=new t.dnd.move.parentConstrainedMoveable(this.picker,{area:"content",within:!0}),this.resizeable&&(this._handle=new dojox.layout.ResizeHandle({targetContainer:this.picker,fixedAspect:!0,intermediateChanges:!0,activeResize:!0,onResize:t.hitch(this,function(i,e){this._adjustImage(i,e),this._whileMoving()}),constrainMax:!0,maxWidth:r.w,maxHeight:r.h,minWidth:40,minHeight:40}).placeAt(this.picker)),t.subscribe("/dnd/move/start",this,"_startDnd"),t.subscribe("/dnd/move/stop",this,"_stopDnd"),t.isIE&&(this.image.src=this.image.src),this.connect(t.global,"onresize","_positionPicker"),this.hoverable&&(this.connect(this.container,"onmouseenter","_enter"),this.connect(this.container,"onmouseleave","_leave"));try{}catch(d){}},_adjustImage:function(i){var e=this.coords,s=this.scale;if(i&&i.type&&("mouseup"==i.type||"mousemove"==i.type)){var o=t.coords(this.picker);this.scale=t.coords(this.preview).w/o.w}else i&&i.type&&"load"==i.type&&this.imageReady(i);t.style(this.image,{height:h(e.h*s)+a,width:h(e.w*s)+a})},_positionPicker:function(i){var e=this.coords=t.coords(this.container,!0);t.style(this.preview,{left:e.x+e.w+10+a,top:e.y+a})},_startDnd:function(i){!this._interval&&i&&i.node==this.picker&&(this._interval=this.connect(t.doc,"onmousemove","_whileMoving"))},_stopDnd:function(){if(this._interval&&(this.disconnect(this._interval),delete this._interval,this.resizeable&&this._lastXY)){var i=this.coords;this._handle.maxSize={h:h(i.h-(this._lastXY.t-i.t)),w:h(i.w-(this._lastXY.l-i.l))}}},_whileMoving:function(){var i=this._lastXY=t.coords(this.picker),e=this.coords,s=this.image.width/e.w,o=h((i.l-e.l)*s),n=h((i.t-e.t)*s);t.style(this.image,{top:"-"+n+a,left:"-"+o+a})},destroy:function(){t.place(this.domNode,this.container,"before"),t.forEach(["preview","picker","container","image"],function(i){t.destroy(this[i]),delete this[i]},this),this.inherited(arguments)},imageReady:function(){},_enter:function(i){this._anim&&this._anim.stop(),this._anim=t.anim(this.picker,{opacity:this.opacity})},_leave:function(i){this._interval||this._handle._isSizing||(this._anim&&this._anim.stop(),this._anim=t.anim(this.picker,{opacity:0}))}}),dojo.extend(dojo.NodeList,{preview:function(i){return this.instantiate(image.Preview,i)}})});