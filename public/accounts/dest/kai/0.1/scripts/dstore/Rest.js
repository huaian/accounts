define("dstore/Rest",["dojo/request","dojo/when","dojo/_base/lang","dojo/json","dojo/io-query","dojo/_base/declare","./Request"],function(e,t,r,n,i,o,s){return o(s,{stringify:n.stringify,_getTarget:function(e){var t=this.target;return"/"==t.slice(-1)?t+e:t+"/"+e},get:function(t,n){n=n||{};var i=r.mixin({Accept:this.accepts},this.headers,n.headers||n),o=this;return e(this._getTarget(t),{headers:i}).then(function(e){return o._restore(o.parse(e),!0)})},autoEmitEvents:!1,put:function(n,i){i=i||{};var o="id"in i?i.id:this.getIdentity(n),s="undefined"!=typeof o,a=this,d="beforeId"in i?null===i.beforeId?{"Put-Default-Position":"end"}:{"Put-Before":i.beforeId}:s&&i.overwrite!==!1?null:{"Put-Default-Position":this.defaultNewToStart?"start":"end"},u=e(s?this._getTarget(o):this.target,{method:s&&!i.incremental?"PUT":"POST",data:this.stringify(n),headers:r.mixin({"Content-Type":"application/json",Accept:this.accepts,"If-Match":i.overwrite===!0?"*":null,"If-None-Match":i.overwrite===!1?"*":null},d,this.headers,i.headers)});return u.then(function(e){var r={};"beforeId"in i&&(r.beforeId=i.beforeId);var o=r.target=e&&a._restore(a.parse(e),!0)||n;return t(u.response,function(e){a.emit(201===e.status?"add":"update",r)}),o})},add:function(e,t){return t=t||{},t.overwrite=!1,this.put(e,t)},remove:function(t,n){n=n||{};var i=this;return e(this._getTarget(t),{method:"DELETE",headers:r.mixin({},this.headers,n.headers)}).then(function(e){var r=e&&i.parse(e);return i.emit("delete",{id:t,target:r}),e?r:!0})}})});