define("dstore/Store",["dojo/_base/lang","dojo/_base/array","dojo/aspect","dojo/has","dojo/when","dojo/Deferred","dojo/_base/declare","./QueryMethod","./Filter","dojo/Evented"],function(t,e,r,n,o,i,s,u,a,c){function d(t){return function(e,r){var n=this;return o(e,function(e){var o={target:e},i=r[1]||{};"beforeId"in i&&(o.beforeId=i.beforeId),n.emit(t,o)}),e}}n.add("object-proto",!!{}.__proto__&&!{}.watch);var l=n("object-proto"),f=c;return s(f,{constructor:function(t){t&&s.safeMixin(this,t),this.Model&&this.Model.createSubclass&&(this.Model=this.Model.createSubclass([]).extend({_store:this})),this.storage=new c;var e=this;this.autoEmitEvents&&(r.after(this,"add",d("add")),r.after(this,"put",d("update")),r.after(this,"remove",function(t,r){return o(t,function(){e.emit("delete",{id:r[0]})}),t}))},autoEmitEvents:!0,idProperty:"id",queryAccessors:!0,getIdentity:function(t){return t.get?t.get(this.idProperty):t[this.idProperty]},_setIdentity:function(t,e){t.set?t.set(this.idProperty,e):t[this.idProperty]=e},forEach:function(t,e){var r=this;return o(this.fetch(),function(n){for(var o,i=0;void 0!==(o=n[i]);i++)t.call(e,o,i,r);return n})},on:function(t,e){return this.storage.on(t,e)},emit:function(t,e){e=e||{},e.type=t;try{return this.storage.emit(t,e)}finally{return e.cancelable}},parse:null,stringify:null,Model:null,_restore:function(e,r){var n=this.Model;if(n&&e){var o=n.prototype,i=o._restore;i?e=i.call(e,n,r):l&&r?e.__proto__=o:e=t.delegate(o,e)}return e},create:function(t){return new this.Model(t)},_createSubCollection:function(e){var r=t.delegate(this.constructor.prototype);for(var n in this)this._includePropertyInSubCollection(n,r)&&(r[n]=this[n]);return s.safeMixin(r,e)},_includePropertyInSubCollection:function(t,e){return!(t in e)||e[t]!==this[t]},queryLog:[],filter:new u({type:"filter",normalizeArguments:function(t){var e=this.Filter;return t instanceof e?[t]:[new e(t)]}}),Filter:a,sort:new u({type:"sort",normalizeArguments:function(r,n){var o;return"function"==typeof r?o=[r]:(o=r instanceof Array?r.slice():"object"==typeof r?[].slice.call(arguments):[{property:r,descending:n}],o=e.map(o,function(e){return e=t.mixin({},e),e.descending=!!e.descending,e}),o=[o]),o}}),select:new u({type:"select"}),_getQuerierFactory:function(t){var e=t[0].toUpperCase()+t.substr(1);return this["_create"+e+"Querier"]}})});