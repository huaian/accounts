define("dstore/Memory",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","./Store","./Promised","./SimpleQuery","./QueryResults"],function(t,e,i,r,n,s,a){return t([r,n,s],{constructor:function(){this.storage.version=0},postscript:function(){this.inherited(arguments),this.setData(this.data||[])},data:null,autoEmitEvents:!1,getSync:function(t){return this.storage.fullData[this.storage.index[t]]},putSync:function(t,e){e=e||{};var i=this.storage,r=i.index,n=i.fullData,s=this.Model;!s||t instanceof s||(t=this._restore(t));var a=this.getIdentity(t);null==a&&(this._setIdentity(t,"id"in e?e.id:Math.random()),a=this.getIdentity(t)),i.version++;var o,h,d=a in r?"update":"add",u={target:t};if("update"===d){if(e.overwrite===!1)throw new Error("Object already exists");n.splice(o=r[a],1),h=o}else h=this.defaultNewToStart?0:n.length;var l;if("beforeId"in e){var f=e.beforeId;null===f?l=n.length:(l=r[f],l>o&&--l),void 0!==l?u.beforeId=f:l=h}else l=h;n.splice(l,0,t);for(var c=isFinite(o)?Math.min(o,l):l,g=n.length;g>c;++c)r[this.getIdentity(n[c])]=c;return this.emit(d,u),t},addSync:function(t,e){return(e=e||{}).overwrite=!1,this.putSync(t,e)},removeSync:function(t){var e=this.storage,i=e.index,r=e.fullData;if(t in i){var n=r.splice(i[t],1)[0];return this._reindex(),this.emit("delete",{id:t,target:n}),!0}},setData:function(t){this.parse&&(t=this.parse(t)),t.items&&(this.idProperty=t.identifier||this.idProperty,t=t.items);var e=this.storage;e.fullData=this.data=t,this._reindex()},_reindex:function(){for(var t=this.storage,e=t.index={},i=t.fullData,r=this.Model,n=Object.prototype,s=0,a=i.length;a>s;s++){var o=i[s];if(r&&!(o instanceof r)){var h=this._restore(o,o.__proto__===n);o!==h&&(i[s]=o=h)}e[this.getIdentity(o)]=s}t.version++},fetchSync:function(){var t=this.data;if(!t||t._version!==this.storage.version){t=this.storage.fullData;for(var e=this.queryLog,i=0,r=e.length;r>i;i++)t=e[i].querier(t);t._version=this.storage.version,this.data=t}return new a(t)},fetchRangeSync:function(t){var e=this.fetchSync(),i=t.start,r=t.end;return new a(e.slice(i,r),{totalLength:e.length})},_includePropertyInSubCollection:function(t){return"data"!==t&&this.inherited(arguments)}})});