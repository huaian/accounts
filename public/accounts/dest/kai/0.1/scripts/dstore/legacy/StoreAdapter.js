define("dstore/legacy/StoreAdapter",["dojo/_base/declare","dojo/_base/lang","dojo/_base/array","dojo/when","../Store","../QueryResults"],function(t,e,r,n,o,a){var i=function(t){return function(){var e=this.objectStore;return e[t].apply(e,arguments)}};return t(o,{objectStore:null,get:function(){var t=this,e=this.objectStore;return n(e.get.apply(e,arguments),function(e){return t._restore(e)})},put:i("put"),add:i("add"),remove:i("remove"),getIdentity:i("getIdentity"),_setIdentity:function(t,e){return t[this.objectStore.idProperty]=e},fetch:function(){return this.fetchRange()},fetchRange:function(t){function e(t){for(var r=0;r<t.length;r++){var n=t[r],o=n.type,a=n.args;if("and"===o)e(a);else if("eq"===o||"match"===o)d[a[0]]=a[1];else if("string"===o)d=a[0];else if(o)throw new Error('"'+o+" operator can not be converted to a legacy store query")}}var o={},i=this.queryLog,u=function(t){return r.map(r.filter(i,function(e){return e.type===t}),function(t){return t.normalizedArguments[0]})},s=u("sort").pop();if(s&&(o.sort=s,s instanceof Array))for(var c=0;c<s.length;c++){var f=s[c];f.attribute=f.property}t&&(o.count=t.end-((o.start=t.start)||0));var d={};e(u("filter"));var l=this.objectStore.query(d,o);return l?new a(n(l.map(this._restore,this)),{totalLength:n(l.total)}):n(l)}})});