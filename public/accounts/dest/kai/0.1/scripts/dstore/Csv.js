define("dstore/Csv",["dojo/_base/lang","dojo/_base/declare"],function(e,i){function t(e,i){var t,n={},r=e.length;for(t=0;r>t;t++)n[e[t]]=i[t];return n}var n=/^\s*"([\S\s]*)"\s*$/,r=/""/g,s=/"/g;return i(null,{fieldNames:null,delimiter:",",newline:"\r\n",trim:!1,parse:function(i){var s,l,f,o,a,h,d,u,g=[],m=i.split(this.newline),c=this.fieldNames,p=0,v=[],w="",N="";e:for(h=0,f=m.length;f>h;h++)if(e.trim(m[h])){for(s=m[h].split(this.delimiter),d=0,o=s.length;o>d;d++){for(l=s[d],u=-1,w+=N+l,N="";(u=l.indexOf('"',u+1))>=0;)p++;if(p%2===0){if(p>0){if(a=n.exec(w),!a){v=[],w="",p=0;continue e}v.push(a[1].replace(r,'"'))}else v.push(this.trim||!c?e.trim(w):w);w="",p=0}else N=this.delimiter}0===p?(c?g.push(t(c,v)):c=this.fieldNames=v,v=[]):N=this.newline}return g},toCsv:function(e){return this.stringify(this.data,e)},stringify:function(e,i){i=i||{};var t,n,r,l,f=i.alwaysQuote,o=this.fieldNames,a=this.delimiter,h=this.newline,d="";for(t=-1;t<e.length;t++)for(t>-1&&(d+=h),n=0;n<o.length;n++)r=0>t?o[n]:e[t][o[n]],(null===r||void 0===r)&&(r=""),"string"!=typeof r&&(r=r.toString()),l=f||r.indexOf('"')>=0||r.indexOf(a)>=0,d+=(n>0?a:"")+(l?'"'+r.replace(s,'""')+'"':r);return i.trailingNewline&&(d+=h),d}})});