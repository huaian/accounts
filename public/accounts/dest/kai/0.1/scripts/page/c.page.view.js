define("page/c.page.view",["kaiView/pc/topic/topics","ui/tip/ui.tip","custom/helper/dijitHelper","dojo/on","dojo/_base/lang","ui/loading/ui.loading","module","data/store/common/c.app.store","ui/promptpop/ui.promptpop","data/store/c.common.store","dojo/parser","dojo/topic","dijit/registry","dojo/aspect","dojo/dom","cutil/c.util.kai","dojo/promise/all","3rdlibs/vue-1.0.0"],function(kaiViewTopics,Tip,dijitHelper,on,lang,loading,module,_stores,promptpop,CommonStore,_parser,topic,_registry,aspect,dom,cUtilKai,all,Vue){var StackStore=CommonStore.StackStore.getInstance(),UserStore=CommonStore.UserStore.getInstance(),indexLevelTabChangeRequireTopic=kaiViewTopics.indexLevelTabChangeRequire.getInstance(),indexLevelTabCloseRequireTopic=kaiViewTopics.indexLevelTabCloseRequire.getInstance(),colorArray=["SpringGreen","Tan","Teal","Thistle","Tomato","Turquoise","Violet","VioletRed"],parser={},registry={},PageView=Backbone.View.extend({scrollPos:{x:0,y:0},header:null,pageid:0,hpageid:0,scrollZero:!0,triggerShow:!0,triggerCreate:!0,triggerHide:!0,events:{"click [data-viewname]":"initSubView"},UserStore:UserStore,debugData:null,els:{},templateFunctions:null,initialize:function(e){var t=this;!e.fsm,t.fsm=e.fsm,t.parser={},t.registry={},t.viewData={},t.ubtData={},t.debugData={},t.templateFunctions=[],t.parser.parse=t.parserMethodFactory.getInstance(t),t.registry.byId=t.registryMethodFactory.getInstance(t),t.registry.byNode=_registry.byNode,t.fsm.can("startInitializing")&&t.fsm.startInitializing(),this.id=this.$el.attr("id"),this.viewName=e.viewName,this.templateString=e.templateString,this.needReplaceTemplate=e.needReplaceTemplate,this.parsed=e.parsed,this.isEmbeded=e.isEmbeded,this.isViewDataAsync=e.isViewDataAsync,t.logColor=e.logColor,t.childViewItems=e.childViewItems,t.childViewNames=_.pluck(t.childViewItems,"id"),t.viewItem=e.viewItem,t.parentViewItem=e.parentViewItem,t.parentView=e.parentViewItem.id,t.parentViewName=e.parentViewItem.id,t.isPreheat=e.isPreheat,t.isNeedReparse=e.isNeedReparse||!0,t.siblingViewNames=e.siblingViewNames,t.parentViewInstance=t.getParentViewInstance(),t.parentStore=t.getParentStore(),t.parentModel=t.getParentViewModel(),t.viewStateModel=Kai.viewStates.get(t.viewName),t.contextPostfix=t.getContextPostfix(),t.modelObj=e.modelObj,t.parentViewInstance&&(t.parentRegistry=t.parentViewInstance.registry),t.setGrandReistry(),t.setSelfWidget(),t.setParentWidget(),t.$elWidget&&t.$elWidget.set("content",t.templateString);var i=Backbone.Model.extend({}),n=Backbone.Model.extend({defauts:{viewDataParsed:!1},initialize:function(){this.on("change:viewDataParsed",function(){this.get("viewDataParsed")&&t.dojoParse()})}}),i=new i,a=new n;this.model=i,this._sysModel=a,_stores["K_view_"+this.viewName]=_stores.CustomStore("K_view_"+this.viewName,Kai.appStoreLifeTime||"1D"),_stores["K_view_memory_"+this.viewName]=_stores.CustomStore("K_view_memory_"+this.viewName,Kai.appStoreLifeTime||"1D"),this.store=_stores["K_view_"+this.viewName].getInstance(),this.memoryStore=_stores["K_view_memory_"+this.viewName].getInstance(),this.store.remove(),this.initTracker(),t.fsm.finishInitializing(),t.sendViewLifecyle("create"),t.preheat(e)},initTracker:function(){var e=this;return"undefined"==typeof alog?!1:void alog("define",e.getContextPostfix(),function(){var t=alog.tracker(e.viewName);return t})},setSelfWidget:function(){var e=this;e.parentRegistry&&(e.$elWidget=e.parentRegistry.byId(e.viewName)),e.$elWidget||(e.$elWidget=e.registry.byId(e.viewName)),e.$elWidget||(e.$elWidget=_registry.byId(e.viewName)||_registry.byNode(e.$el[0]))},_createHeader:function(){var e=this,t=$("#headerview");this.showHeader?(t.find(".page_title").html(this.title),e.isLogin()&&Kai.loginUrl!==e.viewName?t.find(".cm-header-logout,.mobile_back").show():t.find(".cm-header-logout,.mobile_back").hide(),$(".main-viewport").addClass("mt-70"),t.show()):(t.hide(),$(".main-viewport.mt-70").removeClass("mt-70"))},generateEls:function(e){var t,i=this;i.mapElS||(!i.elsGenerated||e)&&(e||(i.els=lang.clone(i.els)),t=e||i.els,i.refCache=i.refCache||{},_.each(t,function(e,n){var a=t[n];delete i.els[n],Object.defineProperty(i.els,n,{configurable:!0,get:function(){var e=i.refCache||(i.refCache={}),t=e[n],r=a.type,s=function(){var e;if(_.isFunction(a.selector))e=$.proxy(a.selector,i)();else{if(!_.isString(a.selector))return null;e=a.selector}return"jquery"===r?i.$el.find(e):"dom"===r||"DOM"===r?i.$el.find(e)[0]:$.proxy(i.registry.byId,i)(e)};return a.forceCreate?s():((!t||t instanceof jQuery&&!t.length)&&(e[n]=t=s(),t&&!a.type&&aspect.before(t,"destroy",function(){e[n]=null})),t)}})}),Object.defineProperty(i.els,"parent",{configurable:!0,get:function(){return i.getParentViewInstance()}}),i.elsGenerated=!0)},preheat:function(e){var t=this,e=e||{};return t.fsm&&t.fsm.can("startPreheating")?(t.fsm.startPreheating(),this.needReplaceTemplate&&(t.$el.html($(t.templateString)),t.parseTempate(),t.$el.addClass("visibility-hidden")),this.generateEls(),this.mapELS&&this.mapELS(),t.prepareEvents&&t.prepareEvents(),t.prepareViewUtils&&t.prepareViewUtils(),t.prepareDataHelper&&t.prepareDataHelper(),t.delegateViewUtils(),t.delegateDataHelper(),t.bindDataHelerViewContext(),t._listenToModel(),t.createElementCollection(),this._init(),this.init&&this.init(),t.triggerCreateCheck&&t.triggerCreateCheck(),this.triggerCreate?(this.onCreate&&this.onCreate(),t.fsm.finishPreheating(),e.isPreheat?!1:void this.show()):(t.hideLoading(),!1)):!1},bindDataHelerViewContext:function(){var e=this;return _.isObject(e.dataHelper)?(_.isObject(e.dataHelper.dataFetcher)&&_.each(_.functions(e.dataHelper.dataFetcher),function(t){e.dataHelper.dataFetcher[t]=_.bind(e.dataHelper.dataFetcher[t],e)}),void(_.isObject(e.dataHelper.dataPoster)&&_.each(_.functions(e.dataHelper.dataPoster),function(t){e.dataHelper.dataPoster[t]=_.bind(e.dataHelper.dataPoster[t],e)}))):!1},bindViewUtilsContext:function(){var e=this;return _.isObject(e.viewUtils)?void _.each(_.functions(e.viewUtils),function(t){e.viewUtils[t]=$.proxy(e.viewUtils[t],e)}):!1},_listenToModel:function(){var e=this;if(!_.isObject(e.viewUtils))return!1;var t={};_.each(_.functions(e.viewUtils),function(i){t[i]=e.viewUtils[i]}),e.model.on(t,e)},renderData:function(){var e=this;e.prepareDataUtil&&e.prepareDataUtil(),e.dataUtil&&(e.dataHelper=e.dataUtil),e.prepareDataHelper&&e.prepareDataHelper(),e.isViewDataAsync?e.asyncRender():(this._prepareViewData(),e.dataHelper&&e.dataHelper.prepareViewData?$.proxy(e.dataHelper.prepareViewData,e)():this.prepareViewData(),this.parse(this.viewData),this.onRender&&this.onRender(),e.dojoParse())},asyncRender:function(){var e=this;return e.fsm.can("startAsyncRendering")?(e.fsm.startAsyncRendering(),this._prepareViewData(),void(e.dataHelper&&e.dataHelper.prepareViewData?$.proxy(e.dataHelper.prepareViewData,e)():this.prepareViewData())):!1},_onHide:function(){Kai.hideConfirm()},destroy:function(e){var t=this;t.sendViewLifecyle("destroy"),t.showLoading();try{t.destroyDijitWidget(e)}catch(i){}t.destroyDialogs&&t.destroyDialogs(),Kai.viewStates.get(t.viewName).set("current",null),t._onHide&&t._onHide(),t.onHide&&t.onHide(),t.$el&&t.$el.remove(),t.model&&(t.model.off(),t.model.clear(),t.model.destroy()),t.vm&&t.vm.$destroy(),t.abortRequets&&t.abortRequets(),t._sysModel.destroy(),t.store&&t.store.remove(),t.templateFunctions=[],t.viewData={},Kai.views.remove([t.viewName]),t.remove(),t.destroySubViews(),t.fsm&&t.fsm.destroy(),t.fsm=null,t.unsubscribeTopics&&t.unsubscribeTopics(),t.unsubscribe(),t.onDestroy&&t.onDestroy(),t.hideLoading(),t.els=null,t.widgetsEls=null;for(var n in t)t[n]=null,delete t[n];t=null},_preShow:function(){},triggerShowCheck:function(){var e,t=this,i=t.model.get("viewConfigData")||{},n="id";_.isString(i.idProperty)?(n=i.idProperty,e=i[n]):e=i.id;var a=i._readonly,r=t.parentModel.get(t.viewName)||t.parentStore.get(t.viewName)||{},s=t.modelObj||r||{};return s._forceReShow?(t.triggerShow=!0,!0):!_.isObject(s)||_.isEmpty(s)?t.constructor.prototype.hasOwnProperty("onVisible")?(t.triggerShow=!1,t.onVisible&&t.onVisible(),t.initSubViews({isVisibleOnly:!0}),!1):(t.triggerShow=!0,!0):s&&s[n]==e&&s._readonly==a?t.constructor.prototype.hasOwnProperty("onVisible")?(t.triggerShow=!1,t.onVisible&&t.onVisible(),t.initSubViews({isVisibleOnly:!0}),!1):(t.triggerShow=!0,!0):(t.reload(),!0)},onVisible:function(){},show:function(e){var t=this,i=t.getParentViewModel();return t.fsm.can("startShowing")?(this.triggerShow=!0,t.isFirstLoad||this.triggerShowCheck(),this.triggerShow?(i&&i.get("readonly")&&t.model.set("readonly",i.get("readonly")),t.fsm.can("startShowing")?(t.fsm.startShowing(),t.fsm.finishShowing(),void(t.isNeedReparse?t.renderData():t.startup())):!1):(t.sendViewLifecyle("show"),!1)):!1},destroyDijitWidgetByNode:function(e,t){for(var t=t||{},i=$(e).find("[widgetid]"),n=i.length-1;n>=0;n--){var a=_registry.byNode(i[n]);a&&a.destroyRecursive()}if(t.keepContainer);else if(e.remove)e.remove();else try{e.removeNode(!0)}catch(r){}},destroyDijitWidget:function(e){var t=this,e=e||{};if(!t.registry)return!1;var i=t.registry.byId(t.viewName)||t.parentRegistry&&t.parentRegistry.byId(t.viewName)||_registry.byId(t.viewName),n=e.dialogIds||t.dialogIds,a=i&&i.getChildren();_.each(a,function(e){e.destroyRecursive()});for(var r=t.$el.find("[widgetid]"),s=r.length-1;s>=0;s--){var o=_registry.byNode(r[s]);o&&o.destroyRecursive()}_.each(n,function(e){t.registry.byId(e)&&t.registry.byId(e).destroyRecursive()});try{i&&i.uninitialize()&&i.destroyRendering()}catch(d){}},reload:function(e){var t=this,e=e||{};t.showLoading(),t.onHide&&t.onHide(),_.isObject(t.model)&&t.model.stopListening(),t.store&&t.store.remove(),t.model&&t.model.off(),t.vm&&t.vm.$destroy(),t.model&&t.model.clear(),t.fsm&&t.fsm.reload(),t.isReload=!0,t.needReplaceTemplate=!0,t.templateFunctions=[],t.destroyDijitWidget(e);try{t.destroySubViews()}catch(i){}t.unsubscribeTopics&&t.unsubscribeTopics(),t.unsubscribe(),t.destroyGrids(),t.onReload&&t.onReload(),e.modelObj&&(t.modelObj=e.modelObj),t.preheat(),t.hideLoading()},destroyGrids:function(){var e=this;e.grid&&(e.grid&&e.grid.destroy(),e.grid=null)},startup:function(){var e=this,t=CommonStore.StackStore.getInstance();e.fsm&&e.fsm.startStartuping(),e.log(e.viewName+" begin startup"),e.isFirstLoad&&e.showLoading(),e.isEmbeded||$("[data-subview_port_id^=sub_viewport_]").not(this.$el).hide(),e.pinTitle(),e.isFirstLoad||(this.reInit(),this.log(e.viewName+" is reInited",{})),this.preShow&&this.preShow(),document.activeElement,this._createHeader(),this.switchByOut||this.$el.show(),t.setAttr("lastView",this.viewName),t.setAttr("currentView",this.viewName),this.$el.show(),this.refCache={},e.createTemplateFunctions&&e.createTemplateFunctions(),this.mapELS&&this.mapELS(),this.log(e.viewName+" finished mapELS"),this.reloadFromStore(),this.sendMDTrack();try{this.triggerShow&&this.onShow&&(this.onShow&&this.onShow(),e.sendViewLifecyle("show"))}catch(i){e.hideLoading()}this.updateELS(),this.log(e.viewName+" finished updateELS"),this.updateView(),this.log(e.viewName+" finished updateView");try{e.isFirstLoad&&(e.event?e.enableEvents():(e.bindEvents(),e.subscribeTopics()),e.log(e.viewName+" events prepared"))}catch(i){e.hideLoading()}e.isFirstLoad&&this.hideLoading(),e.$el.removeClass("visibility-hidden"),Kai.isH5&&this.beautifyView(),this.afterShow&&(this.afterShowDefer=this.afterShow()),this.onBottomPull&&(this._onWidnowScroll=$.proxy(this.onWidnowScroll,this),this.addScrollListener()),this.scrollZero&&window.scrollTo(0,0),this.triggerShow=!0,this.triggerHide=!0,this.addScrollListener&&this.addScrollListener(),this.afterShowDefer&&this.afterShowDefer.then?this.afterShowDefer.then(function(){e.initSubViews({isReload:e.isReload})},function(){}):_.defer(function(){e.initSubViews({isReload:e.isReload})}),topic.publish(e.viewName,{startuped:!0}),e.resizeParentView(),e.fsm&&e.fsm.finishStartuping(),this.log(e.viewName+" finished loading"),e._onLoaded()},_onLoaded:function(){var e=this;e.isFirstLoad=!1,_.isArray(e.onLoadCallbacks)&&!_.isEmpty(e.onLoadCallbacks)&&(_.each(e.onLoadCallbacks,function(t){$.proxy(t,e)()}),e.onLoadCallbacks.length=0),e.$el.data("viewstate",e.fsm.current),e.$el.addClass("viewLoaded"),e.$el.addClass(e.getViewContextPostfix(e.viewName)),topic.publish(e.viewName,{loaded:!0}),Kai.viewStates.get(e.viewName).set("current","loaded"),Kai.viewStates.get(e.viewName).unset("current",{silent:!0}),e.registry.byId(e.viewName)&&e.registry.byId(e.viewName).resize&&e.registry.byId(e.viewName).resize();var t=e.getParentViewInstance()&&e.getParentViewInstance().registry;t&&t.byId(e.viewName)&&t.byId(e.viewName).resize&&t.byId(e.viewName).resize();var i=e.model.get("viewConfigData")||{};!_.isObject(i)||1!=i._readonly&&1!=i.readonly||e.setReadonly({selfIncluded:!0}),e.onLoaded&&e.onLoaded()},hide:function(){var e=this;this.triggerHide&&this.onHide&&($("#pop-success").remove(),$("#pop_prompt").remove(),this.onHide(),this._onHide(),e.log(e.viewName+" is hidden")),this.removeScrollListener&&this.removeScrollListener(),this.isConfirmShown&&this.hideConfirm()},onAppear:function(e){this.log("onAppear --------------")},onAppearHandler:function(e){clearTimeout(this.__appeartimeout),e&&e.callbackString&&this.sendUbt(),this.onAppear(e)},jump:function(e){_.isString(e)?window.location.href=e:Kai.jump(e)},cross:function(e,t){Kai.jump(e,t)},forward:function(e,t){Kai.forward.apply(null,arguments)},back:function(e,t){Kai.back.apply(null,arguments),$(window).off("scroll")},refresh:function(){var e=location.href.indexOf("#"),t=location.href.substring(0,e);window.location.href=t},getAppUrl:function(){return""},saveScrollPos:function(){this.scrollPos={x:window.scrollX,y:window.scrollY}},restoreScrollPos:function(){window.scrollTo(this.scrollPos.x,this.scrollPos.y)},showMessage:function(e){e||(e={}),"string"==typeof e&&(e={datamodel:{content:e}}),this._alert.resetDefaultProperty(),this._alert.setOption(e),this._alert.refresh(),this._alert.show()},hideMessage:function(){this._alert.hide()},showConfirm:function(e){e||(e={}),"string"==typeof e&&(e={datamodel:{content:e}}),this._confirm.resetDefaultProperty(),this._confirm.datamodel.btns=[{name:"取消",className:"cui-btns-cancel"},{name:"确定",className:"cui-btns-ok"}],this._confirm.setOption(e),this._confirm.refresh(),this._confirm.show()},hideConfirm:function(){this._confirm.hide()},showWarning404:function(e){Kai.showWarning404(e)},hideWarning404:function(){Kai.hideWarning404()},showErrorTip:function(e){var t=this;t.tipInstance?(t.tipInstance.setOption({datamodel:{data:e},wrapper:t.$el}),t.tipInstance.refresh()):t.tipInstance=new Tip({datamodel:{data:e}}),t.tipInstance.show()},showToast:function(e){var t=this;t.hideLoading();var i=e.text,n=e.stateStyle,a=e.closeTime||1e3,r=e.callback||_.noop,s=new promptpop({});s.display({text:""+i,textClass:"popTextColor",closeTime:a,callback:r,stateStyle:n})},hideToast:function(){Kai.hideToast()},showLog:function(e){Kai.showLog(e),this.isLoadingShown=!0,this.__isLoading__=!0},showLoading:function(e){var t=this;Kai.showLoading(_.extend({view:t},e)),this.isLoadingShown=!0,this.__isLoading__=!0},hideLoading:function(e){var t=this;Kai.hideLoading(),Kai.hideLoading(t),this.isLoadingShown=!1,this.__isLoading__=!1},setTitle:function(e){document.title=e},sendUbt:function(e,t,i){Kai.sendUbt(e,t,i)},template:function(){_.template(this.templateString)},render:function(){return this},attributes:{},showBottomLoading:function(){this.bottomLoading||(this.bottomLoading=$('<div class="cui-zl-load" id="zlLoading"> <div class="cui-i cui-b-loading"></div><div class="cui-i  cui-mb-logo"></div> <p>加载中</p></div>'),this.els.listcontainer.append(this.bottomLoading)),this.bottomLoading.show()},hideBottomLoading:function(){this.bottomLoading&&(this.els.listcontainer.find("#zlLoading").remove(),this.bottomLoading=null)},setPageId:function(e){var t=this.viewname;e&&(t=e);var i;t&&(i=pageIdConfig[t])&&(this.pageid=i[0],this.hpageid=i[1])},pinTitle:function(e){if("string"==typeof e)document.title=e;else{var t=this.title||this.getTitle();t&&_.isString(t)&&(document.title=t)}if(Kai.isH5){var i=$('<iframe src="./app/'+Kai.projectName+'/favicon.ico" style="display:none"></iframe>');i.on("load",function(){setTimeout(function(){i.off("load").remove()},0)}).appendTo($("body"))}},reparse:function(e,t){var i=this,e=e||i.viewData;if(!_.object(e))throw new Error("viewData is not valid");if(t&&t.templateFunctionId){var n=_.findWhere(i.templateFunctions,{templateFunctionId:t.templateFunctionId});i._parse(n,e,t)}else i.fsm&&i.fsm.startParsing(),_.each(i.templateFunctions,function(n,a,r){try{n.avoidReparse||i._parse(n,e,t)}catch(s){i.log(s)}}),i.fsm&&i.fsm.finishParsing(),i.fsm&&i.fsm.startDojoParsing(),i.fsm&&i.fsm.finishDojoParsing(),i.fsm&&i.startup(),i.log(i.viewName+" page is reParsed")},requireDojoParse:function(){var e=this;_.defer(function(){e.log(e.viewName+" is viewDataParsed and turned on"),e._sysModel&&e._sysModel.unset("viewDataParsed",{silent:!0}),e._sysModel&&e._sysModel.set("viewDataParsed",!0)})},getSystemLevelViewData:function(){var e=this;return{__viewName:e.viewName}},_parse:function(e,t,i){var n=this,t=t||{},i=i||{};if(!n.$el)return!1;if("function"==typeof e||_.isString(e)){var e=_.isString(e)?_.findWhere(n.templateFunctions,{templateFunctionId:e}):e;_.extend(t,n.getSystemLevelViewData());var a=e(t),r=$(a);if(e.k_widgetid){var s=e.k_widgetid,o=$('[k_widgetid="'+s+'"]');if(o&&o.length>0){var d=o.first(),l=$("<script class= "+s+"></script>").insertBefore(d);_.isString(e.dojoId)&&(n.registry.byId(e.dojoId)&&n.registry.byId(e.dojoId).destroyRecursive(),i.needDojoParse=!0),e.widgetInTemplate&&(_.each(o,function(e){n.destroyDijitWidgetByNode(e,{keepContainer:!0})}),i.needDojoParse=!0);var r=$(a);if(r.attr("k_widgetid",s),i.keepOld||(e.$container||e.$el&&e.$el.length>0?(e.$container||e.$el).empty():o.remove()),i.parentDomNode||e.$container&&e.$container.length>0||e.$el&&e.$el.length>0?(i&&1==i.clear&&(e.$container||e.$el).empty(),(i.parentDomNode||e.$container||e.$el).append(r)):(l.replaceWith(r),r.hasClass("widget_container")&&r.children().show()),l&&l.remove(),i&&i.needDojoParse){var c=$('[k_widgetid="'+s+'"]');_.each(c,function(e){if(!e||$(e).parent('[k_widgetid="'+s+'"]').length>0)return!1;var t=n.parser.parse(e);t&&t.then(i.callback)})}i&&i.clear,e.eventBinder&&n.elementCollection.add({eventBinder:e.eventBinder}),e.initialized=!0}}else if(e.$el&&!e.k_widgetid||!e.initialized){if(e.$el&&(_.isElement(e.$el)||_.isArray(e.$el))||_.isString(e.$el)&&(e.$el=n.$el.find(e.$el)),e.$el&&!i.keepOld?(e.$el.empty(),e.$el.append(r)):e.$el.append(r),e.dojoId&&(n.registry.byId(e.dojoId)&&n.registry.byId(e.dojoId).destroyRecursive(),n.parser.parse(r[0]).then(i&&i.callback)),e.widgetInTemplate,e.k_widgetid);else{n.templateFunctions=n.templateFunctions||[];var u=_.uniqueId((new Date).valueOf());r.attr("k_widgetid",u),e.k_widgetid=u,e.initialized=!0,n.templateFunctions.push(e)}e.eventBinder&&n.elementCollection.add({eventBinder:e.eventBinder}),e.initialized=!0}}else if("object"==typeof e||_.isObject(n.viewData)){var t=e||n.viewData;_.extend(t,n.getSystemLevelViewData()),n.fsm&&n.fsm.startParsing(),this.$el.find(".kai_widget,.k_widget").each(function(e,i){!function(e){var e=e,i=_.template($(e).html()),a=_.uniqueId((new Date).valueOf());if(i.dojoId=$(e).data("dojo-id"),i.widgetInTemplate=$(e).data("widgetintemplate"),i.templateFunctionId=$(e).data("templatefunctionid"),i.parseOnLoad=$(e).data("parseonload"),i.avoidReparse=$(e).data("avoidreparse"),i.avoidDojoReparse=$(e).data("dojo-avoidreparse"),i.k_widgetid=a,i.eventBinder=$(e).data("eventbinder"),i.$el=$(e).data("parent-domselector"),_.isObject(n.$el)&&n.$el.find(i.$el).length>0?i.$el=n.$el.find(i.$el):i.$el=$(i.$el),n.templateFunctions.push(i),n.templateFunctions[i.k_widgetid]=i,i.parseOnLoad===!1){if(i.initialized=!0,i.$el&&i.$el.length>0)i.$el.attr("k_widgetid",a);else{$("<script k_widgetid="+a+"></script>").insertBefore($(e))}$(e).remove()}else{var r=i(t),s=$(r);if(s.attr("k_widgetid",a),s.show(),0==s.length){$("<script k_widgetid="+a+"></script>").insertBefore($(e));$(e).remove()}else $(e).replaceWith(s);i.initialized=!0,i.eventBinder&&n.elementCollection.add({eventBinder:i.eventBinder,silent:!0},{silent:!0})}}(i)}),n.fsm&&n.fsm.finishParsing(),n.requireDojoParse()}},getTrackConfig:function(){var e=this,t=module.config();if(_.isObject(t)){var i=t.pageConfig.trackConfig;return _.isObject(i)?i[e.viewName]:null}return""},getTitle:function(){var e=this,t="",i=module.config();if(_.isObject(i)){var n=i.pageConfig.pageNameConfig[e.viewName];_.isFunction(n)&&(n=n()),t=n||""}return t=t||e.viewItem.viewTitle||"",this.title=t,t},createTemplateFunctions:function(e){_.noop},_init:function(e){var t=this;t.parsed=!1,t.isFirstLoad=!0,t.templateFunctions=[],t.onLoadCallbacks=[],t.event&&t.event.eventHandler&&_.each(_.functions(t.event.eventHandler),function(e){t.event.eventHandler[e]=_.bind(t.event.eventHandler[e],t)}),t.listenToModel()},init:function(e){},bindEvents:function(e){},beautifyView:function(e){var t=this;require(["ui/inputclear/ui.inputclear"],function(i){_.isObject(e)&&e.container?i($(e.container).find("input").not(".no_inputclear"),null,null,{}):i(t.$el.find("input").not(".no_inputclear"),null,null,{})})},updateView:function(){_.noop},preShow:function(){_.noop},_mapELS:function(){_.noop},reloadFromStore:function(){var e=this,t=e.store.get();_.isObject(t)&&!_.isEmpty(t.memory)&&e.mapValues(t.memory)},_prepareViewData:function(){var e=this,t=e.parentModel.get(e.viewName),i=e.modelObj||t||{};_.isObject(i)&&(e.model.set("viewConfigData",i||{}),e.parentModel.unset(e.viewName))},prepareViewData:function(){var e=this;try{e.turnOn()}catch(t){}},prepareEvents:function(){},createElementCollection:function(){var e=this,t=Backbone.Model.extend({defaults:{selector:"",type:"",eventBinder:"",element:null,silent:!1}}),i=Backbone.Collection.extend({model:t}),n=new i;e.elementCollection=n,n.on("add",function(t){e.event.eventBinder[t.get("eventBinder")].call(e)})},enableEvents:function(e){var t=this;if(e){var i=t.elementCollection.findWhere({element:e});i&&t.event.eventBinder[i.get("eventBinder")].call(t)}else{_.functions(t.event.eventBinder);t.event.els&&t.generateEls(t.event.els),t.event.eventBinder&&t.event.eventBinder.bindEvents&&$.proxy(t.event.eventBinder.bindEvents,t)(),t.event.eventBinder&&t.event.eventBinder.subscribeTopics&&$.proxy(t.event.eventBinder.subscribeTopics,t)(),_.each(t.elementCollection.models,function(e){e.get("silent")&&"manual"!=e.get("enableMode")&&_.isFunction(t.event.eventBinder[e.get("eventBinder")])&&t.event.eventBinder[e.get("eventBinder")].call(t)})}},updateELS:function(){var e=this;_.extend(e.els,{}),e.mapELS&&e.mapELS()},assert:function(){},dojoParse:function(){var e=this;return e.fsm.can("startDojoParsing")?(e.fsm&&e.fsm.startDojoParsing(),void(e.parsed?(e.fsm&&e.fsm.finishDojoParsing(),e.startup()):e.parser.parse(e.$el[0]).then(function(){e.parsed=!0,topic.publish(e.viewName,{dojoParsed:!0}),e._sysModel.set("dojoParsed",!0),e.log(e.viewName+" is dojo parsed"),e.fsm.finishDojoParsing(),e.startup()},function(t){e.fsm.finishDojoParsing(),e.startup()}))):!1},setGrandReistry:function(){var e=this;e.grandRegistry=e.getGrandViewInstance()&&e.getGrandViewInstance().registry},setParentWidget:function(){var e,t=this,i=t.parentViewItem;t.grandRegistry&&(e=t.grandRegistry.byId(i.id)),e||(e=t.parentRegistry&&t.parentRegistry.byId(i.id)),e||(e=_registry.byId(i.id)),t.parentDijitWidget=e},resizeParentView:function(){var e=this,t=e.parentViewItem;if(t&&t.id&&!t.inaccessible){var i=e.getGrandViewInstance()&&e.getGrandViewInstance().registry;if(!i)return!1;if(e.parentDijitWidget&&e.parentDijitWidget.resize)try{e.parentDijitWidget&&e.parentDijitWidget.resize()}catch(n){}}},getGrandViewName:function(){var e=this,t=e.getParentViewInstance();return e.grandViewName=t&&t.parentViewName,e.grandViewName},getGrandViewInstance:function(){var e=this;return e.grandViewName||(e.grandViewName=e.getGrandViewName()),Kai.views.get(e.grandViewName)&&Kai.views.get(e.grandViewName).get("viewInstance")},getParentViewName:function(){var e=this,t=e.getParentViewInstance();return t&&t.viewName},getGrandViewModel:function(){var e=this,t=e.getGrandViewInstance();return e.grandViewModel=t&&t.model,e.grandViewModel},getParentViewInstance:function(){var e=this;return Kai.views.get(e.parentViewName)&&Kai.views.get(e.parentViewName).get("viewInstance")},getSiblingViewInstance:function(e){var t=this,i=Kai.views.get(t.parentViewName+"/"+e);return i&&i.get("viewInstance")},getSiblingViewInstances:function(e){var t=this;return Kai.views.get(t.parentViewName)&&Kai.views.get(t.parentViewName).get("viewInstance")},getParentViewModel:function(){var e=this,t=e.getParentViewInstance(),i=function(){var e=Backbone.Model.extend({});return new e};return t?(e.parentViewModel=t&&t.model,e.parentViewModel):_.isObject(Kai._fakeParentViewModels)?Kai._fakeParentViewModels[e.parentViewName]?Kai._fakeParentViewModels[e.parentViewName]:Kai._fakeParentViewModels[e.parentViewName]=i():(Kai._fakeParentViewModels={},Kai._fakeParentViewModels[e.parentViewName]=i())},getParentStore:function(){var e=this,t=e.viewItem.parent,i=e.getParentViewInstance();return _.isObject(i)?i.store:(_stores["K_view_"+t]=_stores.CustomStore("K_view_"+t,Kai.appStoreLifeTime||"1D"),this.parentStore=_stores["K_view_"+t].getInstance(),this.parentStore)},getGrandStore:function(){var e=this,t=e.getGrandViewInstance();return _.isObject(t)?t.store:null},getChildViewWidget:function(e){},getChildViewInstance:function(e){var t=this,i=null;return i=e.indexOf(t.viewName)<0?Kai.views.get(t.viewName+"/"+e):Kai.views.get(e),_.isObject(i)?i.get("viewInstance")||null:!1},initSubViews:function(e){var e=e||{};_.each(this.childViewItems,function(t){if(!t.inaccessible&&t.isDefault)if(e.isVisibleOnly){var i=Kai.views.get(t.id).get("viewInstance");if(_.isObject(i)&&_.isFunction(i.constructor.prototype.hasOwnProperty("onVisible")))try{i.onVisible(),i.initSubViews({isVisibleOnly:!0})}catch(n){}}else _.defer(function(){try{Kai.forward(t.id,{keepURL:!0,isSubViewInitialize:!0,isReload:e.isReload||!1})}catch(i){}})})},destroySubViews:function(){_.each(this.childViewItems,function(e){var t=Kai.views.get({viewName:e.id});if(_.isObject(t)){var i=t.get("viewInstance");i&&i.destroy()}})},_reInit:function(){var e=this;e._sysModel.set("_reInited",!0)},reInit:function(){var e=this;e._sysModel.set("reInited",!0)},turnOn:function(){var e=this;e.fsm&&e.fsm.finishAsyncRendering&&e.fsm.finishAsyncRendering(),e.isFirstLoad?(e._parse(),e.initVue()):e.reparse(e.viewData,{needDojoParse:!0,clear:!0,lifecycle:!0})},dojoMapValues:function(e){var t=this;_.each(e,function(e,i){_.isString(e)&&t.registry.byId(i).setValue(e)})},mapValues:function(e,t){var i=this;_.each(e,function(e,n){t||i.$el.find("#"+n).val(e)})},log:function(e){},subscribeTopics:function(e){},listenToModel:function(){},getQueryObj:function(){return cUtilKai.getQueryObj()},getIndexURL:function(){return cUtilKai.getIndexURL()},restart:function(){return cUtilKai.restart()},replaceViewHash:function(){return cUtilKai.replaceViewHash()},bind:function(e){var t=this;return $.proxy(cUtilKai.bind,t)(e)},isSucceedResponse:function(e){return e instanceof Error?!1:e&&e[Kai.responseStatusKey]&&"000000"==e[Kai.responseStatusKey].code},showResponseError:function(e,t,i){var n=this,a=function(){n.showToast({text:"登录超时，请重新登录",callback:function(){Kai.forward(Kai.loginUrl,{keepURL:!1})},closeTime:i||2500})};if(e&&_.isObject(e[Kai.responseStatusKey])){if(Kai.errorCodes&&_.isArray(Kai.errorCodes.sessionTimeout)&&_.contains(Kai.errorCodes.sessionTimeout,e[Kai.responseStatusKey].code))return a(),!1;if("400004"==e[Kai.responseStatusKey].code)return a(),!1;e&&_.isObject(e[Kai.responseStatusKey])&&e[Kai.responseStatusKey].msg&&"000000"!==e[Kai.responseStatusKey].code&&n.showToast({text:e[Kai.responseStatusKey].msg,callback:t,closeTime:i||2e3})}else _.isObject(e)&&e.msg?n.showToast({text:e.msg,callback:t,closeTime:i||2e3}):_.isObject(e)&&0==e.status?e.statusText&&n.showToast({text:e.statusText}):_.isObject(e)&&_.isString(e.text)?n.showToast({text:e.text,callback:t}):n.showToast({text:"网络错误，请重试",callback:t})},isLogin:function(){var e=CommonStore.UserStore.getInstance();e.get();return this.debugData.isDebug?this.debugData.isLogin:Kai.isLogin()?!0:!1},showErrorPage:function(e){Kai.isH5||Kai.forward(Kai.errorUrl)},showLostPage:function(e){Kai.isH5||Kai.forward(Kai.lostUrl)},setUserStore:function(e){var t=CommonStore.HeadStore.getInstance(),i=CommonStore.UserStore.getInstance(),n=e.ssoToken||e.accessToken,a=e.userName||"",r=e.verify||"",s=e.phone||"",o=e.nickName||"";i.setAttr(_.extend(e,{auth:n,Auth:n,UserName:a,phone:s,verify:r,nickName:o,callSystem:e.callSystem})),t.setAttr("auth",e.auth),t.setAttr("grayTestCode",Kai.getQuery().graytestcode),i.setAttr(e)},subscribe:function(e,t){var i=this;e.subscribe(i,t),i._topicArray=i.topicArray||[],i._topicArray.push(e)},unsubscribe:function(e){var t=this;e||_.isArray(t._topicArray)&&t.unsubscribe(t._topicArray),_.isArray(e)?_.each(e,function(e){e.unsubscribe(t.viewName)}):e&&e.unsubscribe(t.viewName)},publish:function(e){var t=this;return e?void(_.isArray(e)?_.each(e,function(i){i.set("source",t.viewName),i.set("sourceParentViewName",t.parentViewName),e.publish()}):(e.set("source",t.viewName),e.set("sourceParentViewName",t.parentViewName),e.publish())):!1},getViewContextPostfix:function(e){var t=this;return t.viewItem?(t.viewItem.postfix=t.viewItem.postfix||"",_.isString(e)?"___"+e.replace(/\//g,"-"):t.viewContextPostfix?t.viewContextPostfix:t.viewItem?(t.viewContextPostfix="___"+t.viewItem.postfix.replace(/\//g,"-"),t.viewContextPostfix):!1):!1},parserMethodFactory:{_parse:function(destNode,vueTriggeredParse){var self=this;self.widgetsEls={},self.viewContextPostfix=self.getViewContextPostfix();var isNodeIncludedInView=function(e,t){var i=$(e).data("viewname")||$(e).closest("[data-viewname]").data("viewname");return i!==t?!1:!0};return $(destNode).find("[data-dojo-type],[data-dojo-id]").each(function(index,node){var orgId=$(node).attr("id"),targetWidgetId=$(node).attr("data-dojo-id");if(orgId||targetWidgetId)orgId?($(node).attr("id",orgId+self.viewContextPostfix),self.widgetsEls[orgId]={selector:orgId}):targetWidgetId&&(orgId=targetWidgetId,$(node).attr("data-dojo-id",targetWidgetId+self.viewContextPostfix),self.widgetsEls[targetWidgetId]={selector:targetWidgetId});else{var generatedId=_.uniqueId();orgId=generatedId;var widgetId=generatedId+self.viewContextPostfix;$(node).attr("id",widgetId),self.widgetsEls[generatedId]={selector:generatedId}}var actionName=$(node).attr("data-action");if(actionName){var bindFuction=function(){var targetWidget=self.registry.byId(orgId);return!targetWidget||targetWidget.isBound?!1:(self.registry.byId(orgId).on("click",function(){var param=$(this.domNode).closest("component").data("param"),myEval=function(text){return eval("("+text+")")},paramObj=myEval("{"+param+"}"),eventArguments=Array.prototype.slice.call(arguments,0);_.isObject(paramObj)&&eventArguments.unshift(paramObj),self.viewUtils[actionName].apply(self,eventArguments)}),void(self.registry.byId(orgId).isBound=!0))};if(self.parsed){if(!isNodeIncludedInView(node,self.viewName))return!1;var parseDefer=self.parser.parse&&_parser.parse($(node).parent()[0],!0);return void(parseDefer&&parseDefer.then(bindFuction))}self.onLoadCallbacks.push(function(){bindFuction()})}}),self.els=_.extend(self.els||{},self.widgetsEls),$.proxy(self.generateEls,self)(self.widgetsEls),vueTriggeredParse?void 0:_parser.parse(destNode)},getInstance:function(e){return $.proxy(this._parse,e)}},registryMethodFactory:{_byId:function(e){var t=this;t.viewContextPostfix=t.getViewContextPostfix();var i=e+t.viewContextPostfix;return _registry.byId(i)},getByIdFn:function(){return function(e){var t=this;t.viewContextPostfix=t.getViewContextPostfix();var i=e+t.viewContextPostfix;return _registry.byId(i)}},getInstance:function(e){return $.proxy(this._byId,e)}},getContextPostfix:function(e){
var t=this;return t.getViewContextPostfix()},removeContextPostfix:function(e){return _.isString(e)?e.indexOf("__")<0?e:e.substring(0,e.indexOf("__")):void 0},parseURL:function(){},reloadSubViews:function(){_.each(this.childViewItems,function(e){e.inaccessible||e.isDefault&&Kai.forward(e.id,{keepURL:!0})})},updateShownView:function(e){var t=this;if(t.els.tabContainer){var i=t.els.tabContainer.selectedChildWidget,n=i.id;t.selectedViewId=t.removeContextPostfix(n)||"";var a=t.removeContextPostfix(t.selectedViewId);t.selectedViewId&&i.isLoaded?t.forward(a,e||{keepURL:!0}):on(i,"load",function(){t.model.set("currentChildViewName",a,{silent:!0}),Kai.forward(a,e||{keepURL:!0})})}else t.selectedViewId=""},readModelObj:function(){var e=this;_.isObject(e.modelObj)&&(e.model.set(e.modelObj),e.modelObj=null)},completeRequests:function(){var e=this;Kai.viewStates.get(e.viewName)&&Kai.viewStates.get(e.viewName).set("current","requestsCompleted")},sendViewLifecyle:function(e){var t=this;t.setUbtData(e),t.sendUbt(this,t.ubtData,{type:"VL"})},sendMDTrack:function(e){var t=this;if("undefined"==typeof Tracker||!Tracker)return!1;var i=e||t.getTrackConfig();if(_.isObject(i)){var n=new Tracker(i);n.land()}},getDijitWidget:function(){var e=this;if(!e.parentDijitWidget)return!1;var t,i=$(e.parentDijitWidget.domNode);return t=i.find('[data-viewname="'+e.viewName+'"]')[0],t||(t=$('[data-viewname="'+e.viewName+'"]')[0]),t?_registry.byNode(t):null},setClosable:function(e){var t=this;t.getDijitWidget().set("closable",e)},setReadonly:function(e){var t=this,e=e||{};_.each(t.childViewNames,function(e){var i=Kai.viewStates.get(e);t.listenTo(i,"change:current",function(i,n){if(i.get("viewName").indexOf("trial_note")>=0){var a=t.registry.byId("phone_check_dialog_note");dijitHelper.setFormReadonly(a)}if("loaded"==n){var r=t.registry.byId(e);dijitHelper.setFormReadonly(r)}})}),e.selfIncluded&&dijitHelper.setFormReadonly(t.getDijitWidget()||t.$el)},initVue:function(){var e=this,t={};e.beforeInitVue&&e.beforeInitVue(),e.getVueInitParams?_.extend(t,e.getVueInitParams(),{el:e.$el[0]}):t={el:e.$el[0],data:_.isFunction(e.getVueData)?e.getVueData()||{}:{},methods:_.isFunction(e.getVueMethods)?e.getVueMethods()||{}:{},computed:_.isFunction(e.getVueComputed)?e.getVueComputed()||{}:{}},_.extend(t.data,{viewName:e.viewName,viewContextPostfix:e.viewContextPostfix}),_.extend(t.methods,{_actionTrigger:function(t){e.viewUtils[t].apply(e,Array.prototype.slice.call(arguments,1))}}),e.vm=new Vue(t)},delegateViewUtils:function(){var e=this;e.parentViewInstance&&(e.viewUtils=lang.delegate(e.viewUtils,e.parentViewInstance.viewUtils||{}))},delegateDataHelper:function(){var e=this;e.parentViewInstance&&(e.dataHelper=lang.delegate(e.dataHelper,e.parentViewInstance.dataHelper||{}))},setUbtData:function(){_.noop},parseTempate:function(){},closeParentView:function(){var e=this;indexLevelTabCloseRequireTopic.set("data",{targetViewId:e.parentView,operateType:"remove"}),indexLevelTabCloseRequireTopic.publish()},closeView:function(){var e=this;indexLevelTabCloseRequireTopic.set("data",{targetViewId:e.viewName,operateType:"remove"}),indexLevelTabCloseRequireTopic.publish()},showWarningNodes:function(){var e=this,t=e.$el.find(".weui_icon_success_no_circle:hidden").siblings(".weui_icon_warn");t.show();var i=t.length;return i||0}});return PageView});