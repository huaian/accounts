define("xstyle/core/base",["xstyle/core/elemental","xstyle/core/expression","xstyle/core/Definition","xstyle/core/utils","put-selector/put","xstyle/core/Rule","dojo/Deferred"],function(e,n,t,r,o,u,i){function l(e,n,r){function o(n){return{selectElement:function(t){if(r.newElement&&(t=t.parentNode),n&&n.selector)for(;!g(t,n);)if(t=t.parentNode,!t)throw new Error("Rule not found");if(r.inherit)for(;!(e in t);)if(t=t.parentNode,!t)throw new Error(e?e+" not found":"Property was never defined");return t},forElement:function(t){var o=t;t=this.selectElement(t),r.newElement&&(t["_"+e+"Node"]=o);var u=r.get?r.get(t,e):t[e];return void 0===u&&n?v(e).valueOf().forRule(n):u},forRule:r.inherit&&function(e){return o(e)}}}var u=new t(function(){return o(n)});return u.define=function(n,t){return l(e||t,n,r)},u.keepCSSValue=!0,u.put=r.inherit?function(n,t){return v(e).put(n,t,e)}:function(t){return{forElement:function(o){if(n&&n.selector)for(;!g(o,n);)if(o=o.parentNode,!o)throw new Error("Rule not found");r.set?r.set(o,e,t):o[e]=t,u.invalidate({elements:[o]})}}},u}function f(t,o,u,i){return r.when(n.evaluate(t,u),function(n){n.forElement?e.addRenderer(t,function(e){i(n.forElement(e),e)}):i(n)})}function c(e,n){return{apply:function(t,r,o){f(t,o,r[0],function(r,u){r.observe(function(r){r=r?e:n;value.toString().replace(new RegExp(e+"\\([^)]+\\)","g"),r);u?u.style[o]=r:t.setStyle(o,r)})})}}}function a(e,n){var t=e.variables;if(t&&n in t)return t[n];var r=e.bases;if(r)for(var o=0;o<r.length;o++){var u=a(r[o],n);if(void 0!==u)return u}}function s(e,n){do{var t=a(e,n);if(void 0!==t)return t;e=e.parent}while(e)}function v(e){var n=y[e];return n||(n=y[e]=new t(function(){return{forRule:function(n){return s(n,e)}}}),n.put=function(e,t,r){return{forRule:function(t){function o(e){u.push(e);for(var n in e.rules)o(e.rules[n])}(t.variables||(t.variables={}))[r]=e;for(var u=[];t;)o(t),t=t.parent;n.invalidate({rules:u})}}}),n}var p,d=o("div"),m=navigator.userAgent,h=m.indexOf("WebKit")>-1?"-webkit-":m.indexOf("Firefox")>-1?"-moz-":m.indexOf("MSIE")>-1?"-ms-":m.indexOf("Opera")>-1?"-o-":"",w=new u,g=e.matchesRule;w.root=!0;var y={};return w.definitions={Math:Math,window:window,global:window,module:n.selfResolving(function(e,n){return e[0].value&&(e=e[0].value),n||require([e]),{then:function(n){var t=new i;return require([e],function(e){t.resolve(n(e))}),t.promise}}}),item:l("item",null,{inherit:!0}),pageContent:new t,content:l("content",null,{inherit:!0,newElement:function(){return this.element}}),elementProperty:l(null,null,{}),elementClass:l(null,null,{get:function(e,n){return(" "+e.className+" ").indexOf(" "+n+" ")>-1},set:function(e,n,t){this.get(e,n)!=t&&(t?e.className+=" "+n:e.className=(" "+e.className+" ").replace(" "+n+" ","").replace(/^ +| +$/g,""))}}),element:{forElement:function(e){return e},define:function(e){return{forElement:function(n){for(;!g(n,e);)if(n=n.parentNode,!n)throw new Error("Rule not found");return n}}}},event:{observe:function(e){e(p)},valueOf:function(){return p}},each:{put:function(e){return{forRule:function(n){n.each=e}}}},prefix:{put:function(e,n,t){return{forRule:function(n){return"string"==typeof d.style[h+t]?(n._setStyleFromValue(h+t,e),!0):void 0}}}},"var":{define:function(e,n){return v(n)},selfResolving:!0,apply:function(e,n){return v(r.convertCssNameToJs(n[0]))}},inline:c("inline","none"),block:c("block","none"),visible:c("visible","hidden"),"extends":{apply:function(e,n){for(var t=0;t<n.length;t++)return r.extend(e,n[t],console.error)}},set:{selfExecuting:!0,apply:function(e,n){return n[0].put(n[1].valueOf())}},get:{apply:function(e,n){return n[0]},put:function(e,t){n.evaluate(t,e).valueOf()}},toggle:{selfExecuting:!0,apply:function(e,n){return n[0].put(!n[0].valueOf())}},on:{put:function(t,o,u){return{forRule:function(o){e.on(document,e.on.selector(o.selector,u.charAt(2).toLowerCase()+u.slice(3)),function(e){p=e;try{r.when(n.evaluate(o,t).valueOf(),function(n){n&&n.forRule&&(n=n.forRule(o)),n&&n.forElement&&(n=n.forElement(e.target)),p=null},function(e){})}catch(u){}})}}}},title:{put:function(e){return{forRule:function(t){n.observe(n.evaluate(t,e),function(e){document.title=e})}}}},"@supports":{selector:function(e){function n(e){var t;if(t=e.match(/^\s*not(.*)/))return!n(t[1]);if(t=e.match(/\((.*)\)/))return n(t[1]);if(t=e.match(/([^:]*):(.*)/)){var u=r.convertCssNameToJs(t[1]),i=d.style[u]=t[2];return d.style[u]==i}if(t=e.match(/\w+\[(.*)=(.*)\]/))return o(t[0])[t[1]]==t[2];if(t=e.match(/\w+/))return r.isTagSupported(t);throw new Error("can't parse @supports string")}n(e.selector.slice(10))?e.selector="":e.disabled=!0}},"true":!0,"false":!1,"null":null},w.elementProperty=l,w});