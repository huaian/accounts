define("xstyle/core/expression",["xstyle/core/utils","xstyle/core/Definition"],function(e,n){function r(e,n){var t=n[0];return t&&e?(t=p(t),r(e.property?e.property(t):e[t],n.slice(1))):e}function t(e){return e.selfResolving=!0,e}function a(e,n,r){if(l(n,e)){var t={};return t[e]=function(t){for(var a=[],o=0,i=n.length;i>o;o++){var u=n[o];u&&"function"==typeof u[e]&&(u=u[e](t)),a[o]=u}return r(a)},t}return r(n)}function o(n,r){return{apply:function(t,o,i){for(var u=0,f=o.length;f>u;u++){var p=o[u];p.depend&&p.depend(i)}var l=function(){var r=[];if(n.selfExecuting)return n.apply(t,o,i);for(var u=0,f=o.length;f>u;u++)r[u]=o[u].valueOf();return n.selfWaiting?n.apply(t,r,i):(r.push(t),e.whenAll(r,function(e){var r=e.pop();return a("forRule",e,function(e){return a("forElement",e,function(e){return n.apply(r,e,i)})})}))};return l.reverse=function(e){return r(e,o)},l}}}function i(e){return c[e]||(c[e]=new Function("a","b","return "+e))}function u(e,n,r,t,a){function u(e){e.skipResolve=!0,e.precedence=n,e.infix=a!==!1}var f=function(e,n){var r=n[0],o=n[1];if(r&&r.put){var i=t(e,o&&o.valueOf());i!==s&&r.put(i)}else{if(!o||!o.put)throw new TypeError("Can not put");o.put(a(e,r&&r.valueOf()))}},p={apply:function(n,p,l){var s;return r=i(r),t=t&&i(t),a=a&&i(a),v[e]=s=o(r,f),u(s),s.apply(n,p,l)}};u(p),v[e]=p}function f(t,a){function i(e){for(;c<=e.precedence;){var r=g.pop(),t=v[g.pop()],a=new n;a.setCompute(t.apply(null,t.infix?[g.pop(),r]:[r],a)),b=g.length?g[g.length-1]:void 0,g.push(a),c=b&&v[b]&&v[b].precedence}}var u,p;for(a=a.join?a.slice():[a],u=0;u<a.length;u++)if(p=a[u],"string"==typeof p){var l=p.match(/"[^\"]*"|[+\-<>\|\/\?\:^*!&|]+|[\w_$\.\/-]+/g),s=[u,1];l&&s.push.apply(s,l),a.splice.apply(a,s),u+=s.length-3}var c,b,g=[],y={};for(u=0;u<a.length;u++){if(p=a[u],"("==p.operator){var h=g[g.length-1];void 0===h||v.hasOwnProperty(h)?p=f(t,p.getArgs()[0]):(g.pop(),p=function(r,a){var i,u,p=new n(function(){return e.when(r.valueOf(),function(e){var n=r.parent&&r.parent.valueOf();if(!e.selfResolving){if(!i){i=[];for(var l=0,s=a.length;s>l;l++)i[l]=f(t,a[l]);u=o(e).apply(n,i,p)}return u()}return e.apply(n,a,p).valueOf()})});return p}(h,p.getArgs()))}else if(v.hasOwnProperty(p)){var d=v[p];i(d),c=(b||d).precedence}else if(p>-1)p=+p;else if(p.isLiteralString)p=p.value;else{var w=p.split(/\s*\/\s*/),x=w[0],O=t.getDefinition(x);if("string"==typeof O||O instanceof Array)O=f(t,O);else if(void 0===O)throw new Error('Could not find reference "'+x+'"');y[x]=O,w.length>1&&(O=r(O,w.slice(1))),p=O}g.push(p)}if(i({precedence:100}),g.length>1)throw new Error("Could not reduce expression");return p=g[0],p.inputs=y,p}var p=e.convertCssNameToJs,l=e.someHasProperty,s={},c={},v={};return u("+",6,"a+b","a-b","a-b"),u("-",6,"a-b","a+b","b-a"),u("*",5,"a*b","a/b","a/b"),u("/",5,"a/b","a*b","b/a"),u("?",16,"b[a?0:1]","a===b[0]||(a===b[1]?false:deny)","[a,b]"),u(":",15,"[a,b]","a[0]?a[1]:deny","a[1]"),u("!",4,"!a","!a",!1),u("%",5,"a%b"),u(">",8,"a>b"),u(">=",8,"a>=b"),u("<",8,"a<b"),u("<=",8,"a<=b"),u("==",9,"a===b"),u("&",8,"a&&b"),u("|",8,"a||b"),{react:o,evaluate:f,selfResolving:t}});