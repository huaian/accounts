define("xstyle/core/elemental",["put-selector/put","xstyle/core/utils","dojo/on","dojo/query"],function(e,r,n){function t(e){return h[e]}function o(e){/e/.test(d.readyState||"")?e():d.addEventListener("DOMContentLoaded",e)}function l(e){for(var r=d.querySelectorAll(e.selector),n=e.name,t=0,o=r.length;o>t;t++){var l=r[t],i=l.elementalStyle,c=l.elementalSpecificities;i||(i=l.elementalStyle={},c=l.elementalSpecificities={});var a=l.renderings;a||(a=l.renderings=[],g.push(l)),a.push({name:n,rendered:i[n]==e.propertyValue,renderer:e}),i[n]=e.propertyValue}}function i(){for(var r=0;r<g.length;r++){var n=g[r],t=n.renderings,o=n.elementalStyle;delete n.renderings;for(var l=0;l<t.length;l++){var i=t[l],c=i.renderer,a=c.rendered;if(E=o[i.name]==c.propertyValue,!a&&E)try{c.render(n)}catch(u){e(n,"div.error",u.toString())}a&&!E&&c.unrender&&(c.unrender(n),t.splice(l--,1))}}g=[]}function c(e,r){for(var n=0,t=p.length;t>n;n++){var o=p[n];r&&r!=o.selector||!k(e,o.rule)||o.render(e)}}function a(e,r){S.push({rule:e,definition:r})}function u(e,r){var n={selector:e.selector,rule:e,render:r};return p.push(n),v&&l(n),i(),{remove:function(){p.splice(p.indexOf(n),1)}}}var d=document,f=1,s=!!d.addEventListener;n(d,s?"change,keydown":"focusout,keydown",function(e){if("keydown"!=e.type||13==e.keyCode)for(var r=e.target,n=0,t=S.length;t>n;n++){var o=S[n];if((" "+r.className+" ").indexOf(o.rule.selector.slice(1))>-1){var l=o.definition,i=l.valueOf();i&&i.forRule&&(i=i.forRule(o.rule)),i&&i.forElement&&(i=i.forElement(r));var c=typeof i,a="checkbox"===r.type?r.checked:r.value;"number"===c&&isFinite(a)&&(a=+a);var u=o.definition.put(a);u&&u.forRule&&(u=u.forRule(o.rule)),u&&u.forElement&&u.forElement(r)}}});var v,m=d.createElement("div"),h={"dom-qsa2.1":!!m.querySelectorAll},y=m.matches||m.matchesSelector||m.webkitMatchesSelector||m.mozMatchesSelector||m.msMatchesSelector||m.oMatchesSelector,p=[],S=[],g=[];o(function(){if(!v)if(v=!0,t("dom-qsa2.1")){for(var e=0,r=p.length;r>e;e++)l(p[e]);i()}else for(var n=d.all,e=0,r=n.length;r>e;e++)c(n[e])});var E,k=y?function(e,r){return y.call(e,r.selector)}:function(e,r){return r.ieId||r.setStyle(r.ieId="x-ie-"+f++,"true"),!!e.currentStyle[r.ieId]};return{ready:o,on:n,matchesRule:k,addRenderer:u,addInputConnector:a,update:c,clearRenderers:function(){p=[]},observeForElement:function(e,n,t){return r.when(e,function(e){function r(e){e.observe?e.observe(t):t(e)}e.forElement?u(n,function(n){r(e.forElement(n))}):r(e)})}}});