define("xstyle/core/generate",["xstyle/core/elemental","put-selector/put","xstyle/core/utils","xstyle/core/expression","xstyle/core/base"],function(e,n,t,r,o){function i(r,o){return r=r.sort?r:[r],function(i,l,s){var f,d=i;if("content"in i||(i.content=void 0),void 0===s){var p=(i._contentNode||i).childNodes||0,h=p[0];if(h){var g=v.createDocumentFragment();do g.appendChild(h);while(h=p[0]);i.content=g}if(i._contentNode){i._contentNode=void 0;try{i.innerHTML=""}catch(m){}}}for(var x=0,y=[i],N=[],T=0,E=r.length;E>T;T++){var C=A,A=r[T];try{if(A.eachProperty)if(A.args)if("("==A.operator){var L=r[T+1];a(A,L,d,function(e,n,t){u(e,n,t,o)})}else{var w=A.args[0];if("string"==typeof w){var b=w.split("=");try{d.setAttribute(b[0],b[1])}catch(m){}}else{var R=w[0].replace(/=$/,""),B=w[1];"("==B.operator?a(w[1],R,d,function(e,n,t){c(e,n,t,o)}):d.setAttribute(R,B.value)}}else n(d,A.selector),N.push(A.selector,d);else if("string"==typeof A){"="==A.charAt(0)&&(A=A.slice(1));var _=d,L=r[T+1],b=[];A.replace(/([,\n]+)?([\t ]*)?(\.|#)?([-\w%$|\.\#]+)(?:\[([^\]=]+)=?['"]?([^\]'"]*)['"]?\])?/g,function(){b.push(arguments)});for(var S=0;S<b.length;S++)(function(e,r,a,c,u,p,v){function h(){var e=_._contentNode;e&&(e.innerHTML="",_=e)}if(r){var g=a?a.length:0;g>x?(h(),y[g]=_):_=y[g]||_,x=g}else h();var m;if(c)m=(C&&C.args?"":"span")+c+u;else{var T=u.match(/^[-\w]+/)[0],E=o.getDefinition(T);E&&(E.then||E.newElement)?_=function(e,r,o,i){var a,l;if(t.when(E&&E.newElement&&E.newElement(),function(e){if(a=e,a?(o=o.slice(i.length),o&&n(a,o)):a=n(o),l){l.parentNode.replaceChild(a,l);var t,r=l.childNodes;for(a=a._contentNode||a;t=r[0];)a.appendChild(t)}}),a)return e.insertBefore(a,r||null);var l=n("span");return e.insertBefore(l,r||null)}(_,s,u,T):m=u}m&&(_=n(s||_,(s?"-":"")+m)),s=null,p&&(v=""===v?p:v,_.setAttribute(p,v)),l&&(_.item=l),f=f||_,(S<b.length-1||_!=d&&_!=i&&(!L||!L.base))&&N.push(null,_),d=_}).apply(this,b[S])}else d.appendChild(v.createTextNode(A.value))}catch(m){d.innerHTML&&(d.innerHTML=""),d.appendChild(v.createTextNode(m))}}for(var k;k=N.pop();)e.update(k,N.pop());return f}}function a(t,o,i,a){var l,c;o&&o.eachProperty?(n(i,l=o.selector),c=o):(n(i,l=t.selector||(t.selector=".-xbind-"+h++)),c=t);var u=t.getArgs()[0],s=t.expressionResult,f=t.expressionDefinition;f||(f=t.expressionDefinition=r.evaluate(t.parent,u),s=f.valueOf(),e.addInputConnector(c,f),function(n,r,o){t.expressionResult=s,o.depend&&o.depend({invalidate:function(t){var i;i=t?e.matchesRule(t.elements[0],c)?t.elements:t.elements[0].querySelectorAll(r):document.querySelectorAll(r);for(var l=0,u=i.length;u>l;l++)a(i[l],n,o.valueOf())}})}(o,l,f)),a(i,o,s)}function l(e,n,r,o){return t.when(e,function(e){e&&e.forRule&&(e=e.forRule(n)),e&&e.forElement&&(e=e.forElement(r)),o(e)})}function c(e,n,t,r){l(t,r,e,function(t){e.setAttribute(n,t)})}function u(e,t,r,o){if(e._defaultBinding=!0,r&&r.then&&"INPUT"!==e.tagName)try{e.appendChild(v.createTextNode("Loading"))}catch(a){}l(r,o,e,function(r){if(e._defaultBinding)if(s(e),e.childNodes.length&&(e.innerHTML=""),r&&r.sort)if(r.isSequence)i(r,o)(e);else{var a=t&&t.eachProperty&&t.each,l=o.newRule();a=a?i(a,l):function(e,t,r){return n(r||e,(r?"-":"")+(d[e.tagName]||"span"),""+t)};var c,u=[];if(r.track&&(r=r.track(),c=r.tracking),r.forEach(function(n){u.push(a(e,n,null))}),r.on)var f=r.on("add,delete,update",function(n){var t=n.target,r=n.previousIndex,o=n.index;if(r>-1){var i=u[r];s(i,!0),i.parentNode.removeChild(i),u.splice(r,1)}o>-1&&u.splice(o,0,a(e,t,u[o]||null))});c=c||f,c&&(e.xcleanup=function(){c.remove()})}else r&&r.nodeType?e.appendChild(r):(r=void 0===r?"":r,e.tagName in p?"checkbox"===e.type?e.checked=r:e.value=r:e.appendChild(v.createTextNode(r)))})}function s(e,n){e.xcleanup&&e.xcleanup(n);for(var t=e.getElementsByTagName("*"),r=0,o=t.length;o>r;r++){var i=t[r];i.xcleanup&&i.xcleanup(!0)}}function f(e,n){return i(n,o)(e)}var d={TABLE:"tr",TBODY:"tr",TR:"td",UL:"li",OL:"li",SELECT:"option"},p={INPUT:1,TEXTAREA:1,SELECT:1},v=document,h=1;return f.forSelector=i,f});