define("dojox/widget/DataPresentation",["dojo","dijit","dojox","dojo/require!dojox/grid/DataGrid,dojox/charting/Chart2D,dojox/charting/widget/Legend,dojox/charting/action2d/Tooltip,dojox/charting/action2d/Highlight,dojo/colors,dojo/data/ItemFileWriteStore"],function(e,t,r){e.provide("dojox.widget.DataPresentation"),e.experimental("dojox.widget.DataPresentation"),e.require("dojox.grid.DataGrid"),e.require("dojox.charting.Chart2D"),e.require("dojox.charting.widget.Legend"),e.require("dojox.charting.action2d.Tooltip"),e.require("dojox.charting.action2d.Highlight"),e.require("dojo.colors"),e.require("dojo.data.ItemFileWriteStore"),function(){var t=function(e,t,r,i){var s=[];s[0]={value:0,text:""};var a=e.length;if("ClusteredBars"!==r&&"StackedBars"!==r){var n=i.offsetWidth,d=(""+e[0]).length*e.length*7;if(1==t)for(var h=1;500>h&&!(n>d/h);++h)++t}for(var o=0;a>o;o++)s.push({value:o+1,text:!t||o%t?"":e[o]});return s.push({value:a+1,text:""}),s},i=function(e,t){var r={vertical:!1,labels:t,min:0,max:t.length-1,majorTickStep:1,minorTickStep:1};return("ClusteredBars"===e||"StackedBars"===e)&&(r.vertical=!0),("Lines"===e||"Areas"===e||"StackedAreas"===e)&&(r.min++,r.max--),r},s=function(e,t,r,i){var s={vertical:!0,fixLower:"major",fixUpper:"major",natural:!0};return"secondary"===t&&(s.leftBottom=!1),("ClusteredBars"===e||"StackedBars"===e)&&(s.vertical=!1),r==i&&(s.min=r-1,s.max=i+1),s},a=function(e,t,r){var i={type:e,hAxis:"independent",vAxis:"dependent-"+t,gap:4,lines:!1,areas:!1,markers:!1};return("ClusteredBars"===e||"StackedBars"===e)&&(i.hAxis=i.vAxis,i.vAxis="independent"),("Lines"===e||"Hybrid-Lines"===e||"Areas"===e||"StackedAreas"===e)&&(i.lines=!0),("Areas"===e||"StackedAreas"===e)&&(i.areas=!0),"Lines"===e&&(i.markers=!0),"Hybrid-Lines"===e&&(i.shadows={dx:2,dy:2,dw:2},i.type="Lines"),"Hybrid-ClusteredColumns"===e&&(i.type="ClusteredColumns"),r&&(i.animate=r),i},n=function(n,d,h,o,l,g,c,u,f,p,v){var m=d;m||(n.innerHTML="",m=new r.charting.Chart2D(n)),c&&(c._clone=function(){var t=new r.charting.Theme({chart:this.chart,plotarea:this.plotarea,axis:this.axis,series:this.series,marker:this.marker,antiAlias:this.antiAlias,assignColors:this.assignColors,assignMarkers:this.assigneMarkers,colors:e.delegate(this.colors)});return t.markers=this.markers,t._buildMarkerArray(),t},m.setTheme(c));var y=f.series_data[0].slice(0);o&&y.reverse();var x=t(y,g,h,n),N={},W=null,I=null,j={};for(var _ in m.runs)j[_]=!0;for(var L=f.series_name.length,C=0;L>C;C++)if(f.series_chart[C]&&f.series_data[C].length>0){var S=h,H=f.series_axis[C];if("Hybrid"==S&&(S="line"==f.series_charttype[C]?"Hybrid-Lines":"Hybrid-ClusteredColumns"),N[H]||(N[H]={}),!N[H][S]){var k=H+"-"+S;m.addPlot(k,a(S,H,l));var b={};"string"==typeof u?b.text=function(t){var r=[t.element,t.run.name,y[t.index],"ClusteredBars"===S||"StackedBars"===S?t.x:t.y];return e.replace(u,r)}:"function"==typeof u&&(b.text=u),new r.charting.action2d.Tooltip(m,k,b),"Lines"!==S&&"Hybrid-Lines"!==S&&new r.charting.action2d.Highlight(m,k),N[H][S]=!0}for(var w=[],A=f.series_data[C].length,T=0;A>T;T++){var q=f.series_data[C][T];w.push(q),(null===W||q>W)&&(W=q),(null===I||I>q)&&(I=q)}o&&w.reverse();var D={plot:H+"-"+S};f.series_linestyle[C]&&(D.stroke={style:f.series_linestyle[C]}),m.addSeries(f.series_name[C],w,D),delete j[f.series_name[C]]}for(_ in j)m.removeSeries(_);return m.addAxis("independent",i(h,x)),m.addAxis("dependent-primary",s(h,"primary",I,W)),m.addAxis("dependent-secondary",s(h,"secondary",I,W)),m},d=function(e,t,i,s){var a=t;return a?a.refresh():a=new r.charting.widget.Legend({chart:i,horizontal:s},e),a},h=function(e,t,i,s,a){var n=t||new r.grid.DataGrid({},e);n.startup(),n.setStore(i,s,a);for(var d=[],h=0;h<i.series_name.length;h++)i.series_grid[h]&&i.series_data[h].length>0&&d.push({field:"data."+h,name:i.series_name[h],width:"auto",formatter:i.series_gridformatter[h]});return n.setStructure(d),n},o=function(e,t){t.title&&(e.innerHTML=t.title)},l=function(e,t){t.footer&&(e.innerHTML=t.footer)},g=function(e,t){var r=e;if(t)for(var i=t.split(/[.\[\]]+/),s=0,a=i.length;a>s;s++)r&&(r=r[i[s]]);return r};e.declare("dojox.widget.DataPresentation",null,{type:"chart",chartType:"clusteredBars",reverse:!1,animate:null,labelMod:1,legendHorizontal:!0,constructor:function(t,r){e.mixin(this,r),this.domNode=e.byId(t),this[this.type+"Node"]=this.domNode,"string"==typeof this.theme&&(this.theme=e.getObject(this.theme)),this.chartNode=e.byId(this.chartNode),this.legendNode=e.byId(this.legendNode),this.gridNode=e.byId(this.gridNode),this.titleNode=e.byId(this.titleNode),this.footerNode=e.byId(this.footerNode),this.legendVertical&&(this.legendHorizontal=!this.legendVertical),this.url?this.setURL(null,null,this.refreshInterval):this.data?this.setData(null,this.refreshInterval):this.setStore()},setURL:function(t,r,i){i&&this.cancelRefresh(),this.url=t||this.url,this.urlContent=r||this.urlContent,this.refreshInterval=i||this.refreshInterval;var s=this;e.xhrGet({url:this.url,content:this.urlContent,handleAs:"json-comment-optional",load:function(e,t){s.setData(e)},error:function(e,t){s.urlError&&"function"==typeof s.urlError&&s.urlError(e,t)}}),i&&this.refreshInterval>0&&(this.refreshIntervalPending=setInterval(function(){s.setURL()},this.refreshInterval))},setData:function(t,r){r&&this.cancelRefresh(),this.data=t||this.data,this.refreshInterval=r||this.refreshInterval;for(var i="function"==typeof this.series?this.series(this.data):this.series,s=[],a=[],n=[],d=[],h=[],o=[],l=[],c=[],u=[],f=0,p=0;p<i.length;p++)s[p]=g(this.data,i[p].datapoints),s[p]&&s[p].length>f&&(f=s[p].length),a[p]=[],n[p]=i[p].name||(i[p].namefield?g(this.data,i[p].namefield):null)||"series "+p,d[p]=i[p].chart!==!1,h[p]=i[p].charttype||"bar",o[p]=i[p].linestyle,l[p]=i[p].axis||"primary",c[p]=i[p].grid!==!1,u[p]=i[p].gridformatter;var v,m,y,x,N=[];for(v=0;f>v;v++){for(m={index:v},p=0;p<i.length;p++)s[p]&&s[p].length>v&&(y=g(s[p][v],i[p].field),d[p]&&(x=parseFloat(y),isNaN(x)||(y=x)),m["data."+p]=y,a[p].push(y));N.push(m)}0>=f&&N.push({index:0});var W=new e.data.ItemFileWriteStore({data:{identifier:"index",items:N}});if(this.data.title&&(W.title=this.data.title),this.data.footer&&(W.footer=this.data.footer),W.series_data=a,W.series_name=n,W.series_chart=d,W.series_charttype=h,W.series_linestyle=o,W.series_axis=l,W.series_grid=c,W.series_gridformatter=u,this.setPreparedStore(W),r&&this.refreshInterval>0){var I=this;this.refreshIntervalPending=setInterval(function(){I.setData()},this.refreshInterval)}},refresh:function(){this.url?this.setURL(this.url,this.urlContent,this.refreshInterval):this.data&&this.setData(this.data,this.refreshInterval)},cancelRefresh:function(){this.refreshIntervalPending&&(clearInterval(this.refreshIntervalPending),this.refreshIntervalPending=void 0)},setStore:function(e,t,r){this.setPreparedStore(e,t,r)},setPreparedStore:function(e,t,r){this.preparedstore=e||this.store,this.query=t||this.query,this.queryOptions=r||this.queryOptions,this.preparedstore&&(this.chartNode&&(this.chartWidget=n(this.chartNode,this.chartWidget,this.chartType,this.reverse,this.animate,this.labelMod,this.theme,this.tooltip,this.preparedstore,this.query,this.queryOptions),this.renderChartWidget()),this.legendNode&&(this.legendWidget=d(this.legendNode,this.legendWidget,this.chartWidget,this.legendHorizontal)),this.gridNode&&(this.gridWidget=h(this.gridNode,this.gridWidget,this.preparedstore,this.query,this.queryOptions),this.renderGridWidget()),this.titleNode&&o(this.titleNode,this.preparedstore),this.footerNode&&l(this.footerNode,this.preparedstore))},renderChartWidget:function(){this.chartWidget&&this.chartWidget.render()},renderGridWidget:function(){this.gridWidget&&this.gridWidget.render()},getChartWidget:function(){return this.chartWidget},getGridWidget:function(){return this.gridWidget},destroy:function(){this.cancelRefresh(),this.chartWidget&&(this.chartWidget.destroy(),delete this.chartWidget),this.legendWidget&&delete this.legendWidget,this.gridWidget&&delete this.gridWidget,this.chartNode&&(this.chartNode.innerHTML=""),this.legendNode&&(this.legendNode.innerHTML=""),this.gridNode&&(this.gridNode.innerHTML=""),this.titleNode&&(this.titleNode.innerHTML=""),this.footerNode&&(this.footerNode.innerHTML="")}})}()});