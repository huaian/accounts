define("dojox/mobile/ViewController",["dojo/_base/kernel","dojo/_base/array","dojo/_base/connect","dojo/_base/declare","dojo/_base/lang","dojo/_base/window","dojo/_base/Deferred","dojo/dom","dojo/dom-class","dojo/dom-construct","dojo/on","dojo/ready","dijit/registry","./ProgressIndicator","./TransitionEvent","./viewRegistry"],function(e,o,t,i,a,n,r,s,d,l,c,h,f,u,g,b){var v=i("dojox.mobile.ViewController",null,{dataHandlerClass:"dojox/mobile/dh/DataHandler",dataSourceClass:"dojox/mobile/dh/UrlDataSource",fileTypeMapClass:"dojox/mobile/dh/SuffixFileTypeMap",constructor:function(){this.viewMap={},h(a.hitch(this,function(){c(n.body(),"startTransition",a.hitch(this,"onStartTransition"))}))},findTransitionViews:function(e){if(!e)return[];e.match(/^#?([^&?]+)(.*)/);var o=RegExp.$2,t=f.byId(RegExp.$1);if(!t)return[];for(var i=t.getParent();i;i=i.getParent())if(i.isVisible&&!i.isVisible()){var a=t.getShowingView();a&&a.id!==t.id&&t.show(),t=i}return[t.getShowingView(),t,o]},openExternalView:function(e,o){var t=new r,i=this.viewMap[e.url];if(i)return e.moveTo=i,e.noTransition?f.byId(i).hide():new g(n.body(),e).dispatch(),t.resolve(!0),t;for(var s=null,d=o.childNodes.length-1;d>=0;d--){var l=o.childNodes[d];if(1===l.nodeType){var c=l.getAttribute("fixed")||l.getAttribute("data-mobile-fixed")||f.byNode(l)&&f.byNode(l).fixed;if("bottom"===c){s=l;break}}}var h=e.dataHandlerClass||this.dataHandlerClass,u=e.dataSourceClass||this.dataSourceClass,b=e.fileTypeMapClass||this.fileTypeMapClass;return require([h,u,b],a.hitch(this,function(i,r,d){var l=new i(new r(e.data||e.url),o,s),c=e.contentType||d.getContentType(e.url)||"html";l.processData(c,a.hitch(this,function(o){o?(this.viewMap[e.url]=e.moveTo=o,e.noTransition?f.byId(o).hide():new g(n.body(),e).dispatch(),t.resolve(!0)):t.reject("Failed to load "+e.url)}))})),t},onStartTransition:function(e){if(e.preventDefault(),e.detail){var o=e.detail;if(o.moveTo||o.href||o.url||o.scene){if(o.url&&!o.moveTo){var i=o.urlTarget,a=f.byId(i),r=a&&a.containerNode||s.byId(i);r||(a=b.getEnclosingView(e.target),r=a&&a.domNode.parentNode||n.body());var d=f.getEnclosingWidget(e.target);return d&&d.callback&&(o.context=d,o.method=d.callback),void this.openExternalView(o,r)}if(o.href)if(o.hrefTarget&&"_self"!=o.hrefTarget)n.global.open(o.href,o.hrefTarget);else{for(var l,c=b.getEnclosingView(e.target);c;c=b.getParentView(c))l=c;l&&l.performTransition(null,o.transitionDir,o.transition,e.target,function(){location.href=o.href})}else{if(o.scene)return void t.publish("/dojox/mobile/app/pushScene",[o.scene]);var h=this.findTransitionViews(o.moveTo),u=h[0],g=h[1],v=h[2];location.hash||o.hashchange||(b.initialView=u),o.moveTo&&g&&(o.moveTo=("#"===o.moveTo.charAt(0)?"#"+g.id:g.id)+v),!u||o.moveTo&&u===f.byId(o.moveTo.replace(/^#?([^&?]+).*/,"$1"))||(d=f.getEnclosingWidget(e.target),d&&d.callback&&(o.context=d,o.method=d.callback),u.performTransition(o))}}}}});return v._instance=new v,v.getInstance=function(){return v._instance},v});