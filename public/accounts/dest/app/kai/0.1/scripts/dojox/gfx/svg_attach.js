define("dojox/gfx/svg_attach",["dojo/_base/kernel","dojo/_base/lang","dojo/_base/array","dojo/_base/Color","./_base","./svg","./matrix"],function(t,e,a,r,o,n,i){function l(t){var i=t.rawNode.getAttribute("fill");if("none"==i)return void(t.fillStyle=null);var l=null,c=n.getRef(i);if(c)switch(c.tagName.toLowerCase()){case"lineargradient":l=u(o.defaultLinearGradient,c),a.forEach(["x1","y1","x2","y2"],function(t){l[t]=c.getAttribute(t)});break;case"radialgradient":l=u(o.defaultRadialGradient,c),a.forEach(["cx","cy","r"],function(t){l[t]=c.getAttribute(t)}),l.cx=c.getAttribute("cx"),l.cy=c.getAttribute("cy"),l.r=c.getAttribute("r");break;case"pattern":l=e.clone(o.defaultPattern),a.forEach(["x","y","width","height"],function(t){l[t]=c.getAttribute(t)}),l.src=c.firstChild.getAttributeNS(n.xmlns.xlink,"href")}else{l=new r(i);var d=t.rawNode.getAttribute("fill-opacity");null!=d&&(l.a=d)}t.fillStyle=l}function u(t,a){var o=e.clone(t);o.colors=[];for(var n=0;n<a.childNodes.length;++n)o.colors.push({offset:a.childNodes[n].getAttribute("offset"),color:new r(a.childNodes[n].getAttribute("stop-color"))});return o}function c(t){var a=t.rawNode,n=a.getAttribute("stroke");if(null==n||"none"==n)return void(t.strokeStyle=null);var i=t.strokeStyle=e.clone(o.defaultStroke),l=new r(n);l&&(i.color=l,i.color.a=a.getAttribute("stroke-opacity"),i.width=a.getAttribute("stroke-width"),i.cap=a.getAttribute("stroke-linecap"),i.join=a.getAttribute("stroke-linejoin"),"miter"==i.join&&(i.join=a.getAttribute("stroke-miterlimit")),i.style=a.getAttribute("dojoGfxStrokeStyle"))}function d(t){var e=t.rawNode.getAttribute("transform");if(e.match(/^matrix\(.+\)$/)){var a=e.slice(7,-1).split(",");t.matrix=i.normalize({xx:parseFloat(a[0]),xy:parseFloat(a[2]),yx:parseFloat(a[1]),yy:parseFloat(a[3]),dx:parseFloat(a[4]),dy:parseFloat(a[5])})}else t.matrix=null}function s(t){var a=t.fontStyle=e.clone(o.defaultFont),r=t.rawNode;a.style=r.getAttribute("font-style"),a.variant=r.getAttribute("font-variant"),a.weight=r.getAttribute("font-weight"),a.size=r.getAttribute("font-size"),a.family=r.getAttribute("font-family")}function f(t,a){var r=t.shape=e.clone(a),o=t.rawNode;for(var n in r)r[n]=o.getAttribute(n)}function g(t){f(t,o.defaultRect),t.shape.r=Math.min(t.rawNode.getAttribute("rx"),t.rawNode.getAttribute("ry"))}function b(t){var a=t.shape=e.clone(o.defaultText),r=t.rawNode;a.x=r.getAttribute("x"),a.y=r.getAttribute("y"),a.align=r.getAttribute("text-anchor"),a.decoration=r.getAttribute("text-decoration"),a.rotated=0!=parseFloat(r.getAttribute("rotate")),a.kerning="auto"==r.getAttribute("kerning"),a.text=r.firstChild.nodeValue}function h(t){var a=t.shape=e.clone(o.defaultTextPath),r=t.rawNode;a.align=r.getAttribute("text-anchor"),a.decoration=r.getAttribute("text-decoration"),a.rotated=0!=parseFloat(r.getAttribute("rotate")),a.kerning="auto"==r.getAttribute("kerning"),a.text=r.firstChild.nodeValue}return t.experimental("dojox.gfx.svg_attach"),n.attachNode=function(t){if(!t)return null;var e=null;switch(t.tagName.toLowerCase()){case n.Rect.nodeType:e=new n.Rect(t),g(e);break;case n.Ellipse.nodeType:e=new n.Ellipse(t),f(e,o.defaultEllipse);break;case n.Polyline.nodeType:e=new n.Polyline(t),f(e,o.defaultPolyline);break;case n.Path.nodeType:e=new n.Path(t),f(e,o.defaultPath);break;case n.Circle.nodeType:e=new n.Circle(t),f(e,o.defaultCircle);break;case n.Line.nodeType:e=new n.Line(t),f(e,o.defaultLine);break;case n.Image.nodeType:e=new n.Image(t),f(e,o.defaultImage);break;case n.Text.nodeType:var a=t.getElementsByTagName("textPath");a&&a.length?(e=new n.TextPath(t),f(e,o.defaultPath),h(e)):(e=new n.Text(t),b(e)),s(e);break;default:return null}return e instanceof n.Image||(l(e),c(e)),d(e),e},n.attachSurface=function(t){var e=new n.Surface;e.rawNode=t;var a=t.getElementsByTagName("defs");return 0==a.length?null:(e.defNode=a[0],e)},n});