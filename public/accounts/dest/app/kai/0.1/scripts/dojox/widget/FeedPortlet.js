define("dojox/widget/FeedPortlet",["dojo","dijit","dojox","dojo/require!dojox/widget/Portlet,dijit/Tooltip,dijit/form/TextBox,dijit/form/Button,dojox/data/GoogleFeedStore"],function(t,e,i){t.provide("dojox.widget.FeedPortlet"),t.require("dojox.widget.Portlet"),t.require("dijit.Tooltip"),t.require("dijit.form.TextBox"),t.require("dijit.form.Button"),t.require("dojox.data.GoogleFeedStore"),t.declare("dojox.widget.FeedPortlet",i.widget.Portlet,{local:!1,maxResults:5,url:"",openNew:!0,showFeedTitle:!0,postCreate:function(){if(this.inherited(arguments),this.local&&!i.data.AtomReadStore)throw Error(this.declaredClass+": To use local feeds, you must include dojox.data.AtomReadStore on the page.")},onFeedError:function(){this.containerNode.innerHTML="Error accessing the feed."},addChild:function(t){this.inherited(arguments);var e=t.attr("feedPortletUrl");e&&this.set("url",e)},_getTitle:function(t){var e=this.store.getValue(t,"title");return this.local?e.text:e},_getLink:function(t){var e=this.store.getValue(t,"link");return this.local?e.href:e},_getContent:function(t){var e=this.store.getValue(t,"summary");return e?(this.local&&(e=e.text),e=e.split("<script").join("<!--").split("</script>").join("-->"),e=e.split("<iframe").join("<!--").split("</iframe>").join("-->")):null},_setUrlAttr:function(t){this.url=t,this._started&&this.load()},startup:function(){if(!this.started&&!this._started){if(this.inherited(arguments),!this.url||""==this.url)throw new Error(this.id+": A URL must be specified for the feed portlet");this.url&&""!=this.url&&this.load()}},load:function(){this._resultList&&t.destroy(this._resultList);var e,o;this.local?(e=new i.data.AtomReadStore({url:this.url}),o={}):(e=new i.data.GoogleFeedStore,o={url:this.url});var r={query:o,count:this.maxResults,onComplete:t.hitch(this,function(t){if(this.showFeedTitle&&e.getFeedValue){var i=this.store.getFeedValue("title");i&&this.set("title",i.text?i.text:i)}this.generateResults(t)}),onError:t.hitch(this,"onFeedError")};this.store=e,e.fetch(r)},generateResults:function(i){var o,r=(this.store,this._resultList=t.create("ul",{"class":"dojoxFeedPortletList"},this.containerNode));t.forEach(i,t.hitch(this,function(i){var s=t.create("li",{innerHTML:'<a href="'+this._getLink(i)+'"'+(this.openNew?' target="_blank"':"")+">"+this._getTitle(i)+"</a>"},r);t.connect(s,"onmouseover",t.hitch(this,function(n){o&&clearTimeout(o),o=setTimeout(t.hitch(this,function(){o=null;var l=this._getContent(i);if(l){var a='<div class="dojoxFeedPortletPreview">'+l+"</div>";t.query("li",r).forEach(function(t){t!=n.target&&e.hideTooltip(t)}),e.showTooltip(a,s.firstChild,!this.isLeftToRight())}}),500)})),t.connect(s,"onmouseout",function(){o&&(clearTimeout(o),o=null),e.hideTooltip(s.firstChild)})})),this.resize()}}),t.declare("dojox.widget.ExpandableFeedPortlet",i.widget.FeedPortlet,{onlyOpenOne:!1,generateResults:function(e){var i=(this.store,"dojoxPortletToggleIcon"),o="dojoxPortletItemCollapsed",r="dojoxPortletItemOpen",s=this._resultList=t.create("ul",{"class":"dojoxFeedPortletExpandableList"},this.containerNode);t.forEach(e,t.hitch(this,t.hitch(this,function(e){var r=t.create("li",{"class":o},s),n=t.create("div",{style:"width: 100%;"},r);t.create("div",{"class":"dojoxPortletItemSummary",innerHTML:this._getContent(e)},r);t.create("span",{"class":i,innerHTML:"<img src='"+t.config.baseUrl+"/resources/blank.gif'>"},n);var l=t.create("a",{href:this._getLink(e),innerHTML:this._getTitle(e)},n);this.openNew&&t.attr(l,"target","_blank")}))),t.connect(s,"onclick",t.hitch(this,function(e){if(t.hasClass(e.target,i)||t.hasClass(e.target.parentNode,i)){t.stopEvent(e);for(var n=e.target.parentNode;"LI"!=n.tagName;)n=n.parentNode;this.onlyOpenOne&&t.query("li",s).filter(function(t){return t!=n}).removeClass(r).addClass(o);var l=t.hasClass(n,r);t.toggleClass(n,r,!l),t.toggleClass(n,o,l)}}))}}),t.declare("dojox.widget.PortletFeedSettings",i.widget.PortletSettings,{"class":"dojoxPortletFeedSettings",urls:null,selectedIndex:0,buildRendering:function(){var e;if(this.urls&&this.urls.length>0&&(e=t.create("select"),this.srcNodeRef&&(t.place(e,this.srcNodeRef,"before"),t.destroy(this.srcNodeRef)),this.srcNodeRef=e,t.forEach(this.urls,function(i){t.create("option",{value:i.url||i,innerHTML:i.label||i},e)})),"SELECT"==this.srcNodeRef.tagName){this.text=this.srcNodeRef;var i=t.create("div",{},this.srcNodeRef,"before");i.appendChild(this.text),this.srcNodeRef=i,t.query("option",this.text).filter("return !item.value;").forEach("item.value = item.innerHTML"),this.text.value||(this.content&&0==this.text.options.length&&this.text.appendChild(this.content),t.attr(e||this.text,"value",this.text.options[this.selectedIndex].value))}this.inherited(arguments)},_setContentAttr:function(){},postCreate:function(){if(!this.text){var i=this.text=new e.form.TextBox({});t.create("span",{innerHTML:"Choose Url: "},this.domNode),this.addChild(i)}this.addChild(new e.form.Button({label:"Load",onClick:t.hitch(this,function(){this.portlet.attr("url","SELECT"==this.text.tagName?this.text.value:this.text.attr("value")),"SELECT"==this.text.tagName&&t.some(this.text.options,t.hitch(this,function(t,e){return t.selected?(this.set("selectedIndex",e),!0):!1})),this.toggle()})})),this.addChild(new e.form.Button({label:"Cancel",onClick:t.hitch(this,"toggle")})),this.inherited(arguments)},startup:function(){if(!this._started){if(this.inherited(arguments),!this.portlet)throw Error(this.declaredClass+": A PortletFeedSettings widget cannot exist without a Portlet.");"SELECT"==this.text.tagName&&t.forEach(this.text.options,t.hitch(this,function(e,i){t.attr(e,"selected",i==this.selectedIndex)}));var e=this.portlet.attr("url");e?"SELECT"==this.text.tagName?!this.urls&&t.query("option[value='"+e+"']",this.text).length<1&&t.place(t.create("option",{value:e,innerHTML:e,selected:"true"}),this.text,"first"):this.text.attr("value",e):this.portlet.attr("url",this.get("feedPortletUrl"))}},_getFeedPortletUrlAttr:function(){return this.text.value}})});