define("dojox/dtl/tag/loader",["dojo/_base/lang","../_base","dojo/_base/array","dojo/_base/connect"],function(t,e,n,r){var s=t.getObject("tag.loader",!0,e);return s.BlockNode=t.extend(function(t,e){this.name=t,this.nodelist=e},{"super":function(){if(this.parent){var t=this.parent.nodelist.dummyRender(this.context,null,!0);return"string"==typeof t&&(t=new String(t)),t.safe=!0,t}return""},render:function(t,e){var n,s=this.name,i=this.nodelist;if(e.blocks){var o=e.blocks[s];o&&(n=o.parent,i=o.nodelist,o.used=!0)}if(this.rendered=i,t=t.push(),this.context=t,this.parent=null,i!=this.nodelist&&(this.parent=this),t.block=this,e.getParent)var a=e.getParent(),d=r.connect(e,"onSetParent",function(t,n,r){n&&r&&e.setParent(a)});return e=i.render(t,e,this),d&&r.disconnect(d),t=t.pop(),e},unrender:function(t,e){return this.rendered.unrender(t,e)},clone:function(t){return new this.constructor(this.name,this.nodelist.clone(t))},toString:function(){return"dojox.dtl.tag.loader.BlockNode"}}),s.ExtendsNode=t.extend(function(t,e,n,r,s){this.getTemplate=t,this.nodelist=e,this.shared=n,this.parent=r,this.key=s},{parents:{},getParent:function(t){var e=this.parent;if(!e){var n;if(e=this.parent=t.get(this.key,!1),!e)throw new Error("extends tag used a variable that did not resolve");if("object"==typeof e){var r=e.url||e.templatePath;e.shared&&(this.shared=!0),r?e=this.parent=r.toString():e.templateString?(n=e.templateString,e=this.parent=" "):e=this.parent=this.parent.toString()}e&&0===e.indexOf("shared:")&&(this.shared=!0,e=this.parent=e.substring(7,e.length))}if(!e)throw new Error("Invalid template name in 'extends' tag.");return e.render?e:this.parents[e]?this.parents[e]:(this.parent=this.getTemplate(n||dojox.dtl.text.getTemplateString(e)),this.shared&&(this.parents[e]=this.parent),this.parent)},render:function(t,e){var n=this.getParent(t);n.blocks=n.blocks||{},e.blocks=e.blocks||{};for(var r,s=0;r=this.nodelist.contents[s];s++)if(r instanceof dojox.dtl.tag.loader.BlockNode){var i=n.blocks[r.name];i&&i.nodelist!=r.nodelist&&(e=i.nodelist.unrender(t,e)),n.blocks[r.name]=e.blocks[r.name]={shared:this.shared,nodelist:r.nodelist,used:!1}}return this.rendered=n,n.nodelist.render(t,e,this)},unrender:function(t,e){return this.rendered.unrender(t,e,this)},toString:function(){return"dojox.dtl.block.ExtendsNode"}}),s.IncludeNode=t.extend(function(t,n,r,s,i){this._path=t,this.constant=n,this.path=n?t:new e._Filter(t),this.getTemplate=r,this.text=s,this.parsed=5==arguments.length?i:!0},{_cache:[{},{}],render:function(t,n){var r=(this.constant?this.path:this.path.resolve(t)).toString(),s=Number(this.parsed),i=!1;r!=this.last&&(i=!0,this.last&&(n=this.unrender(t,n)),this.last=r);var o=this._cache[s];if(s){if(o[r]||(o[r]=e.text._resolveTemplateArg(r,!0)),i){var a=this.getTemplate(o[r]);this.rendered=a.nodelist}return this.rendered.render(t,n,this)}if(this.text instanceof e._TextNode)return i&&(this.rendered=this.text,this.rendered.set(e.text._resolveTemplateArg(r,!0))),this.rendered.render(t,n);if(!o[r]){var d=[],h=document.createElement("div");h.innerHTML=e.text._resolveTemplateArg(r,!0);for(var l=h.childNodes;l.length;){var c=h.removeChild(l[0]);d.push(c)}o[r]=d}if(i){this.nodelist=[];for(var u,p=0;u=o[r][p];p++)this.nodelist.push(u.cloneNode(!0))}for(var f,p=0;f=this.nodelist[p];p++)n=n.concat(f);return n},unrender:function(t,e){if(this.rendered&&(e=this.rendered.unrender(t,e)),this.nodelist)for(var n,r=0;n=this.nodelist[r];r++)e=e.remove(n);return e},clone:function(t){return new this.constructor(this._path,this.constant,this.getTemplate,this.text.clone(t),this.parsed)}}),t.mixin(s,{block:function(t,e){var n=e.contents.split(),r=n[1];t._blocks=t._blocks||{},t._blocks[r]=t._blocks[r]||[],t._blocks[r].push(r);var s=t.parse(["endblock","endblock "+r]).rtrim();return t.next_token(),new dojox.dtl.tag.loader.BlockNode(r,s)},extends_:function(t,e){var n=e.contents.split(),r=!1,s=null,i=null;'"'==n[1].charAt(0)||"'"==n[1].charAt(0)?s=n[1].substring(1,n[1].length-1):i=n[1],s&&0==s.indexOf("shared:")&&(r=!0,s=s.substring(7,s.length));var o=t.parse();return new dojox.dtl.tag.loader.ExtendsNode(t.getTemplate,o,r,s,i)},include:function(t,e){var n=e.contents.split();if(2!=n.length)throw new Error(n[0]+" tag takes one argument: the name of the template to be included");var r=n[1],i=!1;return'"'!=r.charAt(0)&&"'"!=r.slice(-1)||r.charAt(0)!=r.slice(-1)||(r=r.slice(1,-1),i=!0),new s.IncludeNode(r,i,t.getTemplate,t.create_text_node())},ssi:function(t,n){var r=n.contents.split(),i=!1;if(3==r.length&&(i="parsed"==r.pop(),!i))throw new Error("Second (optional) argument to ssi tag must be 'parsed'");var o=s.include(t,new e.Token(n.token_type,r.join(" ")));return o.parsed=i,o}}),s});