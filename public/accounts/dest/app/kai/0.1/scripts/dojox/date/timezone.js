define("dojox/date/timezone",["dojo/_base/array","dojo/_base/config","dojo/_base/declare","dojo/_base/kernel","dojo/_base/lang","dojo/date","dojo/date/locale","dojo/request","dojo/request/handlers"],function(a,e,r,i,t,n,o,s,u){function c(a){a=a||{},I=t.mixin(I,a.zones||{}),x=t.mixin(x,a.rules||{})}function m(a){k[a]=!0,s.get(require.toUrl((e.timezoneFileBasePath||"dojox/date/zoneinfo")+"/"+a),{handleAs:"olson_zoneinfo",sync:!0}).then(c,function(a){throw a})}function f(a){throw new Error('Timezone "'+a+'" is either incorrect, or not loaded in the timezone registry.')}function l(a){var e=N[a];if(!e){var r=a.split("/")[0];if(e=P[r],!e){var i=I[a];if("string"==typeof i)return l(i);if(!k.backward)return m("backward"),l(a);f(a)}}return e}function d(a){var e=/(\d+)(?::0*(\d*))?(?::0*(\d*))?([su])?$/,r=a.match(e);return r?(r[1]=parseInt(r[1],10),r[2]=r[2]?parseInt(r[2],10):0,r[3]=r[3]?parseInt(r[3],10):0,r):null}function h(a,e,r,i,t,n,o){return Date.UTC(a,e,r,i,t,n)+60*(o||0)*1e3}function A(a){return E[a.substr(0,3).toLowerCase()]}function S(a){var e=d(a);if(null===e)return 0;var r=0===a.indexOf("-")?-1:1;return e=r*(1e3*(60*(60*e[1]+e[2])+e[3])),-e/60/1e3}function p(a,e,r){var i=A(a[3]),t=a[4],o=d(a[5]);"u"==o[4]&&(r=0);var s,u,c;if(!isNaN(t))return s=new Date(h(e,i,parseInt(t,10),o[1],o[2],o[3],r));if("last"==t.substr(0,4))return t=M[t.substr(4,3).toLowerCase()],s=new Date(h(e,i+1,1,o[1]-24,o[2],o[3],r)),u=n.add(s,"minute",-r).getUTCDay(),c=t>u?t-u-7:t-u,0!==c&&(s=n.add(s,"hour",24*c)),s;if(t=M[t.substr(0,3).toLowerCase()],"undefined"!=t){if(">="==a[4].substr(3,2))return s=new Date(h(e,i,parseInt(a[4].substr(5),10),o[1],o[2],o[3],r)),u=n.add(s,"minute",-r).getUTCDay(),c=u>t?t-u+7:t-u,0!==c&&(s=n.add(s,"hour",24*c)),s;if("<="==t.substr(3,2))return s=new Date(h(e,i,parseInt(a[4].substr(5),10),o[1],o[2],o[3],r)),u=n.add(s,"minute",-r).getUTCDay(),c=t>u?t-u-7:t-u,0!==c&&(s=n.add(s,"hour",24*c)),s}return null}function g(e,r){var i=[];return a.forEach(x[e[1]]||[],function(a){for(var t=0;2>t;t++)switch(a[t]){case"min":a[t]=C;break;case"max":a[t]=_;break;case"only":break;default:if(a[t]=parseInt(a[t],10),isNaN(a[t]))throw new Error("Invalid year found on rule")}"string"==typeof a[6]&&(a[6]=S(a[6])),(a[0]<=r&&a[1]>=r||a[0]==r&&"only"==a[1])&&i.push({r:a,d:p(a,r,e[0])})}),i}function v(e,r){for(var i=y[e]=[],t=0;t<r.length;t++){var o=r[t],s=i[t]=[],u=null,c=null,m=[];"string"==typeof o[0]&&(o[0]=S(o[0])),0===t?s[0]=Date.UTC(C,0,1,0,0,0,0):(s[0]=i[t-1][1],u=r[t-1],c=i[t-1],m=c[2]);var f,l=new Date(s[0]).getUTCFullYear(),v=o[3]?parseInt(o[3],10):_,z=[];for(f=l;v>=f;f++)z=z.concat(g(o,f));z.sort(function(a,e){return n.compare(a.d,e.d)});var T;for(f=0,T;T=z[f];f++){var b=f>0?z[f-1]:null;T.r[5].indexOf("u")<0&&T.r[5].indexOf("s")<0&&(0===f&&t>0?m.length?T.d=n.add(T.d,"minute",m[m.length-1].r[6]):0===n.compare(new Date(c[1]),T.d,"date")?T.d=new Date(c[1]):T.d=n.add(T.d,"minute",S(u[1])):f>0&&(T.d=n.add(T.d,"minute",b.r[6])))}if(s[2]=z,o[3]){var w=parseInt(o[3],10),k=A(o[4]||"Jan"),I=parseInt(o[5]||"1",10),x=d(o[6]||"0"),D=s[1]=h(w,k,I,x[1],x[2],x[3],"u"==x[4]?0:o[0]);isNaN(D)&&(D=s[1]=p([0,0,0,o[4],o[5],o[6]||"0"],w,"u"==x[4]?0:o[0]).getTime());var j=a.filter(z,function(a,e){var r=e>0?60*z[e-1].r[6]*1e3:0;return a.d.getTime()<D+r});"u"!=x[4]&&"s"!=x[4]&&(j.length?s[1]+=60*j[j.length-1].r[6]*1e3:s[1]+=60*S(o[1])*1e3)}else s[1]=Date.UTC(_,11,31,23,59,59,999)}}function z(a,e){for(var r=e,i=I[r];"string"==typeof i;)r=i,i=I[r];if(!i){if(!k.backward){m("backward",!0);return z(a,e)}f(r)}y[e]||v(e,i);for(var t,n=y[e],o=a.getTime(),s=0;t=n[s];s++)if(o>=t[0]&&o<t[1])return{zone:i[s],range:n[s],idx:s};throw new Error('No Zone found for "'+e+'" on '+a)}function T(a,e){for(var r,i=-1,t=e.range[2]||[],n=a.getTime(),o=(e.range,0);r=t[o];o++)n>=r.d.getTime()&&(i=o);return i>=0?t[i].r:null}function b(a,e,r){var i,t=e.zone,n=t[2];if(n.indexOf("%s")>-1){var o;if(r)o=r[7],"-"==o&&(o="");else if(t[1]in L)o=L[t[1]];else if(e.idx>0){var s=I[a][e.idx-1],u=s[2];o=u.indexOf("%s")<0&&n.replace("%s","S")==u?"S":""}else o="";i=n.replace("%s",o)}else if(n.indexOf("/")>-1){var c=n.split("/");i=r?c[0===r[6]?0:1]:c[0]}else i=n;return i}i.experimental("dojox.date.timezone");var w=["africa","antarctica","asia","australasia","backward","etcetera","europe","northamerica","pacificnew","southamerica"],C=1835,_=2038,k={},I={},y={},x={},D=e.timezoneLoadingScheme||"preloadAll",j=e.defaultZoneFile||("preloadAll"==D?w:"northamerica");u.register("olson_zoneinfo",function(a){for(var e=a.text,r=e.split("\n"),i=[],t="",n=null,o=null,s={zones:{},rules:{}},u=0;u<r.length;u++){var c=r[u];if(c.match(/^\s/)&&(c="Zone "+n+c),c=c.split("#")[0],c.length>3)switch(i=c.split(/\s+/),t=i.shift()){case"Zone":n=i.shift(),i[0]&&(s.zones[n]||(s.zones[n]=[]),s.zones[n].push(i));break;case"Rule":o=i.shift(),s.rules[o]||(s.rules[o]=[]),s.rules[o].push(i);break;case"Link":if(s.zones[i[1]])throw new Error("Error with Link "+i[1]);s.zones[i[1]]=i[0];break;case"Leap":}}return s});var E={jan:0,feb:1,mar:2,apr:3,may:4,jun:5,jul:6,aug:7,sep:8,oct:9,nov:10,dec:11},M={sun:0,mon:1,tue:2,wed:3,thu:4,fri:5,sat:6},P={EST:"northamerica",MST:"northamerica",HST:"northamerica",EST5EDT:"northamerica",CST6CDT:"northamerica",MST7MDT:"northamerica",PST8PDT:"northamerica",America:"northamerica",Pacific:"australasia",Atlantic:"europe",Africa:"africa",Indian:"africa",Antarctica:"antarctica",Asia:"asia",Australia:"australasia",Europe:"europe",WET:"europe",CET:"europe",MET:"europe",EET:"europe"},N={"Pacific/Honolulu":"northamerica","Atlantic/Bermuda":"northamerica","Atlantic/Cape_Verde":"africa","Atlantic/St_Helena":"africa","Indian/Kerguelen":"antarctica","Indian/Chagos":"asia","Indian/Maldives":"asia","Indian/Christmas":"australasia","Indian/Cocos":"australasia","America/Danmarkshavn":"europe","America/Scoresbysund":"europe","America/Godthab":"europe","America/Thule":"europe","Asia/Yekaterinburg":"europe","Asia/Omsk":"europe","Asia/Novosibirsk":"europe","Asia/Krasnoyarsk":"europe","Asia/Irkutsk":"europe","Asia/Yakutsk":"europe","Asia/Vladivostok":"europe","Asia/Sakhalin":"europe","Asia/Magadan":"europe","Asia/Kamchatka":"europe","Asia/Anadyr":"europe","Africa/Ceuta":"europe","America/Argentina/Buenos_Aires":"southamerica","America/Argentina/Cordoba":"southamerica","America/Argentina/Tucuman":"southamerica","America/Argentina/La_Rioja":"southamerica","America/Argentina/San_Juan":"southamerica","America/Argentina/Jujuy":"southamerica","America/Argentina/Catamarca":"southamerica","America/Argentina/Mendoza":"southamerica","America/Argentina/Rio_Gallegos":"southamerica","America/Argentina/Ushuaia":"southamerica","America/Aruba":"southamerica","America/La_Paz":"southamerica","America/Noronha":"southamerica","America/Belem":"southamerica","America/Fortaleza":"southamerica","America/Recife":"southamerica","America/Araguaina":"southamerica","America/Maceio":"southamerica","America/Bahia":"southamerica","America/Sao_Paulo":"southamerica","America/Campo_Grande":"southamerica","America/Cuiaba":"southamerica","America/Porto_Velho":"southamerica","America/Boa_Vista":"southamerica","America/Manaus":"southamerica","America/Eirunepe":"southamerica","America/Rio_Branco":"southamerica","America/Santiago":"southamerica","Pacific/Easter":"southamerica","America/Bogota":"southamerica","America/Curacao":"southamerica","America/Guayaquil":"southamerica","Pacific/Galapagos":"southamerica","Atlantic/Stanley":"southamerica","America/Cayenne":"southamerica","America/Guyana":"southamerica","America/Asuncion":"southamerica","America/Lima":"southamerica","Atlantic/South_Georgia":"southamerica","America/Paramaribo":"southamerica","America/Port_of_Spain":"southamerica","America/Montevideo":"southamerica","America/Caracas":"southamerica"},L={US:"S",Chatham:"S",NZ:"S",NT_YK:"S",Edm:"S",Salv:"S",Canada:"S",StJohns:"S",TC:"S",Guat:"S",Mexico:"S",Haiti:"S",Barb:"S",Belize:"S",CR:"S",Moncton:"S",Swift:"S",Hond:"S",Thule:"S",NZAQ:"S",Zion:"S",ROK:"S",PRC:"S",Taiwan:"S",Ghana:"GMT",SL:"WAT",Chicago:"S",Detroit:"S",Vanc:"S",Denver:"S",Halifax:"S",Cuba:"S",Indianapolis:"S",Starke:"S",Marengo:"S",Pike:"S",Perry:"S",Vincennes:"S",Pulaski:"S",Louisville:"S",CA:"S",Nic:"S",Menominee:"S",Mont:"S",Bahamas:"S",NYC:"S",Regina:"S",Resolute:"ES",DR:"S",Toronto:"S",Winn:"S"};t.setObject("dojox.date.timezone",{getTzInfo:function(a,e){if("lazyLoad"==D){var r=l(e);if(!r)throw new Error("Not a valid timezone ID.");k[r]||m(r)}var i=z(a,e),t=i.zone[0],n=T(a,i);t+=n?n[6]:S(x[i.zone[1]]&&i.idx>0?I[e][i.idx-1][1]:i.zone[1]);var o=b(e,i,n);return{tzOffset:t,tzAbbr:o}},loadZoneData:function(a){c(a)},getAllZones:function(){var a=[];for(var e in I)a.push(e);return a.sort(),a}}),"string"==typeof j&&j&&(j=[j]),j instanceof Array&&a.forEach(j,m);var O=o.format,B=o._getZone;return o.format=function(a,e){if(e=e||{},e.timezone&&!e._tzInfo&&(e._tzInfo=dojox.date.timezone.getTzInfo(a,e.timezone)),e._tzInfo){var r=a.getTimezoneOffset()-e._tzInfo.tzOffset;a=new Date(a.getTime()+60*r*1e3)}return O.call(this,a,e)},o._getZone=function(a,e,r){return r._tzInfo?e?r._tzInfo.tzAbbr:r._tzInfo.tzOffset:B.call(this,a,e,r)},dojox.date.timezone});