define("dojo/request/xhr",["../errors/RequestError","./watch","./handlers","./util","../has"],function(e,t,n,r,a){function o(t,a){var o=t.xhr;t.status=t.xhr.status;try{t.text=o.responseText}catch(s){}if("xml"===t.options.handleAs&&(t.data=o.responseXML),!a)try{n(t)}catch(s){a=s}a?this.reject(a):r.checkStatus(o.status)?this.resolve(t):(a=new e("Unable to load "+t.url+" status: "+o.status,t),this.reject(a))}function s(e){return this.xhr.getResponseHeader(e)}function i(n,v,y){var x=a("native-formdata")&&v&&v.data&&v.data instanceof FormData,b=r.parseArgs(n,r.deepCreate(h,v),x);n=b.url,v=b.options;var w,m=function(){w&&w()},L=r.deferred(b,f,d,u,o,m),X=b.xhr=i._create();if(!X)return L.cancel(new e("XHR was not created")),y?L:L.promise;b.getHeader=s,c&&(w=c(X,L,b));var T=v.data,H=!v.sync,M=v.method;try{X.open(M,n,H,v.user||p,v.password||p),v.withCredentials&&(X.withCredentials=v.withCredentials),a("native-response-type")&&v.handleAs in l&&(X.responseType=l[v.handleAs]);var R=v.headers,q=x?!1:"application/x-www-form-urlencoded";if(R)for(var E in R)"content-type"===E.toLowerCase()?q=R[E]:R[E]&&X.setRequestHeader(E,R[E]);q&&q!==!1&&X.setRequestHeader("Content-Type",q),R&&"X-Requested-With"in R||X.setRequestHeader("X-Requested-With","XMLHttpRequest"),r.notify&&r.notify.emit("send",b,L.promise.cancel),X.send(T)}catch(j){L.reject(j)}return t(L),X=null,y?L:L.promise}a.add("native-xhr",function(){return"undefined"!=typeof XMLHttpRequest}),a.add("dojo-force-activex-xhr",function(){return a("activex")&&!document.addEventListener&&"file:"===window.location.protocol}),a.add("native-xhr2",function(){if(a("native-xhr")){var e=new XMLHttpRequest;return"undefined"!=typeof e.addEventListener&&("undefined"==typeof opera||"undefined"!=typeof e.upload)}}),a.add("native-formdata",function(){return"undefined"!=typeof FormData}),a.add("native-response-type",function(){return a("native-xhr")&&"undefined"!=typeof(new XMLHttpRequest).responseType}),a.add("native-xhr2-blob",function(){if(a("native-response-type")){var e=new XMLHttpRequest;e.open("GET","/",!0),e.responseType="blob";var t=e.responseType;return e.abort(),"blob"===t}});var d,u,c,f,l={blob:a("native-xhr2-blob")?"blob":"arraybuffer",document:"document",arraybuffer:"arraybuffer"};a("native-xhr2")?(d=function(e){return!this.isFulfilled()},f=function(e,t){t.xhr.abort()},c=function(t,n,r){function a(e){n.handleResponse(r)}function o(t){var a=t.target,o=new e("Unable to load "+r.url+" status: "+a.status,r);n.handleResponse(r,o)}function s(e){e.lengthComputable?(r.loaded=e.loaded,r.total=e.total,n.progress(r)):3===r.xhr.readyState&&(r.loaded=e.position,n.progress(r))}return t.addEventListener("load",a,!1),t.addEventListener("error",o,!1),t.addEventListener("progress",s,!1),function(){t.removeEventListener("load",a,!1),t.removeEventListener("error",o,!1),t.removeEventListener("progress",s,!1),t=null}}):(d=function(e){return e.xhr.readyState},u=function(e){return 4===e.xhr.readyState},f=function(e,t){var n=t.xhr,r=typeof n.abort;("function"===r||"object"===r||"unknown"===r)&&n.abort()});var p,h={data:null,query:null,sync:!1,method:"GET"};if(i._create=function(){throw new Error("XMLHTTP not available")},a("native-xhr")&&!a("dojo-force-activex-xhr"))i._create=function(){return new XMLHttpRequest};else if(a("activex"))try{new ActiveXObject("Msxml2.XMLHTTP"),i._create=function(){return new ActiveXObject("Msxml2.XMLHTTP")}}catch(v){try{new ActiveXObject("Microsoft.XMLHTTP"),i._create=function(){return new ActiveXObject("Microsoft.XMLHTTP")}}catch(v){}}return r.addCommonMethods(i),i});