define("dojo/hash",["./_base/kernel","require","./_base/config","./aspect","./_base/lang","./topic","./domReady","./sniff"],function(t,i,n,e,o,a,r,c){function s(t,i){var n=t.indexOf(i);return n>=0?t.substring(n+1):""}function h(){return s(location.href,"#")}function l(){a.publish("/dojo/hashchange",h())}function u(){h()!==m&&(m=h(),l())}function f(t){if(g){if(g.isTransitioning())return void setTimeout(o.hitch(null,f,t),v);var i=g.iframe.location.href,n=i.indexOf("?");return void g.iframe.location.replace(i.substring(0,n)+"?"+t)}location.replace("#"+t),!p&&u()}function d(){function e(){m=h(),u=p?m:s(b.href,"?"),f=!1,d=null}var a=document.createElement("iframe"),r="dojo-hash-iframe",c=n.dojoBlankHtmlUrl||i.toUrl("./resources/blank.html");n.useXDomain&&!n.dojoBlankHtmlUrl,a.id=r,a.src=c+"?"+h(),a.style.display="none",document.body.appendChild(a),this.iframe=t.global[r];var u,f,d,g,p,b=this.iframe.location;this.isTransitioning=function(){return f},this.pollLocation=function(){if(!p)try{var t=s(b.href,"?");document.title!=g&&(g=this.iframe.document.title=document.title)}catch(i){p=!0}var n=h();if(f&&m===n){if(!p&&t!==d)return void setTimeout(o.hitch(this,this.pollLocation),0);e(),l()}else if(m!==n||!p&&u!==t){if(m!==n)return m=n,f=!0,d=n,a.src=c+"?"+d,p=!1,void setTimeout(o.hitch(this,this.pollLocation),0);p||(location.href="#"+b.search.substring(1),e(),l())}else;setTimeout(o.hitch(this,this.pollLocation),v)},e(),setTimeout(o.hitch(this,this.pollLocation),v)}t.hash=function(t,i){return arguments.length?("#"==t.charAt(0)&&(t=t.substring(1)),i?f(t):location.href="#"+t,t):h()};var m,g,p,v=n.hashPollFrequency||100;return r(function(){"onhashchange"in t.global&&(!c("ie")||c("ie")>=8&&"BackCompat"!=document.compatMode)?p=e.after(t.global,"onhashchange",l,!0):document.addEventListener?(m=h(),setInterval(u,v)):document.attachEvent&&(g=new d)}),t.hash});