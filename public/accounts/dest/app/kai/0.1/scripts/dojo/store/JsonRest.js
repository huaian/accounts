define("dojo/store/JsonRest",["../_base/xhr","../_base/lang","../json","../_base/declare","./util/QueryResults"],function(e,t,n,r,s){var a=null;return r("dojo.store.JsonRest",a,{constructor:function(e){this.headers={},r.safeMixin(this,e)},headers:{},target:"",idProperty:"id",ascendingPrefix:"+",descendingPrefix:"-",_getTarget:function(e){var t=this.target;return"undefined"!=typeof e&&(t+="/"==t.charAt(t.length-1)?e:"/"+e),t},get:function(n,r){r=r||{};var s=t.mixin({Accept:this.accepts},this.headers,r.headers||r);return e("GET",{url:this._getTarget(n),handleAs:"json",headers:s})},accepts:"application/javascript, application/json",getIdentity:function(e){return e[this.idProperty]},put:function(r,s){s=s||{};var a="id"in s?s.id:this.getIdentity(r),i="undefined"!=typeof a;return e(i&&!s.incremental?"PUT":"POST",{url:this._getTarget(a),postData:n.stringify(r),handleAs:"json",headers:t.mixin({"Content-Type":"application/json",Accept:this.accepts,"If-Match":s.overwrite===!0?"*":null,"If-None-Match":s.overwrite===!1?"*":null},this.headers,s.headers)})},add:function(e,t){return t=t||{},t.overwrite=!1,this.put(e,t)},remove:function(n,r){return r=r||{},e("DELETE",{url:this._getTarget(n),headers:t.mixin({},this.headers,r.headers)})},query:function(n,r){r=r||{};var a=t.mixin({Accept:this.accepts},this.headers,r.headers),i=this.target.indexOf("?")>-1;if(n&&"object"==typeof n&&(n=e.objectToQuery(n),n=n?(i?"&":"?")+n:""),(r.start>=0||r.count>=0)&&(a["X-Range"]="items="+(r.start||"0")+"-"+("count"in r&&r.count!=1/0?r.count+(r.start||0)-1:""),this.rangeParam?(n+=(n||i?"&":"?")+this.rangeParam+"="+a["X-Range"],i=!0):a.Range=a["X-Range"]),r&&r.sort){var o=this.sortParam;n+=(n||i?"&":"?")+(o?o+"=":"sort(");for(var h=0;h<r.sort.length;h++){var c=r.sort[h];n+=(h>0?",":"")+(c.descending?this.descendingPrefix:this.ascendingPrefix)+encodeURIComponent(c.attribute)}o||(n+=")")}var d=e("GET",{url:this.target+(n||""),handleAs:"json",headers:a});return d.total=d.then(function(){var e=d.ioArgs.xhr.getResponseHeader("Content-Range");return e||(e=d.ioArgs.xhr.getResponseHeader("X-Content-Range")),e&&(e=e.match(/\/(.*)/))&&+e[1]}),s(d)}})});