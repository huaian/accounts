define(["appRestStore/statistics","dojo/_base/lang","cutil/c.util.common","cutil/c.util.validate","dojox/charting/Chart","dojox/charting/plot2d/Pie","dojox/charting/action2d/Tooltip","dojox/charting/themes/Tom","dojox/charting/widget/Legend"],function(e,t,a,r){"use strict";var i={hasValidFormData:function(e){var t=this,a=JSON.parse(JSON.stringify(t.vm.$data.formData));return t.memoryStore.setAttr("memory.formData",a),a.startDate?a:(t.showToast({text:"请选择开始日期"}),!1)},fetchData:function(t){var a=this,r=_.isObject(t)?t:"";e.statistics.get(r).then(function(e){a.isSucceedResponse(e)?(a.viewData.statisticsData=e.body,a.viewData.sumExpenses=_.reduce(_.pluck(e.body.expenses,"y"),function(e,t){return e+t},0),a.viewData.sumIncomes=_.reduce(_.pluck(e.body.incomes,"y"),function(e,t){return e+t},0),a.vm&&(a.vm.$set("sumExpenses",a.viewData.sumExpenses),a.vm.$set("sumIncomes",a.viewData.sumIncomes)),a.expensePieChart?a.model.trigger("refreshChart"):(a.model.trigger("renderChart",{pieChartName:"incomePieChart",legendId:"incomeLegend",chartId:"incomePieChart",chartData:a.viewData.statisticsData.incomes,seriesName:"Series Income",legendName:"incomeLegend "}),a.model.trigger("renderChart",{pieChartName:"expensePieChart",legendId:"expenseLegend",chartId:"expensePieChart",chartData:a.viewData.statisticsData.expenses,seriesName:"Series Expense",legendName:"expenseLegend "}))):a.showResponseError(e)},function(e){a.showResponseError(e)})},search:function(e){var t=this,a=null;return e&&$(e.target).hasClass("form-disabled")?!1:void((a=$.proxy(i.hasValidFormData,t)())&&t.model.trigger("fetchData",a))},renderChart:function(e){var t=this,a=dojox.charting;t[e.pieChartName]=new a.Chart(e.chartId),t[e.pieChartName].setTheme(a.themes.Tom).addPlot("default",{type:"Pie",font:"normal normal 10pt Tahoma",fontColor:"#ccc",labelWiring:"#ccc",radius:65,labelStyle:"columns",htmlLabels:!0,startAngle:-10}).addSeries(e.seriesName,e.chartData);new a.action2d.Tooltip(t[e.pieChartName],"default");t[e.pieChartName].render(),t[e.legendName]=new dojox.charting.widget.Legend({chart:t[e.pieChartName],horizontal:!1},e.legendId+t.viewContextPostfix)},refreshChart:function(){var e=this;e.expensePieChart.updateSeries("Series Expense",e.viewData.statisticsData.expenses),e.incomePieChart.updateSeries("Series Income",e.viewData.statisticsData.incomes),e.expensePieChart.render(),e.incomePieChart.render(),e["incomeLegend"+e.viewContextPostfix].refresh(),e["expenseLegend"+e.viewContextPostfix].refresh()}};return i});